{"version":3,"file":"olcesium-debug.js","mappings":"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","sources":["webpack://olcs_unused_var/./src/olcs/AbstractSynchronizer.ts","webpack://olcs_unused_var/./src/olcs/AutoRenderLoop.ts","webpack://olcs_unused_var/./src/olcs/Camera.ts","webpack://olcs_unused_var/./src/olcs/FeatureConverter.ts","webpack://olcs_unused_var/./src/olcs/MVTImageryProvider.ts","webpack://olcs_unused_var/./src/olcs/OLCesium.ts","webpack://olcs_unused_var/./src/olcs/OverlaySynchronizer.ts","webpack://olcs_unused_var/./src/olcs/RasterSynchronizer.ts","webpack://olcs_unused_var/./src/olcs/SynchronizedOverlay.ts","webpack://olcs_unused_var/./src/olcs/VectorSynchronizer.ts","webpack://olcs_unused_var/./src/olcs/contrib/LazyLoader.ts","webpack://olcs_unused_var/./src/olcs/contrib/Manager.ts","webpack://olcs_unused_var/./src/olcs/core.ts","webpack://olcs_unused_var/./src/olcs/core/OLImageryProvider.ts","webpack://olcs_unused_var/./src/olcs/core/VectorLayerCounterpart.ts","webpack://olcs_unused_var/./src/olcs/math.ts","webpack://olcs_unused_var/./src/olcs/print.ts","webpack://olcs_unused_var/./src/olcs/print/computeRectangle.ts","webpack://olcs_unused_var/./src/olcs/print/drawCesiumMask.ts","webpack://olcs_unused_var/./src/olcs/print/takeCesiumScreenshot.ts","webpack://olcs_unused_var/./src/olcs/util.ts","webpack://olcs_unused_var/external var \"ol.Observable\"","webpack://olcs_unused_var/external var \"ol.Overlay\"","webpack://olcs_unused_var/external var \"ol.easing\"","webpack://olcs_unused_var/external var \"ol.extent\"","webpack://olcs_unused_var/external var \"ol.format.MVT\"","webpack://olcs_unused_var/external var \"ol.geom\"","webpack://olcs_unused_var/external var \"ol.geom.Point\"","webpack://olcs_unused_var/external var \"ol.geom.Polygon\"","webpack://olcs_unused_var/external var \"ol.geom.SimpleGeometry\"","webpack://olcs_unused_var/external var \"ol.layer.BaseVector\"","webpack://olcs_unused_var/external var \"ol.layer.Group\"","webpack://olcs_unused_var/external var \"ol.layer.Image\"","webpack://olcs_unused_var/external var \"ol.layer.Layer\"","webpack://olcs_unused_var/external var \"ol.layer.Tile\"","webpack://olcs_unused_var/external var \"ol.layer.Vector\"","webpack://olcs_unused_var/external var \"ol.layer.VectorTile\"","webpack://olcs_unused_var/external var \"ol.proj\"","webpack://olcs_unused_var/external var \"ol.render\"","webpack://olcs_unused_var/external var \"ol.render.Feature\"","webpack://olcs_unused_var/external var \"ol.source\"","webpack://olcs_unused_var/external var \"ol.source.Cluster\"","webpack://olcs_unused_var/external var \"ol.source.Image\"","webpack://olcs_unused_var/external var \"ol.source.ImageStatic\"","webpack://olcs_unused_var/external var \"ol.source.ImageWMS\"","webpack://olcs_unused_var/external var \"ol.source.TileImage\"","webpack://olcs_unused_var/external var \"ol.source.TileWMS\"","webpack://olcs_unused_var/external var \"ol.source.Vector\"","webpack://olcs_unused_var/external var \"ol.source.VectorTile\"","webpack://olcs_unused_var/external var \"ol.structs.LRUCache\"","webpack://olcs_unused_var/external var \"ol.style.Icon\"","webpack://olcs_unused_var/external var \"ol.style.Stroke\"","webpack://olcs_unused_var/external var \"ol.style.Style\"","webpack://olcs_unused_var/external var \"ol.tilegrid\"","webpack://olcs_unused_var/external var \"ol.tileurlfunction\"","webpack://olcs_unused_var/external var \"ol.util\"","webpack://olcs_unused_var/webpack/bootstrap","webpack://olcs_unused_var/webpack/runtime/compat get default export","webpack://olcs_unused_var/webpack/runtime/define property getters","webpack://olcs_unused_var/webpack/runtime/hasOwnProperty shorthand","webpack://olcs_unused_var/webpack/runtime/make namespace object","webpack://olcs_unused_var/./src/olcs.ts"],"sourcesContent":["import {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport LayerGroup from 'ol/layer/Group.js';\nimport {getUid} from './util';\nimport type Map from 'ol/Map.js';\nimport type {Scene, ImageryLayer} from 'cesium';\nimport type View from 'ol/View.js';\nimport type Collection from 'ol/Collection.js';\nimport type BaseLayer from 'ol/layer/Base.js';\nimport type {EventsKey} from 'ol/events.js';\nimport type {LayerWithParents} from './core';\nimport type VectorLayerCounterpart from './core/VectorLayerCounterpart';\n\n\nexport default abstract class AbstractSynchronizer<T extends ImageryLayer | VectorLayerCounterpart> {\n  protected map: Map;\n  protected view: View;\n  protected scene: Scene;\n  protected olLayers: Collection<BaseLayer>;\n  mapLayerGroup: LayerGroup;\n  /**\n   * Map of OpenLayers layer ids (from getUid) to the Cesium ImageryLayers.\n   * Null value means, that we are unable to create equivalent layers.\n   */\n  protected layerMap: Record<string, Array<T>> = {};\n  /**\n   * Map of listen keys for OpenLayers layer layers ids (from getUid).\n   */\n  protected olLayerListenKeys: Record<string, Array<EventsKey>> = {};\n  /**\n   * Map of listen keys for OpenLayers layer groups ids (from getUid).\n   */\n  private olGroupListenKeys_: Record<string, Array<EventsKey>> = {};\n\n  protected constructor(map: Map, scene: Scene) {\n    this.map = map;\n    this.view = map.getView();\n    this.scene = scene;\n    this.olLayers = map.getLayerGroup().getLayers();\n    this.mapLayerGroup = map.getLayerGroup();\n  }\n\n  /**\n   * Destroy all and perform complete synchronization of the layers.\n   */\n  synchronize() {\n    this.destroyAll();\n    this.addLayers_(this.mapLayerGroup);\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   */\n  protected orderLayers() {\n    // Ordering logics is handled in subclasses.\n  }\n\n  /**\n   * Add a layer hierarchy.\n   */\n  private addLayers_(root: BaseLayer) {\n    const fifo: LayerWithParents[] = [{\n      layer: root,\n      parents: []\n    }];\n    while (fifo.length > 0) {\n      const olLayerWithParents = fifo.splice(0, 1)[0];\n      const olLayer = olLayerWithParents.layer;\n      const olLayerId = getUid(olLayer).toString();\n      this.olLayerListenKeys[olLayerId] = [];\n      console.assert(!this.layerMap[olLayerId]);\n\n      let cesiumObjects = null;\n      if (olLayer instanceof LayerGroup) {\n        this.listenForGroupChanges_(olLayer);\n        if (olLayer !== this.mapLayerGroup) {\n          cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        }\n        if (!cesiumObjects) {\n          olLayer.getLayers().forEach((l) => {\n            if (l) {\n              const newOlLayerWithParents: LayerWithParents = {\n                layer: l,\n                parents: olLayer === this.mapLayerGroup ?\n                  [] :\n                  [olLayerWithParents.layer].concat(olLayerWithParents.parents)\n              };\n              fifo.push(newOlLayerWithParents);\n            }\n          });\n        }\n      } else {\n        cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        if (!cesiumObjects) {\n          // keep an eye on the layers that once failed to be added (might work when the layer is updated)\n          // for example when a source is set after the layer is added to the map\n          const layerId = olLayerId;\n          const layerWithParents = olLayerWithParents;\n          const onLayerChange = () => {\n            const cesiumObjs = this.createSingleLayerCounterparts(layerWithParents);\n            if (cesiumObjs) {\n              // unsubscribe event listener\n              layerWithParents.layer.un('change', onLayerChange);\n              this.addCesiumObjects_(cesiumObjs, layerId, layerWithParents.layer);\n              this.orderLayers();\n            }\n          };\n          this.olLayerListenKeys[olLayerId].push(layerWithParents.layer.on('change', onLayerChange));\n        }\n      }\n      // add Cesium layers\n      if (cesiumObjects) {\n        this.addCesiumObjects_(cesiumObjects, olLayerId, olLayer);\n      }\n    }\n\n    this.orderLayers();\n  }\n\n  /**\n   * Add Cesium objects.\n   */\n  private addCesiumObjects_(cesiumObjects: Array<T>, layerId: string, layer: BaseLayer) {\n    this.layerMap[layerId] = cesiumObjects;\n    this.olLayerListenKeys[layerId].push(layer.on('change:zIndex', () => this.orderLayers()));\n    cesiumObjects.forEach((cesiumObject) => {\n      this.addCesiumObject(cesiumObject);\n    });\n  }\n\n  /**\n   * Remove and destroy a single layer.\n   * @param {ol.layer.Layer} layer\n   * @return {boolean} counterpart destroyed\n   */\n  private removeAndDestroySingleLayer_(layer: BaseLayer): boolean {\n    const uid = getUid(layer).toString();\n    const counterparts = this.layerMap[uid];\n    if (!!counterparts) {\n      counterparts.forEach((counterpart) => {\n        this.removeSingleCesiumObject(counterpart, false);\n        this.destroyCesiumObject(counterpart);\n      });\n      this.olLayerListenKeys[uid].forEach(olObservableUnByKey);\n      delete this.olLayerListenKeys[uid];\n    }\n    delete this.layerMap[uid];\n    return !!counterparts;\n  }\n\n  /**\n   * Unlisten a single layer group.\n   */\n  private unlistenSingleGroup_(group: LayerGroup) {\n    if (group === this.mapLayerGroup) {\n      return;\n    }\n    const uid = getUid(group).toString();\n    const keys = this.olGroupListenKeys_[uid];\n    keys.forEach((key) => {\n      olObservableUnByKey(key);\n    });\n    delete this.olGroupListenKeys_[uid];\n    delete this.layerMap[uid];\n  }\n\n  /**\n   * Remove layer hierarchy.\n   */\n  private removeLayer_(root: BaseLayer) {\n    if (!!root) {\n      const fifo = [root];\n      while (fifo.length > 0) {\n        const olLayer = fifo.splice(0, 1)[0];\n        const done = this.removeAndDestroySingleLayer_(olLayer);\n        if (olLayer instanceof LayerGroup) {\n          this.unlistenSingleGroup_(olLayer);\n          if (!done) {\n            // No counterpart for the group itself so removing\n            // each of the child layers.\n            olLayer.getLayers().forEach((l) => {\n              fifo.push(l);\n            });\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Register listeners for single layer group change.\n   */\n  private listenForGroupChanges_(group: LayerGroup) {\n    const uuid = getUid(group).toString();\n\n    console.assert(this.olGroupListenKeys_[uuid] === undefined);\n\n    const listenKeyArray: EventsKey[] = [];\n    this.olGroupListenKeys_[uuid] = listenKeyArray;\n\n    // only the keys that need to be relistened when collection changes\n    let contentKeys: EventsKey[] = [];\n    const listenAddRemove = (function() {\n      const collection = group.getLayers();\n      if (collection) {\n        contentKeys = [\n          collection.on('add', (event) => {\n            this.addLayers_(event.element);\n          }),\n          collection.on('remove', (event) => {\n            this.removeLayer_(event.element);\n          })\n        ];\n        listenKeyArray.push(...contentKeys);\n      }\n    }).bind(this);\n\n    listenAddRemove();\n\n    listenKeyArray.push(group.on('change:layers', (e) => {\n      contentKeys.forEach((el) => {\n        const i = listenKeyArray.indexOf(el);\n        if (i >= 0) {\n          listenKeyArray.splice(i, 1);\n        }\n        olObservableUnByKey(el);\n      });\n      listenAddRemove();\n    }));\n  }\n\n  /**\n   * Destroys all the created Cesium objects.\n   */\n  public destroyAll() {\n    this.removeAllCesiumObjects(true); // destroy\n    let objKey;\n    for (objKey in this.olGroupListenKeys_) {\n      const keys = this.olGroupListenKeys_[objKey];\n      keys.forEach(olObservableUnByKey);\n    }\n    for (objKey in this.olLayerListenKeys) {\n      this.olLayerListenKeys[objKey].forEach(olObservableUnByKey);\n    }\n    this.olGroupListenKeys_ = {};\n    this.olLayerListenKeys = {};\n    this.layerMap = {};\n  }\n\n  /**\n   * Adds a single Cesium object to the collection.\n   */\n  protected abstract addCesiumObject(object: T): void;\n\n  protected abstract destroyCesiumObject(object: T): void;\n\n  /**\n   * Remove single Cesium object from the collection.\n   */\n  protected abstract removeSingleCesiumObject(object: T, destroy: boolean): void;\n\n  protected abstract removeAllCesiumObjects(destroy: boolean): void;\n\n  protected abstract createSingleLayerCounterparts(olLayerWithParents: LayerWithParents): Array<T>;\n}\n","import type {Scene} from 'cesium';\nimport type OLCesium from './OLCesium';\n\n/**\n * By default Cesium (used to?) renders as often as possible.\n * This is a waste of resources (CPU/GPU/battery).\n * An alternative mechanism in Cesium is on-demand rendering.\n * This class makes use of this alternative method and add some additionnal render points.\n */\nexport default class AutoRenderLoop {\n  ol3d: OLCesium;\n  private scene_: Scene;\n  private canvas_: HTMLCanvasElement;\n  private _boundNotifyRepaintRequired: typeof this.notifyRepaintRequired;\n  private repaintEventNames_ = [\n    'mousemove', 'mousedown', 'mouseup',\n    'touchstart', 'touchend', 'touchmove',\n    'pointerdown', 'pointerup', 'pointermove',\n    'wheel'\n  ] as const;\n\n  /**\n   * @param ol3d\n   */\n  constructor(ol3d: OLCesium) {\n    this.ol3d = ol3d;\n    this.scene_ = ol3d.getCesiumScene();\n    this.canvas_ = this.scene_.canvas;\n    this._boundNotifyRepaintRequired = this.notifyRepaintRequired.bind(this);\n    this.enable();\n  }\n\n  /**\n   * Enable.\n   */\n  enable() {\n    this.scene_.requestRenderMode = true;\n    this.scene_.maximumRenderTimeChange = 1000;\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.addEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.addEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    // Listen for changes on the layer group\n    this.ol3d.getOlMap().getLayerGroup().on('change', this._boundNotifyRepaintRequired);\n  }\n\n  /**\n   * Disable.\n   */\n  disable() {\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.removeEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.removeEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    this.ol3d.getOlMap().getLayerGroup().un('change', this._boundNotifyRepaintRequired);\n    this.scene_.requestRenderMode = false;\n  }\n\n  /**\n   * Restart render loop.\n   * Force a restart of the render loop.\n   */\n  restartRenderLoop() {\n    this.notifyRepaintRequired();\n  }\n\n  notifyRepaintRequired() {\n    this.scene_.requestRender();\n  }\n}\n","import {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport {toRadians, toDegrees} from './math';\nimport {getTransform} from 'ol/proj.js';\nimport {pickCenterPoint, calcDistanceForResolution, calcResolutionForDistance} from './core';\nimport type {Map, View} from 'ol';\nimport type {Scene, Camera as CesiumCamera, Matrix4, HeadingPitchRollValues} from 'cesium';\nimport type {EventsKey} from 'ol/events.js';\n\n/**\n * @param input Input coordinate array.\n * @param opt_output Output array of coordinate values.\n * @param opt_dimension Dimension.\n * @return Input coordinate array (same array as input).\n */\nexport function identityProjection(input: number[], opt_output?: number[], opt_dimension?: number): number[] {\n  const dim = opt_dimension || input.length;\n  if (opt_output) {\n    for (let i = 0; i < dim; ++i) {\n      opt_output[i] = input[i];\n    }\n  }\n  return input;\n}\n\nexport default class Camera {\n  private scene_: Scene;\n  private cam_: CesiumCamera;\n  private map_: Map;\n  private view_: View;\n\n  private viewListenKey_: EventsKey = null;\n\n  private toLonLat_ = identityProjection;\n  private fromLonLat_ = identityProjection;\n\n  /**\n   * 0 -- topdown, PI/2 -- the horizon\n   */\n  private tilt_: number = 0;\n  private distance_ = 0;\n  private lastCameraViewMatrix_: Matrix4 = null;\n\n  /**\n   * This is used to discard change events on view caused by updateView method.\n   */\n  private viewUpdateInProgress_ = false;\n\n  /**\n   * This object takes care of additional 3d-specific properties of the view and\n   * ensures proper synchronization with the underlying raw Cesium.Camera object.\n   */\n  constructor(scene: Scene, map: Map) {\n    this.scene_ = scene;\n    this.cam_ = scene.camera;\n    this.map_ = map;\n    this.map_.on('change:view', (e) => {\n      this.setView_(this.map_.getView());\n    });\n    this.setView_(this.map_.getView());\n  }\n\n  destroy() {\n    olObservableUnByKey(this.viewListenKey_);\n    this.viewListenKey_ = null;\n  }\n\n  /**\n   * @param {?ol.View} view New view to use.\n   * @private\n   */\n  setView_(view: View | undefined) {\n    if (this.view_) {\n      olObservableUnByKey(this.viewListenKey_);\n      this.viewListenKey_ = null;\n    }\n\n    this.view_ = view;\n    if (view) {\n      const toLonLat = getTransform(view.getProjection(), 'EPSG:4326');\n      const fromLonLat = getTransform('EPSG:4326', view.getProjection());\n      console.assert(toLonLat && fromLonLat);\n\n      this.toLonLat_ = toLonLat;\n      this.fromLonLat_ = fromLonLat;\n\n      this.viewListenKey_ = view.on('propertychange', e => this.handleViewChangedEvent_());\n\n      this.readFromView();\n    } else {\n      this.toLonLat_ = identityProjection;\n      this.fromLonLat_ = identityProjection;\n    }\n  }\n\n  private handleViewChangedEvent_() {\n    if (!this.viewUpdateInProgress_) {\n      this.readFromView();\n    }\n  }\n\n  /**\n   * @deprecated\n   * @param heading In radians.\n   */\n  setHeading(heading: number) {\n    if (!this.view_) {\n      return;\n    }\n\n    this.view_.setRotation(heading);\n  }\n\n  /**\n   * @deprecated\n   * @return Heading in radians.\n   */\n  getHeading(): number|undefined {\n    if (!this.view_) {\n      return undefined;\n    }\n    const rotation = this.view_.getRotation();\n    return rotation || 0;\n  }\n\n  /**\n   * @param tilt In radians.\n   */\n  setTilt(tilt: number) {\n    this.tilt_ = tilt;\n    this.updateCamera_();\n  }\n\n  /**\n   * @return Tilt in radians.\n   */\n  getTilt(): number {\n    return this.tilt_;\n  }\n\n  /**\n   * @param distance In meters.\n   */\n  setDistance(distance: number) {\n    this.distance_ = distance;\n    this.updateCamera_();\n    this.updateView();\n  }\n\n  /**\n   * @return Distance in meters.\n   */\n  getDistance(): number {\n    return this.distance_;\n  }\n\n  /**\n   * @deprecated\n   * Shortcut for ol.View.setCenter().\n   * @param center Same projection as the ol.View.\n   */\n  setCenter(center: number[]) {\n    if (!this.view_) {\n      return;\n    }\n    this.view_.setCenter(center);\n  }\n\n  /**\n   * @deprecated\n   * Shortcut for ol.View.getCenter().\n   * @return {ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getCenter() {\n    if (!this.view_) {\n      return undefined;\n    }\n    return this.view_.getCenter();\n  }\n\n  /**\n   * Sets the position of the camera.\n   * @param position Same projection as the ol.View.\n   */\n  setPosition(position: number[]) {\n    if (!this.toLonLat_) {\n      return;\n    }\n    const ll = this.toLonLat_(position);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(\n        toRadians(ll[0]),\n        toRadians(ll[1]),\n        this.getAltitude());\n\n    this.cam_.setView({\n      destination: Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto)\n    });\n    this.updateView();\n  }\n\n  /**\n   * Calculates position under the camera.\n   * @return Coordinates in same projection as the ol.View.\n   * @api\n   */\n  getPosition(): number[] | undefined {\n    if (!this.fromLonLat_) {\n      return undefined;\n    }\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);\n\n    const pos = this.fromLonLat_([\n      toDegrees(carto.longitude),\n      toDegrees(carto.latitude)\n    ]);\n    console.assert(pos);\n    return pos;\n  }\n\n  /**\n   * @param altitude In meters.\n   */\n  setAltitude(altitude: number) {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n    carto.height = altitude;\n    this.cam_.position = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    this.updateView();\n  }\n\n  /**\n   * @return Altitude in meters.\n   */\n  getAltitude(): number {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n\n    return carto.height;\n  }\n\n  /**\n   * Updates the state of the underlying Cesium.Camera\n   * according to the current values of the properties.\n   */\n  private updateCamera_() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (!center) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(toRadians(ll[0]),\n        toRadians(ll[1]));\n    if (this.scene_.globe) {\n      const height = this.scene_.globe.getHeight(carto);\n      carto.height = height || 0;\n    }\n\n    const destination = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    const orientation: HeadingPitchRollValues = {\n      pitch: this.tilt_ - Cesium.Math.PI_OVER_TWO,\n      heading: -this.view_.getRotation(),\n      roll: undefined\n    };\n    this.cam_.setView({\n      destination,\n      orientation\n    });\n\n    this.cam_.moveBackward(this.distance_);\n\n    this.checkCameraChange(true);\n  }\n\n  /**\n   * Calculates the values of the properties from the current ol.View state.\n   */\n  readFromView() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (center === undefined || center === null) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const resolution = this.view_.getResolution();\n    this.distance_ = this.calcDistanceForResolution(\n        resolution || 0, toRadians(ll[1]));\n\n    this.updateCamera_();\n  }\n\n  /**\n   * Calculates the values of the properties from the current Cesium.Camera state.\n   * Modifies the center, resolution and rotation properties of the view.\n   */\n  updateView() {\n    if (!this.view_ || !this.fromLonLat_) {\n      return;\n    }\n    this.viewUpdateInProgress_ = true;\n\n    // target & distance\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const scene = this.scene_;\n    const target = pickCenterPoint(scene);\n\n    let bestTarget = target;\n    if (!bestTarget) {\n      //TODO: how to handle this properly ?\n      const globe = scene.globe;\n      const carto = this.cam_.positionCartographic.clone();\n      const height = globe.getHeight(carto);\n      carto.height = height || 0;\n      bestTarget = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n    }\n    this.distance_ = Cesium.Cartesian3.distance(bestTarget, this.cam_.position);\n    const bestTargetCartographic = ellipsoid.cartesianToCartographic(bestTarget);\n    this.view_.setCenter(this.fromLonLat_([\n      toDegrees(bestTargetCartographic.longitude),\n      toDegrees(bestTargetCartographic.latitude)]));\n\n    // resolution\n    this.view_.setResolution(\n        this.calcResolutionForDistance(this.distance_,\n            bestTargetCartographic ? bestTargetCartographic.latitude : 0));\n\n\n    /*\n     * Since we are positioning the target, the values of heading and tilt\n     * need to be calculated _at the target_.\n     */\n    if (target) {\n      const pos = this.cam_.position;\n\n      // normal to the ellipsoid at the target\n      const targetNormal = new Cesium.Cartesian3();\n      ellipsoid.geocentricSurfaceNormal(target, targetNormal);\n\n      // vector from the target to the camera\n      const targetToCamera = new Cesium.Cartesian3();\n      Cesium.Cartesian3.subtract(pos, target, targetToCamera);\n      Cesium.Cartesian3.normalize(targetToCamera, targetToCamera);\n\n\n      // HEADING\n      const up = this.cam_.up;\n      const right = this.cam_.right;\n      const normal = new Cesium.Cartesian3(-target.y, target.x, 0); // what is it?\n      const heading = Cesium.Cartesian3.angleBetween(right, normal);\n      const cross = Cesium.Cartesian3.cross(target, up, new Cesium.Cartesian3());\n      const orientation = cross.z;\n\n      this.view_.setRotation((orientation < 0 ? heading : -heading));\n\n      // TILT\n      const tiltAngle = Math.acos(\n          Cesium.Cartesian3.dot(targetNormal, targetToCamera));\n      this.tilt_ = isNaN(tiltAngle) ? 0 : tiltAngle;\n    } else {\n      // fallback when there is no target\n      this.view_.setRotation(this.cam_.heading);\n      this.tilt_ = -this.cam_.pitch + Math.PI / 2;\n    }\n\n    this.viewUpdateInProgress_ = false;\n  }\n\n  /**\n   * Check if the underlying camera state has changed and ensure synchronization.\n   * @param opt_dontSync Do not synchronize the view.\n   */\n  checkCameraChange(opt_dontSync?: boolean) {\n    const old = this.lastCameraViewMatrix_;\n    const current = this.cam_.viewMatrix;\n\n    if (!old || !Cesium.Matrix4.equalsEpsilon(old, current, 1e-7)) {\n      this.lastCameraViewMatrix_ = current.clone();\n      if (opt_dontSync !== true) {\n        this.updateView();\n      }\n    }\n  }\n\n  /**\n   * calculate the distance between camera and centerpoint based on the resolution and latitude value\n   * @param resolution Number of map units per pixel.\n   * @param latitude Latitude in radians.\n   * @return The calculated distance.\n   */\n  calcDistanceForResolution(resolution: number, latitude: number): number {\n    return calcDistanceForResolution(resolution, latitude, this.scene_, this.view_.getProjection());\n  }\n\n  /**\n   * calculate the resolution based on a distance(camera to position) and latitude value\n   * @param distance\n   * @param latitude\n   * @return} The calculated resolution.\n   */\n  calcResolutionForDistance(distance: number, latitude: number): number {\n    return calcResolutionForDistance(distance, latitude, this.scene_, this.view_.getProjection());\n  }\n}\n","import OLStyleIcon from 'ol/style/Icon.js';\nimport VectorSource, {type VectorSourceEvent} from 'ol/source/Vector.js';\nimport OLClusterSource from 'ol/source/Cluster.js';\nimport {circular as olCreateCircularPolygon} from 'ol/geom/Polygon.js';\nimport {boundingExtent, getCenter} from 'ol/extent.js';\nimport olGeomSimpleGeometry from 'ol/geom/SimpleGeometry.js';\nimport {convertColorToCesium, olGeometryCloneTo4326, ol4326CoordinateToCesiumCartesian, ol4326CoordinateArrayToCsCartesians} from './core';\nimport VectorLayerCounterpart, {type OlFeatureToCesiumContext} from './core/VectorLayerCounterpart';\nimport {getUid, waitReady} from './util';\nimport type {CircleGeometry, CircleOutlineGeometry, Primitive, Billboard, Label, Matrix4, Scene, Geometry as CSGeometry, Color as CSColor, GroundPrimitive, PrimitiveCollection, ImageMaterialProperty, BillboardCollection, Cartesian3, GroundPolylinePrimitive, PolygonHierarchy, HeightReference, Model, LabelCollection, Material} from 'cesium';\nimport type VectorLayer from 'ol/layer/Vector.js';\nimport type ImageLayer from 'ol/layer/Image.js';\nimport type {Feature, View} from 'ol';\nimport type Text from 'ol/style/Text.js';\nimport {type default as Style, type StyleFunction} from 'ol/style/Style.js';\nimport type {ColorLike as OLColorLike} from 'ol/colorlike.js';\nimport type {Color as OLColor} from 'ol/color.js';\nimport type {ProjectionLike} from 'ol/proj.js';\nimport {Geometry as OLGeometry, type MultiLineString, type MultiPolygon, type MultiPoint, type GeometryCollection, type Circle, type LineString, type Point, type Polygon} from 'ol/geom.js';\nimport type ImageStyle from 'ol/style/Image.js';\n\n\ntype ModelFromGltfOptions = Parameters<typeof Model.fromGltfAsync>[0];\n\ntype PrimitiveLayer = VectorLayer<any> | ImageLayer<any>;\n\ndeclare module 'cesium' {\n  // eslint-disable-next-line no-unused-vars\n  interface Primitive {\n    olLayer: PrimitiveLayer;\n    olFeature: Feature;\n  }\n  // eslint-disable-next-line no-unused-vars\n  interface GroundPolylinePrimitive {\n    olLayer: PrimitiveLayer;\n    olFeature: Feature;\n    _primitive: Primitive; // Missing from types published by Cesium\n  }\n  // eslint-disable-next-line no-unused-vars\n  interface GroundPrimitive {\n    olLayer: PrimitiveLayer;\n    olFeature: Feature;\n  }\n  // eslint-disable-next-line no-unused-vars\n  interface Label {\n    olLayer: PrimitiveLayer;\n    olFeature: Feature;\n  }\n  // eslint-disable-next-line no-unused-vars\n  interface Billboard {\n    olLayer: PrimitiveLayer;\n    olFeature: Feature;\n  }\n}\n\ninterface ModelStyle {\n  debugModelMatrix?: Matrix4;\n  cesiumOptions: ModelFromGltfOptions;\n}\n\ninterface MaterialAppearanceOptions {\n  flat: boolean;\n  renderState: {\n    depthTest: {\n      enabled: boolean;\n    },\n    lineWidth?: number;\n  }\n}\n\nexport default class FeatureConverter {\n\n  /**\n   * Bind once to have a unique function for using as a listener\n   */\n  private boundOnRemoveOrClearFeatureListener_ = this.onRemoveOrClearFeature_.bind(this);\n\n  private defaultBillboardEyeOffset_ = new Cesium.Cartesian3(0, 0, 10);\n\n  /**\n   * Concrete base class for converting from OpenLayers3 vectors to Cesium\n   * primitives.\n   * Extending this class is possible provided that the extending class and\n   * the library are compiled together by the closure compiler.\n   * @param scene Cesium scene.\n   * @api\n   */\n  constructor(protected scene: Scene) {\n    this.scene = scene;\n  }\n\n  /**\n   * @param evt\n   */\n  private onRemoveOrClearFeature_(evt: VectorSourceEvent) {\n    const source = evt.target;\n    console.assert(source instanceof VectorSource);\n\n    const cancellers = source['olcs_cancellers'];\n    if (cancellers) {\n      const feature = evt.feature;\n      if (feature) {\n        // remove\n        const id = getUid(feature);\n        const canceller = cancellers[id];\n        if (canceller) {\n          canceller();\n          delete cancellers[id];\n        }\n      } else {\n        // clear\n        for (const key in cancellers) {\n          if (cancellers.hasOwnProperty(key)) {\n            cancellers[key]();\n          }\n        }\n        source['olcs_cancellers'] = {};\n      }\n    }\n  }\n\n  /**\n   * @param layer\n   * @param feature OpenLayers feature.\n   * @param primitive\n   */\n  protected setReferenceForPicking(layer: PrimitiveLayer, feature: Feature, primitive: GroundPolylinePrimitive | GroundPrimitive | Primitive| Label|Billboard) {\n    primitive.olLayer = layer;\n    primitive.olFeature = feature;\n  }\n\n  /**\n   * Basics primitive creation using a color attribute.\n   * Note that Cesium has 'interior' and outline geometries.\n   * @param layer\n   * @param feature OpenLayers feature.\n   * @param olGeometry OpenLayers geometry.\n   * @param geometry\n   * @param color\n   * @param opt_lineWidth\n   * @return primitive\n   */\n  protected createColoredPrimitive(layer: PrimitiveLayer, feature: Feature, olGeometry: OLGeometry, geometry: CSGeometry | CircleGeometry, color: CSColor| ImageMaterialProperty, opt_lineWidth?: number): Primitive | GroundPrimitive {\n    const createInstance = function(geometry: CSGeometry | CircleGeometry, color: CSColor | ImageMaterialProperty) {\n      const instance = new Cesium.GeometryInstance({\n        geometry\n      });\n      if (color && !(color instanceof Cesium.ImageMaterialProperty)) {\n        instance.attributes = {\n          color: Cesium.ColorGeometryInstanceAttribute.fromColor(color)\n        };\n      }\n      return instance;\n    };\n\n    const options: MaterialAppearanceOptions = {\n      flat: true, // work with all geometries\n      renderState: {\n        depthTest: {\n          enabled: true\n        }\n      }\n    };\n\n    if (opt_lineWidth !== undefined) {\n      options.renderState.lineWidth = opt_lineWidth;\n    }\n\n    const instances = createInstance(geometry, color);\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let primitive: GroundPrimitive | Primitive;\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      if (!('createShadowVolume' in instances.geometry.constructor)) {\n        // This is not a ground geometry\n        return null;\n      }\n      primitive = new Cesium.GroundPrimitive({\n        geometryInstances: instances\n      });\n    } else {\n      primitive = new Cesium.Primitive({\n        geometryInstances: instances\n      });\n    }\n\n    if (color instanceof Cesium.ImageMaterialProperty) {\n      // FIXME: we created stylings which are not time related\n      // What should we pass here?\n      // @ts-ignore\n      const dataUri = color.image.getValue().toDataURL();\n\n      primitive.appearance = new Cesium.MaterialAppearance({\n        flat: true,\n        renderState: {\n          depthTest: {\n            enabled: true,\n          }\n        },\n        material: new Cesium.Material({\n          fabric: {\n            type: 'Image',\n            uniforms: {\n              image: dataUri\n            }\n          }\n        })\n      });\n    } else {\n      primitive.appearance = new Cesium.MaterialAppearance({\n        ...options,\n        material: new Cesium.Material({\n          translucent: color.alpha !== 1,\n          fabric: {\n            type: 'Color',\n            uniforms: {\n              color,\n            }\n          }\n        })\n      });\n      if (primitive instanceof Cesium.Primitive && (feature.get('olcs_shadows') || layer.get('olcs_shadows'))) {\n        primitive.shadows = 1;\n      }\n    }\n    this.setReferenceForPicking(layer, feature, primitive);\n    return primitive;\n  }\n\n  /**\n   * Return the fill or stroke color from a plain ol style.\n   * @param style\n   * @param outline\n   * @return {!CSColor}\n   */\n  protected extractColorFromOlStyle(style: Style | Text, outline: boolean) {\n    const fillColor = style.getFill() ? style.getFill().getColor() : null;\n    const strokeColor = style.getStroke() ? style.getStroke().getColor() : null;\n\n    let olColor: OLColorLike | OLColor = 'black';\n    if (strokeColor && outline) {\n      olColor = strokeColor;\n    } else if (fillColor) {\n      olColor = fillColor;\n    }\n\n    return convertColorToCesium(olColor);\n  }\n\n  /**\n   * Return the width of stroke from a plain ol style.\n   * @param style\n   * @return {number}\n   */\n  protected extractLineWidthFromOlStyle(style: Style | Text) {\n    // Handling of line width WebGL limitations is handled by Cesium.\n    const width = style.getStroke() ? style.getStroke().getWidth() : undefined;\n    return width !== undefined ? width : 1;\n  }\n\n  /**\n   * Create a primitive collection out of two Cesium geometries.\n   * Only the OpenLayers style colors will be used.\n   */\n  protected wrapFillAndOutlineGeometries(layer: PrimitiveLayer, feature: Feature, olGeometry: OLGeometry, fillGeometry: CSGeometry | CircleGeometry, outlineGeometry: CSGeometry | CircleOutlineGeometry, olStyle: Style): PrimitiveCollection {\n    const fillColor = this.extractColorFromOlStyle(olStyle, false);\n    const outlineColor = this.extractColorFromOlStyle(olStyle, true);\n\n    const primitives = new Cesium.PrimitiveCollection();\n    if (olStyle.getFill()) {\n      const p1 = this.createColoredPrimitive(layer, feature, olGeometry,\n          fillGeometry, fillColor);\n      console.assert(!!p1);\n      primitives.add(p1);\n    }\n\n    if (olStyle.getStroke() && outlineGeometry) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      const p2 = this.createColoredPrimitive(layer, feature, olGeometry,\n          outlineGeometry, outlineColor, width);\n      if (p2) {\n        // Some outline geometries are not supported by Cesium in clamp to ground\n        // mode. These primitives are skipped.\n        primitives.add(p2);\n      }\n    }\n\n    return primitives;\n  }\n\n  // Geometry converters\n\n  // FIXME: would make more sense to only accept primitive collection.\n  /**\n   * Create a Cesium primitive if style has a text component.\n   * Eventually return a PrimitiveCollection including current primitive.\n   */\n  protected addTextStyle(layer: PrimitiveLayer, feature: Feature, geometry: OLGeometry, style: Style, primitive: Primitive | PrimitiveCollection | GroundPolylinePrimitive): PrimitiveCollection {\n    let primitives;\n    if (!(primitive instanceof Cesium.PrimitiveCollection)) {\n      primitives = new Cesium.PrimitiveCollection();\n      primitives.add(primitive);\n    } else {\n      primitives = primitive;\n    }\n\n    if (!style.getText()) {\n      return primitives;\n    }\n\n    const text = /** @type {!ol.style.Text} */ (style.getText());\n    const label = this.olGeometry4326TextPartToCesium(layer, feature, geometry,\n        text);\n    if (label) {\n      primitives.add(label);\n    }\n    return primitives;\n  }\n\n  /**\n   * Add a billboard to a Cesium.BillboardCollection.\n   * Overriding this wrapper allows manipulating the billboard options.\n   * @param billboards\n   * @param bbOptions\n   * @param layer\n   * @param feature OpenLayers feature.\n   * @param geometry\n   * @param style\n   * @return newly created billboard\n   * @api\n   */\n  csAddBillboard(billboards: BillboardCollection, bbOptions: Parameters<BillboardCollection['add']>[0], layer: PrimitiveLayer, feature: Feature, geometry: OLGeometry, style: Style): Billboard {\n    if (!bbOptions.eyeOffset) {\n      bbOptions.eyeOffset = this.defaultBillboardEyeOffset_;\n    }\n    const bb = billboards.add(bbOptions);\n    this.setReferenceForPicking(layer, feature, bb);\n    return bb;\n  }\n\n  /**\n   * Convert an OpenLayers circle geometry to Cesium.\n   * @api\n   */\n  olCircleGeometryToCesium(layer: PrimitiveLayer, feature: Feature, olGeometry: Circle, projection: ProjectionLike, olStyle: Style): PrimitiveCollection {\n\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Circle');\n\n    // ol.Coordinate\n    const olCenter = olGeometry.getCenter();\n    const height = olCenter.length == 3 ? olCenter[2] : 0.0;\n    const olPoint = olCenter.slice();\n    olPoint[0] += olGeometry.getRadius();\n\n    // Cesium\n    const center: Cartesian3 = ol4326CoordinateToCesiumCartesian(olCenter);\n    const point: Cartesian3 = ol4326CoordinateToCesiumCartesian(olPoint);\n\n    // Accurate computation of straight distance\n    const radius = Cesium.Cartesian3.distance(center, point);\n\n    const fillGeometry = new Cesium.CircleGeometry({\n      center,\n      radius,\n      height\n    });\n\n    let outlinePrimitive: Primitive | GroundPrimitive | GroundPolylinePrimitive;\n    let outlineGeometry;\n    if (this.getHeightReference(layer, feature, olGeometry) === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      if (width) {\n        const circlePolygon = olCreateCircularPolygon(olGeometry.getCenter(), radius);\n        const positions = ol4326CoordinateArrayToCsCartesians(circlePolygon.getLinearRing(0).getCoordinates());\n        const op = outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n          geometryInstances: new Cesium.GeometryInstance({\n            geometry: new Cesium.GroundPolylineGeometry({positions, width}),\n          }),\n          appearance: new Cesium.PolylineMaterialAppearance({\n            material: this.olStyleToCesium(feature, olStyle, true),\n          }),\n          classificationType: Cesium.ClassificationType.TERRAIN,\n        });\n        waitReady(outlinePrimitive).then(() => {\n          this.setReferenceForPicking(layer, feature, op._primitive);\n        });\n      }\n    } else {\n      outlineGeometry = new Cesium.CircleOutlineGeometry({\n        center,\n        radius,\n        extrudedHeight: height,\n        height\n      });\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n\n  /**\n   * Convert an OpenLayers line string geometry to Cesium.\n   * @api\n   */\n  olLineStringGeometryToCesium(layer: PrimitiveLayer, feature: Feature, olGeometry: LineString, projection: ProjectionLike, olStyle: Style): PrimitiveCollection {\n\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'LineString');\n\n    const positions = ol4326CoordinateArrayToCsCartesians(olGeometry.getCoordinates());\n    const width = this.extractLineWidthFromOlStyle(olStyle);\n\n    let outlinePrimitive: Primitive | GroundPolylinePrimitive;\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    const appearance = new Cesium.PolylineMaterialAppearance({\n      material: this.olStyleToCesium(feature, olStyle, true)\n    });\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const geometry = new Cesium.GroundPolylineGeometry({\n        positions,\n        width,\n      });\n      const op = outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n        appearance,\n        geometryInstances: new Cesium.GeometryInstance({\n          geometry\n        })\n      });\n      waitReady(outlinePrimitive).then(() => {\n        this.setReferenceForPicking(layer, feature, op._primitive);\n      });\n    } else {\n      const geometry = new Cesium.PolylineGeometry({\n        positions,\n        width,\n        vertexFormat: appearance.vertexFormat\n      });\n      outlinePrimitive = new Cesium.Primitive({\n        appearance,\n        geometryInstances: new Cesium.GeometryInstance({\n          geometry\n        }),\n      });\n    }\n\n    this.setReferenceForPicking(layer, feature, outlinePrimitive);\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, outlinePrimitive);\n  }\n\n  /**\n   * Convert an OpenLayers polygon geometry to Cesium.\n   * @api\n   */\n  olPolygonGeometryToCesium(layer: PrimitiveLayer, feature: Feature, olGeometry: Polygon, projection: ProjectionLike, olStyle: Style): PrimitiveCollection {\n\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Polygon');\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let fillGeometry, outlineGeometry;\n    let outlinePrimitive: GroundPolylinePrimitive;\n    if ((olGeometry.getCoordinates()[0].length == 5) &&\n        (feature.get('olcs.polygon_kind') === 'rectangle')) {\n      // Create a rectangle according to the longitude and latitude curves\n      const coordinates = olGeometry.getCoordinates()[0];\n      // Extract the West, South, East, North coordinates\n      const extent = boundingExtent(coordinates);\n      const rectangle = Cesium.Rectangle.fromDegrees(extent[0], extent[1],\n          extent[2], extent[3]);\n\n      // Extract the average height of the vertices\n      let maxHeight = 0.0;\n      if (coordinates[0].length == 3) {\n        for (let c = 0; c < coordinates.length; c++) {\n          maxHeight = Math.max(maxHeight, coordinates[c][2]);\n        }\n      }\n\n      const featureExtrudedHeight = feature.get('olcs_extruded_height');\n\n      // Render the cartographic rectangle\n      fillGeometry = new Cesium.RectangleGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight,\n        extrudedHeight: featureExtrudedHeight,\n      });\n\n      outlineGeometry = new Cesium.RectangleOutlineGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight,\n        extrudedHeight: featureExtrudedHeight,\n      });\n    } else {\n      const rings = olGeometry.getLinearRings();\n      const hierarchy: PolygonHierarchy = {\n        positions: [],\n        holes: [],\n      };\n      const polygonHierarchy: PolygonHierarchy = hierarchy;\n      console.assert(rings.length > 0);\n\n      for (let i = 0; i < rings.length; ++i) {\n        const olPos = rings[i].getCoordinates();\n        const positions = ol4326CoordinateArrayToCsCartesians(olPos);\n        console.assert(positions && positions.length > 0);\n        if (i === 0) {\n          hierarchy.positions = positions;\n        } else {\n          hierarchy.holes.push({\n            positions,\n            holes: [],\n          });\n        }\n      }\n\n      const featureExtrudedHeight = feature.get('olcs_extruded_height');\n\n      fillGeometry = new Cesium.PolygonGeometry({\n        polygonHierarchy,\n        perPositionHeight: true,\n        extrudedHeight: featureExtrudedHeight,\n      });\n\n      // Since Cesium doesn't yet support Polygon outlines on terrain yet (coming soon...?)\n      // we don't create an outline geometry if clamped, but instead do the polyline method\n      // for each ring. Most of this code should be removeable when Cesium adds\n      // support for Polygon outlines on terrain.\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const width = this.extractLineWidthFromOlStyle(olStyle);\n        if (width > 0) {\n          const positions: Cartesian3[][] = [hierarchy.positions];\n          if (hierarchy.holes) {\n            for (let i = 0; i < hierarchy.holes.length; ++i) {\n              positions.push(hierarchy.holes[i].positions);\n            }\n          }\n          const appearance = new Cesium.PolylineMaterialAppearance({\n            material: this.olStyleToCesium(feature, olStyle, true)\n          });\n          const geometryInstances = [];\n          for (const linePositions of positions) {\n            const polylineGeometry = new Cesium.GroundPolylineGeometry({positions: linePositions, width});\n            geometryInstances.push(new Cesium.GeometryInstance({\n              geometry: polylineGeometry\n            }));\n          }\n          outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n            appearance,\n            geometryInstances\n          });\n          waitReady(outlinePrimitive).then(() => {\n            this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n          });\n        }\n      } else {\n        // Actually do the normal polygon thing. This should end the removable\n        // section of code described above.\n        outlineGeometry = new Cesium.PolygonOutlineGeometry({\n          polygonHierarchy: hierarchy,\n          perPositionHeight: true,\n          extrudedHeight: featureExtrudedHeight,\n        });\n      }\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @api\n   */\n  getHeightReference(layer: PrimitiveLayer, feature: Feature, geometry: OLGeometry): HeightReference {\n\n    // Read from the geometry\n    let altitudeMode = geometry.get('altitudeMode');\n\n    // Or from the feature\n    if (altitudeMode === undefined) {\n      altitudeMode = feature.get('altitudeMode');\n    }\n\n    // Or from the layer\n    if (altitudeMode === undefined) {\n      altitudeMode = layer.get('altitudeMode');\n    }\n\n    let heightReference = Cesium.HeightReference.NONE;\n    if (altitudeMode === 'clampToGround') {\n      heightReference = Cesium.HeightReference.CLAMP_TO_GROUND;\n    } else if (altitudeMode === 'relativeToGround') {\n      heightReference = Cesium.HeightReference.RELATIVE_TO_GROUND;\n    }\n\n    return heightReference;\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!ol.style.Image} imageStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when the new billboard is added.\n   * @api\n   */\n  createBillboardFromImage(\n      layer: PrimitiveLayer,\n      feature: Feature,\n      olGeometry: Point,\n      projection: ProjectionLike,\n      style: Style,\n      imageStyle: ImageStyle,\n      billboards: BillboardCollection,\n      opt_newBillboardCallback: (bb: Billboard) => void,\n  ) {\n    if (imageStyle instanceof OLStyleIcon) {\n      // make sure the image is scheduled for load\n      imageStyle.load();\n    }\n\n    const image = imageStyle.getImage(1); // get normal density\n    const isImageLoaded = function(image: HTMLImageElement) {\n      return image.src != '' &&\n          image.naturalHeight != 0 &&\n          image.naturalWidth != 0 &&\n          image.complete;\n    };\n    const reallyCreateBillboard = (function() {\n      if (!image) {\n        return;\n      }\n      if (!(image instanceof HTMLCanvasElement ||\n          image instanceof Image ||\n          image instanceof HTMLImageElement)) {\n        return;\n      }\n      const center = olGeometry.getCoordinates();\n      const position = ol4326CoordinateToCesiumCartesian(center);\n      let color;\n      const opacity = imageStyle.getOpacity();\n      if (opacity !== undefined) {\n        color = new Cesium.Color(1.0, 1.0, 1.0, opacity);\n      }\n\n      const scale = imageStyle.getScale();\n      const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n      const bbOptions: Parameters<BillboardCollection['add']>[0] = {\n        image,\n        color,\n        scale,\n        heightReference,\n        position\n      };\n\n      // merge in cesium options from openlayers feature\n      Object.assign(bbOptions, feature.get('cesiumOptions'));\n\n      if (imageStyle instanceof OLStyleIcon) {\n        const anchor = imageStyle.getAnchor();\n        if (anchor) {\n          const xScale = (Array.isArray(scale) ? scale[0] : scale);\n          const yScale = (Array.isArray(scale) ? scale[1] : scale);\n          bbOptions.pixelOffset = new Cesium.Cartesian2(\n              (image.width / 2 - anchor[0]) * xScale,\n              (image.height / 2 - anchor[1]) * yScale\n          );\n        }\n      }\n\n      const bb = this.csAddBillboard(billboards, bbOptions, layer, feature, olGeometry, style);\n      if (opt_newBillboardCallback) {\n        opt_newBillboardCallback(bb);\n      }\n    }).bind(this);\n\n    if (image instanceof Image && !isImageLoaded(image)) {\n      // Cesium requires the image to be loaded\n      let cancelled = false;\n      const source = layer.getSource();\n      const canceller = function() {\n        cancelled = true;\n      };\n      source.on(['removefeature', 'clear'],\n          this.boundOnRemoveOrClearFeatureListener_);\n      let cancellers = source['olcs_cancellers'];\n      if (!cancellers) {\n        cancellers = source['olcs_cancellers'] = {};\n      }\n\n      const fuid = getUid(feature);\n      if (cancellers[fuid]) {\n        // When the feature change quickly, a canceller may still be present so\n        // we cancel it here to prevent creation of a billboard.\n        cancellers[fuid]();\n      }\n      cancellers[fuid] = canceller;\n\n      const listener = function() {\n        image.removeEventListener('load', listener);\n        if (!billboards.isDestroyed() && !cancelled) {\n          // Create billboard if the feature is still displayed on the map.\n          reallyCreateBillboard();\n        }\n      };\n\n      image.addEventListener('load', listener);\n    } else {\n      reallyCreateBillboard();\n    }\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param layer\n   * @param feature OpenLayers feature..\n   * @param olGeometry OpenLayers point geometry.\n   * @param projection\n   * @param style\n   * @param billboards\n   * @param opt_newBillboardCallback Called when the new billboard is added.\n   * @return primitives\n   * @api\n   */\n  olPointGeometryToCesium(\n      layer: PrimitiveLayer,\n      feature: Feature,\n      olGeometry: Point,\n      projection: ProjectionLike,\n      style: Style,\n      billboards: BillboardCollection,\n      opt_newBillboardCallback?: (bb: Billboard) => void\n  ): PrimitiveCollection {\n    console.assert(olGeometry.getType() == 'Point');\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n\n    let modelPrimitive: PrimitiveCollection = null;\n    const imageStyle = style.getImage();\n    if (imageStyle) {\n      const olcsModelFunction: () => ModelStyle = olGeometry.get('olcs_model') || feature.get('olcs_model');\n      if (olcsModelFunction) {\n        modelPrimitive = new Cesium.PrimitiveCollection();\n        const olcsModel = olcsModelFunction();\n        const options: ModelFromGltfOptions = Object.assign({}, {scene: this.scene}, olcsModel.cesiumOptions);\n        if ('fromGltf' in Cesium.Model) {\n          // pre Cesium v107\n          // @ts-ignore\n          const model = Cesium.Model.fromGltf(options);\n          modelPrimitive.add(model);\n        } else {\n          Cesium.Model.fromGltfAsync(options).then((model) => {\n            modelPrimitive.add(model);\n          });\n        }\n\n        if (olcsModel.debugModelMatrix) {\n          modelPrimitive.add(new Cesium.DebugModelMatrixPrimitive({\n            modelMatrix: olcsModel.debugModelMatrix\n          }));\n        }\n      } else {\n        this.createBillboardFromImage(layer, feature, olGeometry, projection, style, imageStyle, billboards, opt_newBillboardCallback);\n      }\n    }\n\n    if (style.getText()) {\n      return this.addTextStyle(layer, feature, olGeometry, style, modelPrimitive || new Cesium.Primitive());\n    } else {\n      return modelPrimitive;\n    }\n  }\n\n  /**\n   * Convert an OpenLayers multi-something geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry OpenLayers geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olMultiGeometryToCesium(\n      layer: PrimitiveLayer,\n      feature: Feature,\n      geometry: OLGeometry,\n      projection: ProjectionLike,\n      olStyle: Style,\n      billboards: BillboardCollection,\n      opt_newBillboardCallback: (bb: Billboard) => void\n  ) {\n    // Do not reproject to 4326 now because it will be done later.\n\n    switch (geometry.getType()) {\n      case 'MultiPoint': {\n        const points = (geometry as MultiPoint).getPoints();\n        if (olStyle.getText()) {\n          const primitives = new Cesium.PrimitiveCollection();\n          points.forEach((geom) => {\n            console.assert(geom);\n            const result = this.olPointGeometryToCesium(layer, feature, geom,\n                projection, olStyle, billboards, opt_newBillboardCallback);\n            if (result) {\n              primitives.add(result);\n            }\n          });\n          return primitives;\n        } else {\n          points.forEach((geom) => {\n            console.assert(geom);\n            this.olPointGeometryToCesium(layer, feature, geom, projection,\n                olStyle, billboards, opt_newBillboardCallback);\n          });\n          return null;\n        }\n      }\n      case 'MultiLineString': {\n        const lineStrings = (geometry as MultiLineString).getLineStrings();\n        // FIXME: would be better to combine all child geometries in one primitive\n        // instead we create n primitives for simplicity.\n        const primitives = new Cesium.PrimitiveCollection();\n        lineStrings.forEach((geom) => {\n          const p = this.olLineStringGeometryToCesium(layer, feature, geom, projection, olStyle);\n          primitives.add(p);\n        });\n        return primitives;\n      }\n      case 'MultiPolygon': {\n        const polygons = (geometry as MultiPolygon).getPolygons();\n        // FIXME: would be better to combine all child geometries in one primitive\n        // instead we create n primitives for simplicity.\n        const primitives = new Cesium.PrimitiveCollection();\n        polygons.forEach((geom) => {\n          const p = this.olPolygonGeometryToCesium(layer, feature, geom, projection, olStyle);\n          primitives.add(p);\n        });\n        return primitives;\n      }\n      default:\n        console.assert(false, `Unhandled multi geometry type${geometry.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers text style to Cesium.\n   * @api\n   */\n  olGeometry4326TextPartToCesium(layer: PrimitiveLayer, feature: Feature, geometry: OLGeometry, style: Text): LabelCollection {\n    const text = style.getText();\n    if (!text) {\n      return null;\n    }\n\n    const labels = new Cesium.LabelCollection({scene: this.scene});\n    // TODO: export and use the text draw position from OpenLayers .\n    // See src/ol/render/vector.js\n    const extentCenter = getCenter(geometry.getExtent());\n    if (geometry instanceof olGeomSimpleGeometry) {\n      const first = geometry.getFirstCoordinate();\n      extentCenter[2] = first.length == 3 ? first[2] : 0.0;\n    }\n    const options: Parameters<LabelCollection['add']>[0] = {};\n\n    options.position = ol4326CoordinateToCesiumCartesian(extentCenter);\n\n    options.text = text;\n\n    options.heightReference = this.getHeightReference(layer, feature, geometry);\n\n    const offsetX = style.getOffsetX();\n    const offsetY = style.getOffsetY();\n    if (offsetX != 0 || offsetY != 0) {\n      const offset = new Cesium.Cartesian2(offsetX, offsetY);\n      options.pixelOffset = offset;\n    }\n\n    options.font = style.getFont() || '10px sans-serif'; // OpenLayers default\n\n    let labelStyle = undefined;\n    if (style.getFill()) {\n      options.fillColor = this.extractColorFromOlStyle(style, false);\n      labelStyle = Cesium.LabelStyle.FILL;\n    }\n    if (style.getStroke()) {\n      options.outlineWidth = this.extractLineWidthFromOlStyle(style);\n      options.outlineColor = this.extractColorFromOlStyle(style, true);\n      labelStyle = Cesium.LabelStyle.OUTLINE;\n    }\n    if (style.getFill() && style.getStroke()) {\n      labelStyle = Cesium.LabelStyle.FILL_AND_OUTLINE;\n    }\n    options.style = labelStyle;\n\n    let horizontalOrigin;\n    switch (style.getTextAlign()) {\n      case 'left':\n        horizontalOrigin = Cesium.HorizontalOrigin.LEFT;\n        break;\n      case 'right':\n        horizontalOrigin = Cesium.HorizontalOrigin.RIGHT;\n        break;\n      case 'center':\n      default:\n        horizontalOrigin = Cesium.HorizontalOrigin.CENTER;\n    }\n    options.horizontalOrigin = horizontalOrigin;\n\n    if (style.getTextBaseline()) {\n      let verticalOrigin;\n      switch (style.getTextBaseline()) {\n        case 'top':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'middle':\n          verticalOrigin = Cesium.VerticalOrigin.CENTER;\n          break;\n        case 'bottom':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        case 'alphabetic':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'hanging':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        default:\n          console.assert(false, `unhandled baseline ${style.getTextBaseline()}`);\n      }\n      options.verticalOrigin = verticalOrigin;\n    }\n\n\n    const l = labels.add(options);\n    this.setReferenceForPicking(layer, feature, l);\n    return labels;\n  }\n\n  /**\n   * Convert an OpenLayers style to a Cesium Material.\n   * @api\n   */\n  olStyleToCesium(feature: Feature, style: Style, outline: boolean): Material {\n    const fill = style.getFill();\n    const stroke = style.getStroke();\n    if ((outline && !stroke) || (!outline && !fill)) {\n      return null; // FIXME use a default style? Developer error?\n    }\n\n    const olColor = outline ? stroke.getColor() : fill.getColor();\n    const color = convertColorToCesium(olColor);\n\n    if (outline && stroke.getLineDash()) {\n      return Cesium.Material.fromType('Stripe', {\n        horizontal: false,\n        repeat: 500, // TODO how to calculate this?\n        evenColor: color,\n        oddColor: new Cesium.Color(0, 0, 0, 0) // transparent\n      });\n    } else {\n      return Cesium.Material.fromType('Color', {\n        color\n      });\n    }\n\n  }\n\n  /**\n   * Compute OpenLayers plain style.\n   * Evaluates style function, blend arrays, get default style.\n   * @api\n   */\n  computePlainStyle(layer: PrimitiveLayer, feature: Feature, fallbackStyleFunction: StyleFunction, resolution: number): Style[] {\n    /**\n     * @type {ol.FeatureStyleFunction|undefined}\n     */\n    const featureStyleFunction = feature.getStyleFunction();\n\n    /**\n     * @type {ol.style.Style|Array.<ol.style.Style>}\n     */\n    let style = null;\n\n    if (featureStyleFunction) {\n      style = featureStyleFunction(feature, resolution);\n    }\n\n    if (!style && fallbackStyleFunction) {\n      style = fallbackStyleFunction(feature, resolution);\n    }\n\n    if (!style) {\n      // The feature must not be displayed\n      return null;\n    }\n\n    // FIXME combine materials as in cesium-materials-pack?\n    // then this function must return a custom material\n    // More simply, could blend the colors like described in\n    // http://en.wikipedia.org/wiki/Alpha_compositing\n    return Array.isArray(style) ? style : [style];\n  }\n\n  /**\n   */\n  protected getGeometryFromFeature(feature: Feature, style: Style, opt_geom?: OLGeometry): OLGeometry | undefined {\n    if (opt_geom) {\n      return opt_geom;\n    }\n\n    const geom3d: OLGeometry = feature.get('olcs.3d_geometry');\n    if (geom3d && geom3d instanceof OLGeometry) {\n      return geom3d;\n    }\n\n    if (style) {\n      const geomFuncRes = style.getGeometryFunction()(feature);\n      if (geomFuncRes instanceof OLGeometry) {\n        return geomFuncRes;\n      }\n    }\n\n    return feature.getGeometry();\n  }\n\n  /**\n   * Convert one OpenLayers feature up to a collection of Cesium primitives.\n   * @api\n   */\n  olFeatureToCesium(layer: PrimitiveLayer, feature: Feature, style: Style, context: OlFeatureToCesiumContext, opt_geom?: OLGeometry): PrimitiveCollection {\n    const geom: OLGeometry = this.getGeometryFromFeature(feature, style, opt_geom);\n\n    if (!geom) {\n      // OpenLayers features may not have a geometry\n      // See http://geojson.org/geojson-spec.html#feature-objects\n      return null;\n    }\n\n    const proj = context.projection;\n    const newBillboardAddedCallback = function(bb: Billboard) {\n      const featureBb = context.featureToCesiumMap[getUid(feature)];\n      if (featureBb instanceof Array) {\n        featureBb.push(bb);\n      }\n      else {\n        context.featureToCesiumMap[getUid(feature)] = [bb];\n      }\n    };\n\n    switch (geom.getType()) {\n      case 'GeometryCollection':\n        const primitives = new Cesium.PrimitiveCollection();\n        (geom as GeometryCollection).getGeometriesArray().forEach((geom) => {\n          if (geom) {\n            const prims = this.olFeatureToCesium(layer, feature, style, context,\n                geom);\n            if (prims) {\n              primitives.add(prims);\n            }\n          }\n        });\n        return primitives;\n      case 'Point':\n        const bbs = context.billboards;\n        const result = this.olPointGeometryToCesium(layer, feature, geom as Point, proj,\n            style, bbs, newBillboardAddedCallback);\n        if (!result) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result;\n        }\n      case 'Circle':\n        return this.olCircleGeometryToCesium(layer, feature, geom as Circle, proj,\n            style);\n      case 'LineString':\n        return this.olLineStringGeometryToCesium(layer, feature, geom as LineString, proj,\n            style);\n      case 'Polygon':\n        return this.olPolygonGeometryToCesium(layer, feature, geom as Polygon, proj,\n            style);\n      case 'MultiPoint':\n        return this.olMultiGeometryToCesium(layer, feature, geom as MultiPoint, proj,\n            style, context.billboards, newBillboardAddedCallback) || null;\n      case 'MultiLineString':\n        return this.olMultiGeometryToCesium(layer, feature, geom as MultiLineString, proj,\n            style, context.billboards, newBillboardAddedCallback) || null;\n      case 'MultiPolygon':\n        return this.olMultiGeometryToCesium(layer, feature, geom as MultiPolygon, proj,\n            style, context.billboards, newBillboardAddedCallback) || null;\n      case 'LinearRing':\n        throw new Error('LinearRing should only be part of polygon.');\n      default:\n        throw new Error(`Ol geom type not handled : ${geom.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers vector layer to Cesium primitive collection.\n   * For each feature, the associated primitive will be stored in\n   * `featurePrimitiveMap`.\n   * @api\n   */\n  olVectorLayerToCesium(olLayer: VectorLayer<VectorSource>, olView: View, featurePrimitiveMap: Record<number, PrimitiveCollection>): VectorLayerCounterpart {\n    const proj = olView.getProjection();\n    const resolution = olView.getResolution();\n\n    if (resolution === undefined || !proj) {\n      console.assert(false, 'View not ready');\n      // an assertion is not enough for closure to assume resolution and proj\n      // are defined\n      throw new Error('View not ready');\n    }\n\n    let source = olLayer.getSource();\n    if (source instanceof OLClusterSource) {\n      source = source.getSource();\n    }\n\n    console.assert(source instanceof VectorSource);\n    const features = source.getFeatures();\n    const counterpart = new VectorLayerCounterpart(proj, this.scene);\n    const context = counterpart.context;\n    for (let i = 0; i < features.length; ++i) {\n      const feature = features[i];\n      if (!feature) {\n        continue;\n      }\n      const layerStyle: StyleFunction | undefined = olLayer.getStyleFunction();\n      const styles = this.computePlainStyle(olLayer, feature, layerStyle,\n          resolution);\n      if (!styles || !styles.length) {\n        // only 'render' features with a style\n        continue;\n      }\n\n      let primitives: PrimitiveCollection = null;\n      for (let i = 0; i < styles.length; i++) {\n        const prims = this.olFeatureToCesium(olLayer, feature, styles[i], context);\n        if (prims) {\n          if (!primitives) {\n            primitives = prims;\n          } else if (prims) {\n            let i = 0, prim;\n            while ((prim = prims.get(i))) {\n              primitives.add(prim);\n              i++;\n            }\n          }\n        }\n      }\n      if (!primitives) {\n        continue;\n      }\n      featurePrimitiveMap[getUid(feature)] = primitives;\n      counterpart.getRootPrimitive().add(primitives);\n    }\n\n    return counterpart;\n  }\n\n  /**\n   * Convert an OpenLayers feature to Cesium primitive collection.\n   * @api\n   */\n  convert(layer: VectorLayer<VectorSource>, view: View, feature: Feature, context: OlFeatureToCesiumContext): PrimitiveCollection {\n    const proj = view.getProjection();\n    const resolution = view.getResolution();\n\n    if (resolution == undefined || !proj) {\n      return null;\n    }\n\n    /**\n     * @type {ol.StyleFunction|undefined}\n     */\n    const layerStyle = layer.getStyleFunction();\n\n    const styles = this.computePlainStyle(layer, feature, layerStyle, resolution);\n\n    if (!styles || !styles.length) {\n      // only 'render' features with a style\n      return null;\n    }\n\n    context.projection = proj;\n\n    /**\n     * @type {Cesium.Primitive|null}\n     */\n    let primitives = null;\n    for (let i = 0; i < styles.length; i++) {\n      const prims = this.olFeatureToCesium(layer, feature, styles[i], context);\n      if (!primitives) {\n        primitives = prims;\n      } else if (prims) {\n        let i = 0, prim;\n        while ((prim = prims.get(i))) {\n          primitives.add(prim);\n          i++;\n        }\n      }\n    }\n    return primitives;\n  }\n}\n","import MVT from 'ol/format/MVT.js';\nimport Style, {type StyleFunction} from 'ol/style/Style.js';\nimport Stroke from 'ol/style/Stroke.js';\nimport {toContext} from 'ol/render.js';\nimport {get as getProjection} from 'ol/proj.js';\nimport {VERSION as OL_VERSION} from 'ol/util.js';\nimport LRUCache from 'ol/structs/LRUCache.js';\nimport {getForProjection as getTilegridForProjection} from 'ol/tilegrid.js';\nimport {createFromTemplates as createTileUrlFunctions} from 'ol/tileurlfunction.js';\nimport type {Credit, Event, ImageryLayerFeatureInfo, ImageryProvider, ImageryTypes, Proxy, Rectangle, Request, TileDiscardPolicy, TilingScheme} from 'cesium';\nimport type {UrlFunction} from 'ol/Tile.js';\nimport RenderFeature from 'ol/render/Feature.js';\nimport {createEmptyCanvas} from './core/OLImageryProvider';\n\n\nexport interface MVTOptions {\n  urls: string[],\n  rectangle: Rectangle,\n  credit: Credit,\n  styleFunction: StyleFunction,\n  cacheSize?: number,\n  featureCache?: LRUCache<Promise<RenderFeature[]>>\n  minimumLevel: number\n}\n\nconst format = new MVT({\n  featureClass: RenderFeature\n});\n\nconst styles = [new Style({\n  stroke: new Stroke({\n    color: 'blue',\n    width: 2\n  })\n})];\n\n\nexport default class MVTImageryProvider implements ImageryProvider {\n  private urls: string[];\n  private emptyCanvas_: HTMLCanvasElement = createEmptyCanvas();\n  private emptyCanvasPromise_: Promise<HTMLCanvasElement> = Promise.resolve(this.emptyCanvas_);\n  private tilingScheme_ = new Cesium.WebMercatorTilingScheme;\n  private ready_ = true;\n  private rectangle_: Rectangle;\n  private tileRectangle_: Rectangle;\n  readonly tileWidth = 256;\n  readonly tileHeight = 256;\n  readonly maximumLevel = 20;\n  private minimumLevel_ = 0;\n  get minimumLevel(): number {\n    return this.minimumLevel_;\n  }\n  private featureCache: LRUCache<Promise<RenderFeature[]>>;\n  private tileCache: LRUCache<Promise<HTMLCanvasElement>>;\n  private tileFunction_: UrlFunction;\n  private styleFunction_: StyleFunction;\n  private projection_ = getProjection('EPSG:3857');\n\n  /**\n * When <code>true</code>, this model is ready to render, i.e., the external binary, image,\n * and shader files were downloaded and the WebGL resources were created.\n */\n  get ready(): boolean {\n    return this.ready_;\n  }\n\n  /**\n * Gets the rectangle, in radians, of the imagery provided by the instance.\n */\n  get rectangle() {\n    return this.rectangle_;\n  }\n\n  /**\n   * Gets the tiling scheme used by the provider.\n   */\n  get tilingScheme(): TilingScheme {\n    return this.tilingScheme_;\n  }\n\n  /**\n   * Gets an event that is raised when the imagery provider encounters an asynchronous error.  By subscribing\n   * to the event, you will be notified of the error and can potentially recover from it.  Event listeners\n   * are passed an instance of {@link Cesium.TileProviderError}.\n   */\n  readonly errorEvent: Event = new Cesium.Event();\n\n  /**\n   * Gets the credit to display when this imagery provider is active.  Typically this is used to credit\n   * the source of the imagery.\n   */\n  readonly credit: Credit;\n\n  getTileCredits(x: number, y: number, level: number): Credit[] {\n    return [];\n  }\n\n  /**\n   * Gets the proxy used by this provider.\n   */\n  readonly proxy: Proxy;\n\n  get _ready(): boolean {\n    return this.ready_;\n  }\n\n  /**\n   * Gets the tile discard policy.  If not undefined, the discard policy is responsible\n   * for filtering out \"missing\" tiles via its shouldDiscardImage function.  If this function\n   * returns undefined, no tiles are filtered.\n   */\n  get tileDiscardPolicy(): TileDiscardPolicy {\n    return undefined;\n  }\n\n  // FIXME: this might be exposed\n  /**\n   * Gets a value indicating whether or not the images provided by this imagery provider\n   * include an alpha channel.  If this property is false, an alpha channel, if present, will\n   * be ignored.  If this property is true, any images without an alpha channel will be treated\n   * as if their alpha is 1.0 everywhere.  When this property is false, memory usage\n   * and texture upload time are reduced.\n   */\n  get hasAlphaChannel() {\n    return true;\n  }\n\n  // FIXME: this could be implemented by proxying to OL\n  /**\n   * Asynchronously determines what features, if any, are located at a given longitude and latitude within\n   * a tile.\n   * This function is optional, so it may not exist on all ImageryProviders.\n   * @param x - The tile X coordinate.\n   * @param y - The tile Y coordinate.\n   * @param level - The tile level.\n   * @param longitude - The longitude at which to pick features.\n   * @param latitude - The latitude at which to pick features.\n   * @return A promise for the picked features that will resolve when the asynchronous\n   *                   picking completes.  The resolved value is an array of {@link ImageryLayerFeatureInfo}\n   *                   instances.  The array may be empty if no features are found at the given location.\n   *                   It may also be undefined if picking is not supported.\n   */\n  pickFeatures(x: number, y: number, level: number, longitude: number, latitude: number): Promise<ImageryLayerFeatureInfo[]> | undefined {\n    return undefined;\n  }\n\n  constructor(options: MVTOptions) {\n    this.urls = options.urls;\n    this.rectangle_ = options.rectangle || this.tilingScheme.rectangle;\n    this.credit = options.credit;\n    this.styleFunction_ = options.styleFunction || (() => styles);\n    this.tileRectangle_ = new Cesium.Rectangle();\n    // to avoid too frequent cache grooming we allow x2 capacity\n    const cacheSize = options.cacheSize !== undefined ? options.cacheSize : 50;\n    this.tileCache = new LRUCache(cacheSize);\n    this.featureCache = options.featureCache || new LRUCache(cacheSize);\n    this.minimumLevel_ = options.minimumLevel || 0;\n    const tileGrid = getTilegridForProjection(this.projection_);\n    this.tileFunction_ = createTileUrlFunctions(this.urls, tileGrid);\n  }\n\n  private getTileFeatures(z: number, x: number, y: number): Promise<RenderFeature[]> {\n    const cacheKey = this.getCacheKey_(z, x, y);\n    let promise;\n    if (this.featureCache.containsKey(cacheKey)) {\n      promise = this.featureCache.get(cacheKey);\n    }\n    if (!promise) {\n      const url = this.getUrl_(z, x, y);\n      promise = fetch(url)\n          .then(r => (r.ok ? r : Promise.reject(r)))\n          .then(r => r.arrayBuffer())\n          .then(buffer => this.readFeaturesFromBuffer(buffer));\n      this.featureCache.set(cacheKey, promise);\n      if (this.featureCache.getCount() > 2 * this.featureCache.highWaterMark) {\n        while (this.featureCache.canExpireCache()) {\n          this.featureCache.pop();\n        }\n      }\n    }\n    return promise;\n  }\n\n  readFeaturesFromBuffer(buffer: ArrayBuffer): RenderFeature[] {\n    let options;\n    if (OL_VERSION <= '6.4.4') {\n      // See https://github.com/openlayers/openlayers/pull/11540\n      options = {\n        extent: [0, 0, 4096, 4096],\n        dataProjection: this.projection_,\n        featureProjection: this.projection_\n      };\n    }\n    const features = format.readFeatures(buffer, options) as RenderFeature[];\n    const scaleFactor = this.tileWidth / 4096;\n    features.forEach((f) => {\n      const flatCoordinates = f.getFlatCoordinates();\n      let flip = false;\n      for (let i = 0; i < flatCoordinates.length; ++i) {\n        flatCoordinates[i] *= scaleFactor;\n        if (flip) {\n          // FIXME: why do we need this now?\n          flatCoordinates[i] = this.tileWidth - flatCoordinates[i];\n        }\n        if (OL_VERSION <= '6.4.4') {\n          // LEGACY\n          flip = !flip;\n        }\n      }\n    });\n\n    return features;\n  }\n\n  private getUrl_(z: number, x: number, y: number): string {\n    // FIXME: probably we should not pass 1 as pixelRatio\n    const url = this.tileFunction_([z, x, y], 1, this.projection_);\n    return url;\n  }\n\n  private getCacheKey_(z: number, x: number, y: number) {\n    return `${z}_${x}_${y}`;\n  }\n\n  requestImage(x: number, y: number, z: number, request?: Request): Promise<ImageryTypes> | undefined {\n    if (z < this.minimumLevel_) {\n      return this.emptyCanvasPromise_;\n    }\n\n    try {\n      const cacheKey = this.getCacheKey_(z, x, y);\n      let promise;\n      if (this.tileCache.containsKey(cacheKey)) {\n        promise = this.tileCache.get(cacheKey);\n      }\n      if (!promise) {\n        promise = this.getTileFeatures(z, x, y)\n            .then((features) => {\n            // FIXME: here we suppose the 2D projection is in meters\n              this.tilingScheme.tileXYToNativeRectangle(x, y, z, this.tileRectangle_);\n              const resolution = (this.tileRectangle_.east - this.tileRectangle_.west) / this.tileWidth;\n              return this.rasterizeFeatures(features, this.styleFunction_, resolution);\n            });\n        this.tileCache.set(cacheKey, promise);\n        if (this.tileCache.getCount() > 2 * this.tileCache.highWaterMark) {\n          while (this.tileCache.canExpireCache()) {\n            this.tileCache.pop();\n          }\n        }\n      }\n      return promise;\n    } catch (e) {\n      console.trace(e);\n      // FIXME: open PR on Cesium to fix incorrect typing\n      // @ts-ignore\n      this.errorEvent.raiseEvent('could not render pbf to tile', e);\n    }\n  }\n\n  rasterizeFeatures(features: RenderFeature[], styleFunction: StyleFunction, resolution: number): HTMLCanvasElement {\n    const canvas = document.createElement('canvas');\n    const vectorContext = toContext(canvas.getContext('2d'), {size: [this.tileWidth, this.tileHeight]});\n    features.forEach((f) => {\n      const styles = styleFunction(f, resolution);\n      if (styles) {\n        if (Array.isArray(styles)) {\n          styles.forEach((style) => {\n            vectorContext.setStyle(style);\n            vectorContext.drawGeometry(f);\n          });\n        } else {\n          vectorContext.setStyle(styles);\n          vectorContext.drawGeometry(f);\n        }\n      }\n    });\n    return canvas;\n  }\n}\n","import olGeomPoint from 'ol/geom/Point.js';\nimport {supportsImageRenderingPixelated, imageRenderingValue} from './util';\nimport {ol4326CoordinateToCesiumCartesian} from './core';\nimport {getTransform, type TransformFunction} from 'ol/proj.js';\nimport olcsAutoRenderLoop from './AutoRenderLoop';\nimport olcsCamera from './Camera';\nimport olcsRasterSynchronizer from './RasterSynchronizer';\nimport olcsVectorSynchronizer from './VectorSynchronizer';\nimport olcsOverlaySynchronizer from './OverlaySynchronizer';\nimport type Map from 'ol/Map.js';\nimport type Interaction from 'ol/interaction/Interaction.js';\nimport type {Group} from 'ol/layer.js';\nimport type Feature from 'ol/Feature.js';\nimport type View from 'ol/View.js';\nimport type {\n  BoundingSphere, ContextOptions,\n  DataSourceCollection,\n  DataSourceDisplay,\n  Entity,\n  EntityView,\n  Globe,\n  JulianDate, MapMode2D, MapProjection, PerspectiveFrustum,\n  Scene,\n  ImageryLayer\n} from 'cesium';\nimport type AbstractSynchronizer from './AbstractSynchronizer';\nimport type VectorLayerCounterpart from './core/VectorLayerCounterpart';\n\n/**\n * Moved from Cesium\n * The state of a BoundingSphere computation being performed by a {@link Visualizer}.\n */\nconst BoundingSphereState: Record<string, number> = {\n  /**\n   * The BoundingSphere has been computed.\n   */\n  DONE: 0,\n  /**\n   * The BoundingSphere is still being computed.\n   */\n  PENDING: 1,\n  /**\n   * The BoundingSphere does not exist.\n   */\n  FAILED: 2,\n};\n\ntype SceneOptions = {\n  canvas: HTMLCanvasElement;\n  contextOptions?: ContextOptions;\n  creditContainer?: Element;\n  creditViewport?: Element;\n  mapProjection?: MapProjection;\n  orderIndependentTranslucency?: boolean;\n  scene3DOnly?: boolean;\n  shadows?: boolean;\n  mapMode2D?: MapMode2D;\n  requestRenderMode?: boolean;\n  maximumRenderTimeChange?: number;\n  depthPlaneEllipsoidOffset?: number;\n  msaaSamples?: number;\n}\n\ntype OLCesiumOptions = {\n  map: Map,\n  time?: () => JulianDate,\n  target?: Element | string,\n  createSynchronizers?: (map: Map, scene: Scene, dataSourceCollection: DataSourceCollection) => AbstractSynchronizer<ImageryLayer | VectorLayerCounterpart>[],\n  stopOpenLayersEventsPropagation?: boolean,\n  sceneOptions?: SceneOptions\n}\n\n// FIXME: remove this when all the synchronizers are migrated to typescript.\ntype SynchronizerType = AbstractSynchronizer<ImageryLayer | VectorLayerCounterpart>;\n\n/**\n * @typedef {Object} OLCesiumOptions\n * @property {import('ol/Map.js').default} map The OpenLayers map we want to show on a Cesium scene.\n * @property {Element|string} [target] Target element for the Cesium scene.\n * @property {function(!import('ol/Map.js').default, !Cesium.Scene, !Cesium.DataSourceCollection): Array<import('olcs/AbstractSynchronizer.js').default>}\n *      [createSynchronizers] Callback function which will be called by the {@link olcs.OLCesium}\n *      constructor to create custom synchronizers. Receives an `ol.Map` and a `Cesium.Scene` as arguments,\n *      and needs to return an array of {@link import('olcs/AbstractSynchronizer.js').default}.\n * @property {function(): Cesium.JulianDate} [time] Control the current time used by Cesium.\n * @property {boolean} [stopOpenLayersEventsPropagation] Prevent propagation of mouse/touch events to\n *      OpenLayers when Cesium is active.\n * @property {Cesium.SceneOptions} [sceneOptions] Allows the passing of property value to the\n *      `Cesium.Scene`.\n */\nexport default class OLCesium {\n  private autoRenderLoop_: olcsAutoRenderLoop | null = null;\n  private map_: Map;\n  private time_: () => JulianDate;\n  private to4326Transform_: TransformFunction;\n  private resolutionScale_ = 1.0;\n  private canvasClientWidth_ = 0.0;\n  private canvasClientHeight_ = 0.0;\n  private resolutionScaleChanged_ = true; // force resize\n  private container_: HTMLElement;\n  private isOverMap_: boolean;\n  private canvas_: HTMLCanvasElement;\n  private enabled_ = false;\n  private pausedInteractions_: Interaction[] = [];\n  private hiddenRootGroup_: Group | null = null;\n  private scene_: Scene;\n  private camera_: olcsCamera;\n  private globe_: Globe;\n  private dataSourceCollection_: DataSourceCollection;\n  private dataSourceDisplay_: DataSourceDisplay;\n  /** Time of the last rendered frame, as returned by `performance.now()`. */\n  private lastFrameTime_ = 0;\n  /** The identifier returned by `requestAnimationFrame`. */\n  private renderId_: number | undefined;\n  /** Target frame rate for the render loop.  */\n  private targetFrameRate_ = Number.POSITIVE_INFINITY;\n  /** If the Cesium render loop is being blocked. */\n  private blockCesiumRendering_ = false;\n  /** If the warmup routine is active. */\n  private warmingUp_ = false;\n  private trackedFeature_: Feature | null = null;\n  private trackedEntity_: Entity | null = null;\n  private entityView_: EntityView | null = null;\n  private needTrackedEntityUpdate_ = false;\n  private boundingSphereScratch_: BoundingSphere = new Cesium.BoundingSphere();\n  private synchronizers_: SynchronizerType[];\n\n  constructor(options: OLCesiumOptions) {\n    this.map_ = options.map;\n\n    this.time_ = options.time || function() {\n      return Cesium.JulianDate.now();\n    };\n\n    /**\n     * No change of the view projection.\n     */\n    this.to4326Transform_ = getTransform(this.map_.getView().getProjection(), 'EPSG:4326');\n\n    const fillArea = 'position:absolute;top:0;left:0;width:100%;height:100%;touch-action:none;';\n    this.container_ = document.createElement('DIV');\n    const containerAttribute = document.createAttribute('style');\n    containerAttribute.value = `${fillArea}visibility:hidden;`;\n    this.container_.setAttributeNode(containerAttribute);\n\n    let targetElement = options.target || this.map_.getViewport();\n    if (typeof targetElement === 'string') {\n      targetElement = document.getElementById(targetElement);\n    }\n    targetElement.appendChild(this.container_);\n\n    /**\n     * Whether the Cesium container is placed over the ol map.\n     * a target => side by side mode\n     * no target => over map mode\n     */\n    this.isOverMap_ = !options.target;\n\n\n    if (this.isOverMap_ && options.stopOpenLayersEventsPropagation) {\n      const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'pointerdown', 'mousewheel', 'wheel'];\n      for (let i = 0, ii = overlayEvents.length; i < ii; ++i) {\n        this.container_.addEventListener(overlayEvents[i], evt => evt.stopPropagation());\n      }\n    }\n\n    this.canvas_ = document.createElement<'canvas'>('canvas');\n    const canvasAttribute = document.createAttribute('style');\n    canvasAttribute.value = fillArea;\n    this.canvas_.setAttributeNode(canvasAttribute);\n\n    if (supportsImageRenderingPixelated()) {\n      // non standard CSS4\n      this.canvas_.style['imageRendering'] = imageRenderingValue();\n    }\n\n    this.canvas_.oncontextmenu = function() {\n      return false;\n    };\n    this.canvas_.onselectstart = function() {\n      return false;\n    };\n\n    this.container_.appendChild(this.canvas_);\n\n    const sceneOptions: SceneOptions = options.sceneOptions !== undefined ?\n      {...options.sceneOptions, canvas: this.canvas_, scene3DOnly: true} :\n      {canvas: this.canvas_, scene3DOnly: true};\n\n    this.scene_ = new Cesium.Scene(sceneOptions);\n\n    const sscc = this.scene_.screenSpaceCameraController;\n\n    if (!Array.isArray(sscc.tiltEventTypes)) {\n      console.log('sscc is not an array');\n    } else {\n      sscc.tiltEventTypes.push({\n        'eventType': Cesium.CameraEventType.LEFT_DRAG,\n        'modifier': Cesium.KeyboardEventModifier.SHIFT\n      });\n\n      sscc.tiltEventTypes.push({\n        'eventType': Cesium.CameraEventType.LEFT_DRAG,\n        'modifier': Cesium.KeyboardEventModifier.ALT\n      });\n    }\n\n    sscc.enableLook = false;\n\n    this.scene_.camera.constrainedAxis = Cesium.Cartesian3.UNIT_Z;\n\n    this.camera_ = new olcsCamera(this.scene_, this.map_);\n\n    this.globe_ = new Cesium.Globe(Cesium.Ellipsoid.WGS84);\n    this.globe_.baseColor = Cesium.Color.WHITE;\n    this.scene_.globe = this.globe_;\n    this.scene_.skyAtmosphere = new Cesium.SkyAtmosphere();\n\n    // The first layer of Cesium is special; using a 1x1 transparent image to workaround it.\n    // See https://github.com/AnalyticalGraphicsInc/cesium/issues/1323 for details.\n    const firstImageryProvider = new Cesium.SingleTileImageryProvider({\n      tileHeight: 1,\n      tileWidth: 1,\n      url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=',\n      rectangle: Cesium.Rectangle.fromDegrees(0, 0, 1, 1) // the Rectangle dimensions are arbitrary\n    });\n    this.globe_.imageryLayers.addImageryProvider(firstImageryProvider, 0);\n\n    this.dataSourceCollection_ = new Cesium.DataSourceCollection();\n    this.dataSourceDisplay_ = new Cesium.DataSourceDisplay({\n      scene: this.scene_,\n      dataSourceCollection: this.dataSourceCollection_\n    });\n\n    this.synchronizers_ = options.createSynchronizers ?\n      options.createSynchronizers(this.map_, this.scene_, this.dataSourceCollection_) : [\n        new olcsRasterSynchronizer(this.map_, this.scene_),\n        new olcsVectorSynchronizer(this.map_, this.scene_),\n        new olcsOverlaySynchronizer(this.map_, this.scene_)\n      ] as unknown as SynchronizerType[];\n\n    // Assures correct canvas size after initialisation\n    this.handleResize_();\n\n    for (let i = this.synchronizers_.length - 1; i >= 0; --i) {\n      this.synchronizers_[i].synchronize();\n    }\n\n    const eventHelper = new Cesium.EventHelper();\n    eventHelper.add(this.scene_.postRender, OLCesium.prototype.updateTrackedEntity_, this);\n  }\n\n  /**\n   * Destroys the Cesium resources held by this object.\n   */\n  destroy() {\n    cancelAnimationFrame(this.renderId_);\n    this.renderId_ = undefined;\n    this.synchronizers_.forEach(synchronizer => synchronizer.destroyAll());\n    this.camera_.destroy();\n    this.scene_.destroy();\n    // @ts-ignore TS2341\n    this.scene_._postRender = null;\n    this.container_.remove();\n  }\n\n  /**\n   * Render the Cesium scene.\n   */\n  private render_() {\n    // if a call to `requestAnimationFrame` is pending, cancel it\n    if (this.renderId_ !== undefined) {\n      cancelAnimationFrame(this.renderId_);\n      this.renderId_ = undefined;\n    }\n\n    // only render if Cesium is enabled/warming and rendering hasn't been blocked\n    if ((this.enabled_ || this.warmingUp_) && !this.blockCesiumRendering_) {\n      this.renderId_ = requestAnimationFrame(this.onAnimationFrame_.bind(this));\n    }\n  }\n\n  /**\n   * Callback for `requestAnimationFrame`.\n   * @param {number} frameTime The frame time, from `performance.now()`.\n   */\n  private onAnimationFrame_(frameTime: number) {\n    this.renderId_ = undefined;\n\n    // check if a frame was rendered within the target frame rate\n    const interval = 1000.0 / this.targetFrameRate_;\n    const delta = frameTime - this.lastFrameTime_;\n    if (delta < interval) {\n      // too soon, don't render yet\n      this.render_();\n      return;\n    }\n\n    // time to render a frame, save the time\n    this.lastFrameTime_ = frameTime;\n\n    const julianDate = this.time_();\n    // initializeFrame private property\n    // @ts-ignore TS2341\n    this.scene_.initializeFrame();\n    this.handleResize_();\n    this.dataSourceDisplay_.update(julianDate);\n\n    // Update tracked entity\n    if (this.entityView_) {\n      const trackedEntity = this.trackedEntity_;\n      // getBoundingSphere private property\n      // @ts-ignore TS2341\n      const trackedState = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n      if (trackedState === BoundingSphereState.DONE) {\n        this.boundingSphereScratch_.radius = 1; // a radius of 1 is enough for tracking points\n        this.entityView_.update(julianDate, this.boundingSphereScratch_);\n      }\n    }\n\n    this.scene_.render(julianDate);\n    this.camera_.checkCameraChange();\n\n    // request the next render call after this one completes to ensure the browser doesn't get backed up\n    this.render_();\n  }\n\n  private updateTrackedEntity_() {\n    if (!this.needTrackedEntityUpdate_) {\n      return;\n    }\n\n    const trackedEntity = this.trackedEntity_;\n    const scene = this.scene_;\n\n    // getBoundingSphere private property\n    // @ts-ignore TS2341\n    const state = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n    if (state === BoundingSphereState.PENDING) {\n      return;\n    }\n\n    scene.screenSpaceCameraController.enableTilt = false;\n\n    const bs = state !== BoundingSphereState.FAILED ? this.boundingSphereScratch_ : undefined;\n    if (bs) {\n      bs.radius = 1;\n    }\n    this.entityView_ = new Cesium.EntityView(trackedEntity, scene, scene.mapProjection.ellipsoid);\n    this.entityView_.update(this.time_(), bs);\n    this.needTrackedEntityUpdate_ = false;\n  }\n\n  private handleResize_() {\n    let width = this.canvas_.clientWidth;\n    let height = this.canvas_.clientHeight;\n\n    if (width === 0 || height === 0) {\n      // The canvas DOM element is not ready yet.\n      return;\n    }\n\n    if (width === this.canvasClientWidth_ &&\n        height === this.canvasClientHeight_ &&\n        !this.resolutionScaleChanged_) {\n      return;\n    }\n\n    let resolutionScale = this.resolutionScale_;\n    if (!supportsImageRenderingPixelated()) {\n      resolutionScale *= window.devicePixelRatio || 1.0;\n    }\n    this.resolutionScaleChanged_ = false;\n\n    this.canvasClientWidth_ = width;\n    this.canvasClientHeight_ = height;\n\n    width *= resolutionScale;\n    height *= resolutionScale;\n\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n    (<PerspectiveFrustum> this.scene_.camera.frustum).aspectRatio = width / height;\n  }\n\n  getCamera(): olcsCamera {\n    return this.camera_;\n  }\n\n  getOlMap(): Map {\n    return this.map_;\n  }\n\n  getOlView(): View {\n    const view = this.map_.getView();\n    console.assert(view);\n    return view;\n  }\n\n  getCesiumScene(): Scene {\n    return this.scene_;\n  }\n\n  getDataSources(): DataSourceCollection {\n    return this.dataSourceCollection_;\n  }\n\n  getDataSourceDisplay(): DataSourceDisplay {\n    return this.dataSourceDisplay_;\n  }\n\n  getEnabled(): boolean {\n    return this.enabled_;\n  }\n\n  /**\n   * Enables/disables the Cesium.\n   * This modifies the visibility style of the container element.\n   */\n  setEnabled(enable: boolean) {\n    if (this.enabled_ === enable) {\n      return;\n    }\n    this.enabled_ = enable;\n\n    // some Cesium operations are operating with canvas.clientWidth,\n    // so we can't remove it from DOM or even make display:none;\n    this.container_.style.visibility = this.enabled_ ? 'visible' : 'hidden';\n    let interactions;\n    if (this.enabled_) {\n      this.throwOnUnitializedMap_();\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        interactions.forEach((el, i, arr) => {\n          this.pausedInteractions_.push(el);\n        });\n        interactions.clear();\n\n        this.map_.addInteraction = interaction => this.pausedInteractions_.push(interaction);\n        this.map_.removeInteraction = (interaction) => {\n          let interactionRemoved = false;\n          this.pausedInteractions_ = this.pausedInteractions_.filter((i) => {\n            const removed = i !== interaction;\n            if (!interactionRemoved) {interactionRemoved = removed;}\n            return removed;\n          });\n          return interactionRemoved ? interaction : undefined;\n        };\n\n        const rootGroup = this.map_.getLayerGroup();\n        if (rootGroup.getVisible()) {\n          this.hiddenRootGroup_ = rootGroup;\n          this.hiddenRootGroup_.setVisible(false);\n        }\n\n        this.map_.getOverlayContainer().classList.add('olcs-hideoverlay');\n      }\n\n      this.camera_.readFromView();\n      this.render_();\n    } else {\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        this.pausedInteractions_.forEach((interaction) => {\n          interactions.push(interaction);\n        });\n        this.pausedInteractions_.length = 0;\n\n        this.map_.addInteraction = interaction => this.map_.getInteractions().push(interaction);\n        this.map_.removeInteraction = interaction => this.map_.getInteractions().remove(interaction);\n\n        this.map_.getOverlayContainer().classList.remove('olcs-hideoverlay');\n        if (this.hiddenRootGroup_) {\n          this.hiddenRootGroup_.setVisible(true);\n          this.hiddenRootGroup_ = null;\n        }\n      }\n\n      this.camera_.updateView();\n    }\n  }\n\n  /**\n   * Preload Cesium so that it is ready when transitioning from 2D to 3D.\n   * @param {number} height Target height of the camera\n   * @param {number} timeout Milliseconds after which the warming will stop\n  */\n  warmUp(height: number, timeout: number) {\n    if (this.enabled_) {\n      // already enabled\n      return;\n    }\n    this.throwOnUnitializedMap_();\n    this.camera_.readFromView();\n    const ellipsoid = this.globe_.ellipsoid;\n    const csCamera = this.scene_.camera;\n    const position = ellipsoid.cartesianToCartographic(csCamera.position);\n    if (position.height < height) {\n      position.height = height;\n      csCamera.position = ellipsoid.cartographicToCartesian(position);\n    }\n\n    this.warmingUp_ = true;\n    this.render_();\n\n    setTimeout(() => {\n      this.warmingUp_ = false;\n    }, timeout);\n  }\n\n  /**\n   * Block Cesium rendering to save resources.\n   * @param {boolean} block True to block.\n  */\n  setBlockCesiumRendering(block: boolean) {\n    if (this.blockCesiumRendering_ !== block) {\n      this.blockCesiumRendering_ = block;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Render the globe only when necessary in order to save resources.\n   * Experimental.\n   */\n  enableAutoRenderLoop() {\n    if (!this.autoRenderLoop_) {\n      this.autoRenderLoop_ = new olcsAutoRenderLoop(this);\n    }\n  }\n\n  /**\n   * Get the autorender loop.\n  */\n  getAutoRenderLoop(): olcsAutoRenderLoop {\n    return this.autoRenderLoop_;\n  }\n\n  /**\n   * The 3D Cesium globe is rendered in a canvas with two different dimensions:\n   * clientWidth and clientHeight which are the dimension on the screen and\n   * width and height which are the dimensions of the drawing buffer.\n   *\n   * By using a resolution scale lower than 1.0, it is possible to render the\n   * globe in a buffer smaller than the canvas client dimensions and improve\n   * performance, at the cost of quality.\n   *\n   * Pixel ratio should also be taken into account; by default, a device with\n   * pixel ratio of 2.0 will have a buffer surface 4 times bigger than the client\n   * surface.\n   */\n  setResolutionScale(value: number) {\n    value = Math.max(0, value);\n    if (value !== this.resolutionScale_) {\n      this.resolutionScale_ = Math.max(0, value);\n      this.resolutionScaleChanged_ = true;\n      if (this.autoRenderLoop_) {\n        this.autoRenderLoop_.restartRenderLoop();\n      }\n    }\n  }\n\n  /**\n   * Set the target frame rate for the renderer. Set to `Number.POSITIVE_INFINITY`\n   * to render as quickly as possible.\n   * @param {number} value The frame rate, in frames per second.\n   */\n  setTargetFrameRate(value: number) {\n    if (this.targetFrameRate_ !== value) {\n      this.targetFrameRate_ = value;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Check if OpenLayers map is not properly initialized.\n   */\n  private throwOnUnitializedMap_() {\n    const map = this.map_;\n    const view = map.getView();\n    const center = view.getCenter();\n    if (!view.isDef() || isNaN(center[0]) || isNaN(center[1])) {\n      throw new Error(`The OpenLayers map is not properly initialized: ${center} / ${view.getResolution()}`);\n    }\n  }\n\n  get trackedFeature(): Feature {\n    return this.trackedFeature_;\n  }\n\n  set trackedFeature(feature: Feature) {\n    if (this.trackedFeature_ !== feature) {\n\n      const scene = this.scene_;\n\n      //Stop tracking\n      if (!feature || !feature.getGeometry()) {\n        this.needTrackedEntityUpdate_ = false;\n        scene.screenSpaceCameraController.enableTilt = true;\n\n        if (this.trackedEntity_) {\n          this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_);\n        }\n        this.trackedEntity_ = null;\n        this.trackedFeature_ = null;\n        this.entityView_ = null;\n        scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\n        return;\n      }\n\n      this.trackedFeature_ = feature;\n\n      //We can't start tracking immediately, so we set a flag and start tracking\n      //when the bounding sphere is ready (most likely next frame).\n      this.needTrackedEntityUpdate_ = true;\n\n      const to4326Transform = this.to4326Transform_;\n      const toCesiumPosition = function() {\n        const geometry = feature.getGeometry();\n        console.assert(geometry instanceof olGeomPoint);\n        const coo = geometry instanceof olGeomPoint ? geometry.getCoordinates() : [];\n        const coo4326 = to4326Transform(coo, undefined, coo.length);\n        return ol4326CoordinateToCesiumCartesian(coo4326);\n      };\n\n      // Create an invisible point entity for tracking.\n      // It is independent of the primitive/geometry created by the vector synchronizer.\n      const options: Entity.ConstructorOptions = {\n        // @ts-ignore according to Cesium types, not possible to pass CallbackProperty\n        position: new Cesium.CallbackProperty((time, result) => toCesiumPosition(), false),\n        point: {\n          pixelSize: 1,\n          color: Cesium.Color.TRANSPARENT\n        }\n      };\n\n      this.trackedEntity_ = this.dataSourceDisplay_.defaultDataSource.entities.add(options);\n    }\n  }\n}\n","import type {Collection, Map as OLMap, Overlay} from 'ol';\nimport SynchronizedOverlay from './SynchronizedOverlay';\nimport {getUid} from './util';\nimport type {Scene} from 'cesium';\nimport type {CollectionEvent} from 'ol/Collection.js';\n\nexport default class OverlaySynchronizer {\n  private overlayCollection_: Collection<Overlay>;\n  private overlayContainerStopEvent_: HTMLDivElement;\n  private overlayContainer_: HTMLDivElement;\n  private overlayMap_: Map<number, SynchronizedOverlay> = new Map();\n  private overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'pointerdown', 'mousewheel', 'wheel'];\n\n  /**\n  * @param map\n  * @param scene\n  * @constructor\n  * @api\n  */\n  constructor(protected map: OLMap, protected scene: Scene) {\n    this.map = map;\n    this.overlayCollection_ = this.map.getOverlays();\n    this.scene = scene;\n    this.overlayContainerStopEvent_ = document.createElement('div');\n    this.overlayContainerStopEvent_.className = 'ol-overlaycontainer-stopevent';\n    this.overlayEvents.forEach((name) => {\n      this.overlayContainerStopEvent_.addEventListener(name, evt => evt.stopPropagation());\n    });\n    this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_);\n\n    this.overlayContainer_ = document.createElement('div');\n    this.overlayContainer_.className = 'ol-overlaycontainer';\n    this.scene.canvas.parentElement.appendChild(this.overlayContainer_);\n  }\n\n  /**\n  * Get the element that serves as a container for overlays that don't allow\n  * event propagation. Elements added to this container won't let mousedown and\n  * touchstart events through to the map, so clicks and gestures on an overlay\n  * don't trigger any {@link ol.MapBrowserEvent}.\n  * @return The map's overlay container that stops events.\n  */\n  getOverlayContainerStopEvent(): Element {\n    return this.overlayContainerStopEvent_;\n  }\n\n  /**\n  * Get the element that serves as a container for overlays.\n  * @return The map's overlay container.\n  */\n  getOverlayContainer(): Element {\n    return this.overlayContainer_;\n  }\n\n  /**\n  * Destroy all and perform complete synchronization of the overlays.\n  * @api\n  */\n  synchronize() {\n    this.destroyAll();\n    this.overlayCollection_.forEach((overlay) => { this.addOverlay(overlay); });\n    this.overlayCollection_.on('add', (evt: CollectionEvent<Overlay>) => this.addOverlay(evt.element));\n    this.overlayCollection_.on('remove', (evt: CollectionEvent<Overlay>) => this.removeOverlay(evt.element));\n  }\n\n\n  /**\n  * @api\n  */\n  addOverlay(overlay: Overlay) {\n    if (!overlay) {\n      return;\n    }\n    const cesiumOverlay = new SynchronizedOverlay({\n      scene: this.scene,\n      synchronizer: this,\n      parent: overlay\n    });\n\n    this.overlayMap_.set(getUid(overlay), cesiumOverlay);\n  }\n\n\n  /**\n  * Removes an overlay from the scene\n  * @api\n  */\n  removeOverlay(overlay: Overlay) {\n    const overlayId = getUid(overlay);\n    const csOverlay = this.overlayMap_.get(overlayId);\n    if (csOverlay) {\n      csOverlay.destroy();\n      this.overlayMap_.delete(overlayId);\n    }\n  }\n\n  /**\n  * Destroys all the created Cesium objects.\n  */\n  protected destroyAll() {\n    this.overlayMap_.forEach((overlay: SynchronizedOverlay) => {\n      overlay.destroy();\n    });\n    this.overlayMap_.clear();\n  }\n}\n","import type Map from 'ol/Map.js';\nimport {getUid} from './util';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer';\nimport {type LayerWithParents, tileLayerToImageryLayer, updateCesiumLayerProperties} from './core';\nimport type {Scene, ImageryLayer, ImageryLayerCollection} from 'cesium';\nimport type BaseLayer from 'ol/layer/Base.js';\nimport type Projection from 'ol/proj/Projection.js';\nimport BaseVectorLayer from 'ol/layer/BaseVector.js';\nimport LayerGroup from 'ol/layer/Group.js';\n\nexport default class RasterSynchronizer extends olcsAbstractSynchronizer<ImageryLayer> {\n  private cesiumLayers_: ImageryLayerCollection;\n  private ourLayers_: ImageryLayerCollection;\n  /**\n   * This object takes care of one-directional synchronization of\n   * Openlayers raster layers to the given Cesium globe.\n   */\n  constructor(map: Map, scene: Scene) {\n    super(map, scene);\n\n    this.cesiumLayers_ = scene.imageryLayers;\n    this.ourLayers_ = new Cesium.ImageryLayerCollection();\n  }\n\n  addCesiumObject(object: ImageryLayer): void {\n    this.cesiumLayers_.add(object);\n    this.ourLayers_.add(object);\n  }\n\n  destroyCesiumObject(object: ImageryLayer): void {\n    object.destroy();\n  }\n\n  removeSingleCesiumObject(object: ImageryLayer, destroy: boolean): void {\n    this.cesiumLayers_.remove(object, destroy);\n    this.ourLayers_.remove(object, false);\n  }\n\n  removeAllCesiumObjects(destroy: boolean): void {\n    for (let i = 0; i < this.ourLayers_.length; ++i) {\n      this.cesiumLayers_.remove(this.ourLayers_.get(i), destroy);\n    }\n    this.ourLayers_.removeAll(false);\n  }\n\n  /**\n   * Creates an array of Cesium.ImageryLayer.\n   * May be overriden by child classes to implement custom behavior.\n   * The default implementation handles tiled imageries in EPSG:4326 or\n   * EPSG:3859.\n   */\n  protected convertLayerToCesiumImageries(olLayer: BaseLayer, viewProj: Projection): ImageryLayer[] {\n    const result = tileLayerToImageryLayer(this.map, olLayer, viewProj);\n    return result ? [result] : null;\n  }\n\n  createSingleLayerCounterparts(olLayerWithParents: LayerWithParents): ImageryLayer[] {\n    const olLayer = olLayerWithParents.layer;\n    const uid = getUid(olLayer).toString();\n    const viewProj = this.view.getProjection();\n    console.assert(viewProj);\n    const cesiumObjects = this.convertLayerToCesiumImageries(olLayer, viewProj);\n    if (cesiumObjects) {\n      const listenKeyArray = [];\n      [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n        listenKeyArray.push(olLayerItem.on(['change:opacity', 'change:visible'], () => {\n          // the compiler does not seem to be able to infer this\n          console.assert(cesiumObjects);\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n          }\n        }));\n      });\n\n      if (olLayer instanceof BaseVectorLayer) {\n        let previousStyleFunction = olLayer.getStyleFunction();\n        // there is no convenient way to detect a style function change in OL\n        listenKeyArray.push(olLayer.on('change', () => {\n          const currentStyleFunction = olLayer.getStyleFunction();\n          if (previousStyleFunction === currentStyleFunction) {\n            return;\n          }\n          previousStyleFunction = currentStyleFunction;\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            const csObj = cesiumObjects[i];\n            // clear cache and set new style\n            // @ts-ignore TS2341\n            if (csObj._imageryCache) {\n              // @ts-ignore TS2341\n              csObj._imageryCache = {};\n            }\n\n            const ip = csObj.imageryProvider;\n            if (ip) {\n              // @ts-ignore TS2341\n              ip.tileCache?.clear();\n              // @ts-ignore TS2341\n              ip.styleFunction_ = currentStyleFunction;\n            }\n          }\n          this.scene.requestRender();\n        }));\n      }\n\n      for (let i = 0; i < cesiumObjects.length; ++i) {\n        updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n      }\n\n      // there is no way to modify Cesium layer extent,\n      // we have to recreate when OpenLayers layer extent changes:\n      listenKeyArray.push(olLayer.on('change:extent', (e) => {\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          this.cesiumLayers_.remove(cesiumObjects[i], true); // destroy\n          this.ourLayers_.remove(cesiumObjects[i], false);\n        }\n        delete this.layerMap[getUid(olLayer)]; // invalidate the map entry\n        this.synchronize();\n      }));\n\n      listenKeyArray.push(olLayer.on('change', (e) => {\n        // when the source changes, re-add the layer to force update\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          const position = this.cesiumLayers_.indexOf(cesiumObjects[i]);\n          if (position >= 0) {\n            this.cesiumLayers_.remove(cesiumObjects[i], false);\n            this.cesiumLayers_.add(cesiumObjects[i], position);\n          }\n        }\n      }));\n\n      this.olLayerListenKeys[uid].push(...listenKeyArray);\n    }\n\n    return Array.isArray(cesiumObjects) ? cesiumObjects : null;\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @override\n   * @protected\n   */\n  orderLayers() {\n    const layers = [];\n    const zIndices: Record<number, number> = {};\n    const queue: Array<BaseLayer | LayerGroup> = [this.mapLayerGroup];\n\n    while (queue.length > 0) {\n      const olLayer = queue.splice(0, 1)[0];\n      layers.push(olLayer);\n      zIndices[getUid(olLayer)] = olLayer.getZIndex() || 0;\n\n      if (olLayer instanceof LayerGroup) {\n        const sublayers = olLayer.getLayers();\n        if (sublayers) {\n          // Prepend queue with sublayers in order\n          queue.unshift(...sublayers.getArray());\n        }\n      }\n    }\n\n    // We assume sort is stable (which has been in the spec since a long time already).\n    // See https://caniuse.com/mdn-javascript_builtins_array_sort_stable\n    layers.sort((layer1, layer2) =>\n      zIndices[getUid(layer1)] - zIndices[getUid(layer2)]\n    );\n\n    layers.forEach((olLayer) => {\n      const olLayerId = getUid(olLayer).toString();\n      const cesiumObjects = this.layerMap[olLayerId];\n      if (cesiumObjects) {\n        cesiumObjects.forEach((cesiumObject) => { this.raiseToTop(cesiumObject); });\n      }\n    });\n  }\n\n  raiseToTop(counterpart: ImageryLayer) {\n    this.cesiumLayers_.raiseToTop(counterpart);\n  }\n}\n","import OLOverlay from 'ol/Overlay.js';\nimport {transform} from 'ol/proj.js';\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport type {Scene} from 'cesium';\nimport type OverlaySynchronizer from './OverlaySynchronizer';\nimport type {EventsKey} from 'ol/events';\nimport type {ObjectEvent} from 'ol/Object';\n\n\n/**\n * @param node The node to remove.\n * @return The node that was removed or null.\n */\nfunction removeNode(node: Node): Node {\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\n}\n\n/**\n * @param {Node} node The node to remove the children from.\n */\nfunction removeChildren(node: Node) {\n  while (node.lastChild) {\n    node.removeChild(node.lastChild);\n  }\n}\n\nfunction cloneNode<T extends Node, U extends Node>(node: T, parent: U): T {\n  const clone = node.cloneNode() as T;\n  if (node.nodeName === 'CANVAS') {\n    const ctx = (clone as unknown as HTMLCanvasElement).getContext('2d');\n    ctx.drawImage(node as unknown as HTMLCanvasElement, 0, 0);\n  }\n  if (parent) {\n    parent.appendChild(clone);\n  }\n  if (node.nodeType !== Node.TEXT_NODE) {\n    clone.addEventListener('click', (event) => {\n      node.dispatchEvent(new MouseEvent('click', event));\n      event.stopPropagation();\n    });\n  }\n  const nodes = node.childNodes;\n  for (let i = 0; i < nodes.length; i++) {\n    if (!nodes[i]) {\n      continue;\n    }\n    cloneNode(nodes[i], clone);\n  }\n  return clone;\n}\n\n\ninterface SynchronizedOverlayOptions {\n  scene: Scene;\n  parent: OLOverlay;\n  synchronizer: OverlaySynchronizer;\n}\n\n\nexport default class SynchronizedOverlay extends OLOverlay {\n\n  private scenePostRenderListenerRemover_?: Function = null;\n  private scene_: Scene;\n  private synchronizer_: OverlaySynchronizer;\n  private parent_: OLOverlay;\n  private positionWGS84_: number[];\n  private observer_: MutationObserver;\n  private attributeObserver_: MutationObserver[] = [];\n  private listenerKeys_: EventsKey[];\n\n\n  /**\n   * @param options SynchronizedOverlay Options.\n   * @api\n   */\n  constructor(options: SynchronizedOverlayOptions) {\n    const parent = options.parent;\n    super(parent.getOptions());\n    this.scene_ = options.scene;\n    this.synchronizer_ = options.synchronizer;\n    this.parent_ = parent;\n    this.positionWGS84_ = undefined;\n    this.observer_ = new MutationObserver(this.handleElementChanged.bind(this));\n    this.attributeObserver_ = [];\n    this.listenerKeys_ = [];\n\n    // synchronize our Overlay with the parent Overlay\n    const setPropertyFromEvent = (event: ObjectEvent) => this.setPropertyFromEvent_(event);\n    this.listenerKeys_.push(this.parent_.on('change:element', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:offset', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:positioning', setPropertyFromEvent));\n\n    this.setProperties(this.parent_.getProperties());\n\n    this.handleMapChanged();\n    this.handleElementChanged();\n  }\n\n  /**\n   * @param target\n   */\n  private observeTarget_(target: Node) {\n    if (!this.observer_) {\n      // not ready, skip the event (this occurs on construction)\n      return;\n    }\n    this.observer_.disconnect();\n    this.observer_.observe(target, {\n      attributes: false,\n      childList: true,\n      characterData: true,\n      subtree: true\n    });\n    this.attributeObserver_.forEach((observer) => {\n      observer.disconnect();\n    });\n    this.attributeObserver_.length = 0;\n    for (let i = 0; i < target.childNodes.length; i++) {\n      const node = target.childNodes[i];\n      if (node.nodeType === 1) {\n        const observer = new MutationObserver(this.handleElementChanged.bind(this));\n        observer.observe(node, {\n          attributes: true,\n          subtree: true\n        });\n        this.attributeObserver_.push(observer);\n      }\n    }\n  }\n\n  /**\n   *\n   * @param event\n   */\n  private setPropertyFromEvent_(event: ObjectEvent) {\n    if (event.target && event.key) {\n      this.set(event.key, event.target.get(event.key));\n    }\n  }\n\n  /**\n   * Get the scene associated with this overlay.\n   * @see ol.Overlay.prototype.getMap\n   * @return The scene that the overlay is part of.\n   * @api\n   */\n  getScene(): Scene {\n    return this.scene_;\n  }\n\n  /**\n   * @override\n   */\n  handleMapChanged() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n      removeNode(this.element);\n    }\n    this.scenePostRenderListenerRemover_ = null;\n    const scene = this.getScene();\n    if (scene) {\n      this.scenePostRenderListenerRemover_ = scene.postRender.addEventListener(this.updatePixelPosition.bind(this));\n      this.updatePixelPosition();\n      const container = this.stopEvent ?\n        this.synchronizer_.getOverlayContainerStopEvent() : this.synchronizer_.getOverlayContainer();\n      if (this.insertFirst) {\n        container.insertBefore(this.element, container.childNodes[0] || null);\n      } else {\n        container.appendChild(this.element);\n      }\n    }\n  }\n\n  /**\n   * @override\n   */\n  handlePositionChanged() {\n    // transform position to WGS84\n    const position = this.getPosition();\n    if (position) {\n      const sourceProjection = this.parent_.getMap().getView().getProjection();\n      this.positionWGS84_ = transform(position, sourceProjection, 'EPSG:4326');\n    } else {\n      this.positionWGS84_ = undefined;\n    }\n    this.updatePixelPosition();\n  }\n\n  /**\n   * @override\n   */\n  handleElementChanged() {\n    removeChildren(this.element);\n    const element = this.getElement();\n    if (element) {\n      if (element.parentNode && element.parentNode.childNodes) {\n        for (const node of Array.from(element.parentNode.childNodes)) {\n          const clonedNode = cloneNode(node, null);\n          this.element.appendChild(clonedNode);\n        }\n      }\n    }\n    if (element.parentNode) {\n      // set new Observer\n      this.observeTarget_(element.parentNode);\n    }\n  }\n\n  /**\n   * @override\n   */\n  updatePixelPosition() {\n    const position = this.positionWGS84_;\n    if (!this.scene_ || !position) {\n      this.setVisible(false);\n      return;\n    }\n    let height = 0;\n    if (position.length === 2) {\n      const globeHeight = this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(position[0], position[1]));\n      if (globeHeight && this.scene_.globe.tilesLoaded) {\n        position[2] = globeHeight;\n      }\n      if (globeHeight) {\n        height = globeHeight;\n      }\n    } else {\n      height = position[2];\n    }\n    const cartesian = Cesium.Cartesian3.fromDegrees(position[0], position[1], height);\n    const camera = this.scene_.camera;\n    const ellipsoidBoundingSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(), 6356752);\n    const occluder = new Cesium.Occluder(ellipsoidBoundingSphere, camera.position);\n    // check if overlay position is behind the horizon\n    if (!occluder.isPointVisible(cartesian)) {\n      this.setVisible(false);\n      return;\n    }\n    const cullingVolume = camera.frustum.computeCullingVolume(camera.position, camera.direction, camera.up);\n    // check if overlay position is visible from the camera\n    if (cullingVolume.computeVisibility(new Cesium.BoundingSphere(cartesian)) !== 1) {\n      this.setVisible(false);\n      return;\n    }\n    this.setVisible(true);\n\n    const pixelCartesian = this.scene_.cartesianToCanvasCoordinates(cartesian);\n    const pixel = [pixelCartesian.x, pixelCartesian.y];\n    const mapSize = [this.scene_.canvas.width, this.scene_.canvas.height];\n    this.updateRenderedPosition(pixel, mapSize);\n  }\n\n  /**\n   * Destroys the overlay, removing all its listeners and elements\n   * @api\n   */\n  destroy() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n    }\n    if (this.observer_) {\n      this.observer_.disconnect();\n    }\n    olObservableUnByKey(this.listenerKeys_);\n    this.listenerKeys_.splice(0);\n    if ('removeNode' in this.element) {\n      // @ts-ignore\n      this.element.removeNode(true);\n    } else {\n      this.element.remove();\n    }\n    this.element = null;\n  }\n}\n","import olSourceVector, {type VectorSourceEvent} from 'ol/source/Vector.js';\nimport olLayerLayer from 'ol/layer/Layer.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport {getUid} from './util';\nimport olLayerVector from 'ol/layer/Vector.js';\nimport olLayerVectorTile from 'ol/layer/VectorTile.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer';\nimport olcsFeatureConverter from './FeatureConverter';\nimport type VectorLayerCounterpart from './core/VectorLayerCounterpart';\n// eslint-disable-next-line no-duplicate-imports\nimport {\n  type OlFeatureToCesiumContext,\n  type PrimitiveCollectionCounterpart\n} from './core/VectorLayerCounterpart';\nimport type Map from 'ol/Map.js';\nimport {type LayerWithParents} from './core';\nimport type Feature from 'ol/Feature.js';\nimport type BaseLayer from 'ol/layer/Base.js';\nimport type {PrimitiveCollection, Scene} from 'cesium';\n\nexport default class VectorSynchronizer extends olcsAbstractSynchronizer<VectorLayerCounterpart> {\n  protected converter: olcsFeatureConverter;\n  private csAllPrimitives_: PrimitiveCollection;\n  /**\n   * Unidirectionally synchronize OpenLayers vector layers to Cesium.\n   */\n  constructor(map: Map, scene: Scene, opt_converter?: olcsFeatureConverter) {\n    super(map, scene);\n\n    this.converter = opt_converter || new olcsFeatureConverter(scene);\n    this.csAllPrimitives_ = new Cesium.PrimitiveCollection();\n    scene.primitives.add(this.csAllPrimitives_);\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  addCesiumObject(counterpart: VectorLayerCounterpart) {\n    console.assert(counterpart);\n    const collection = <PrimitiveCollectionCounterpart>counterpart.getRootPrimitive();\n    collection.counterpart = counterpart;\n    this.csAllPrimitives_.add(counterpart.getRootPrimitive());\n  }\n\n  destroyCesiumObject(object: VectorLayerCounterpart) {\n    object.getRootPrimitive().destroy();\n  }\n\n  removeSingleCesiumObject(object: VectorLayerCounterpart, destroy: boolean) {\n    object.destroy();\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    this.csAllPrimitives_.remove(object.getRootPrimitive());\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  removeAllCesiumObjects(destroy: boolean) {\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    if (destroy) {\n      for (let i = 0; i < this.csAllPrimitives_.length; ++i) {\n        this.csAllPrimitives_.get(i)['counterpart'].destroy();\n      }\n    }\n    this.csAllPrimitives_.removeAll();\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * Synchronizes the layer visibility properties\n   * to the given Cesium Primitive.\n   */\n  updateLayerVisibility(olLayerWithParents: LayerWithParents, csPrimitive: PrimitiveCollection) {\n    let visible = true;\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n      const layerVisible = olLayer.getVisible();\n      if (layerVisible !== undefined) {\n        visible = visible && layerVisible;\n      } else {\n        visible = false;\n      }\n    });\n    csPrimitive.show = visible;\n  }\n\n  createSingleLayerCounterparts(olLayerWithParents: LayerWithParents): VectorLayerCounterpart[] {\n    const olLayer: BaseLayer = olLayerWithParents.layer;\n    if (!(olLayer instanceof olLayerVector) || olLayer instanceof olLayerVectorTile) {\n      return null;\n    }\n    console.assert(olLayer instanceof olLayerLayer);\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    if (!source) {\n      return null;\n    }\n\n    console.assert(source instanceof olSourceVector);\n    console.assert(this.view);\n\n    const view = this.view;\n    const featurePrimitiveMap: Record<number, PrimitiveCollection> = {};\n    const counterpart: VectorLayerCounterpart = this.converter.olVectorLayerToCesium(olLayer, view, featurePrimitiveMap);\n    const csPrimitives = counterpart.getRootPrimitive();\n    const olListenKeys = counterpart.olListenKeys;\n\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n      olListenKeys.push(olLayerItem.on('change:visible', () => {\n        this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n      }));\n    });\n    this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n\n    const onAddFeature = (feature: Feature) => {\n      const context = counterpart.context;\n      const prim: PrimitiveCollection = this.converter.convert(olLayer, view, feature, context);\n      if (prim) {\n        featurePrimitiveMap[getUid(feature)] = prim;\n        csPrimitives.add(prim);\n      }\n    };\n\n    const onRemoveFeature = (feature: Feature) => {\n      const id = getUid(feature);\n      const context: OlFeatureToCesiumContext = counterpart.context;\n      const bbs = context.featureToCesiumMap[id];\n      if (bbs) {\n        delete context.featureToCesiumMap[id];\n        bbs.forEach((bb) => {\n          if (bb instanceof Cesium.Billboard) {\n            context.billboards.remove(bb);\n          }\n        });\n      }\n      const csPrimitive = featurePrimitiveMap[id];\n      delete featurePrimitiveMap[id];\n      if (csPrimitive) {\n        csPrimitives.remove(csPrimitive);\n      }\n    };\n\n    olListenKeys.push(source.on('addfeature', (e: VectorSourceEvent) => {\n      console.assert(e.feature);\n      onAddFeature(e.feature);\n    }));\n\n    olListenKeys.push(source.on('removefeature', (e: VectorSourceEvent) => {\n      console.assert(e.feature);\n      onRemoveFeature(e.feature);\n    }));\n\n    olListenKeys.push(source.on('changefeature', (e: VectorSourceEvent) => {\n      const feature = e.feature;\n      console.assert(feature);\n      onRemoveFeature(feature);\n      onAddFeature(feature);\n    }));\n\n    return counterpart ? [counterpart] : null;\n  }\n}\n","export default class LazyLoader {\n  private promise: Promise<void> | undefined;\n  private url_: string;\n\n  /**\n   * @param url\n   * @api\n   */\n  constructor(url: string) {\n    this.url_ = url;\n  }\n\n  /**\n   * Load Cesium by injecting a script tag.\n   * @api\n   */\n  load(): Promise<void> {\n    if (!this.promise) {\n      // not yet loading\n      this.promise = new Promise((resolve, reject) => {\n        const script = document.createElement('script');\n        script.onload = () => resolve();\n        script.onerror = () => reject();\n        document.head.appendChild(script);\n        script.src = this.url_;\n      });\n    }\n    return this.promise;\n  }\n}\n","import olcsContribLazyLoader from './LazyLoader';\nimport OLCesium from '../OLCesium';\nimport {resetToNorthZenith, rotateAroundBottomCenter, computeSignedTiltAngleOnGlobe, pickBottomPoint, setHeadingUsingBottomCenter, limitCameraToBoundingSphere} from '../core';\nimport {toRadians} from '../math';\nimport Observable from 'ol/Observable.js';\nimport type OLMap from 'ol/Map.js';\nimport type {Extent} from 'ol/extent.js';\nimport type {BoundingSphere, Matrix4, Rectangle, Scene} from 'cesium';\n\n\n/**\n * @typedef {Object} ManagerOptions\n * @property {import('ol/Map.js').default} map\n * @property {import('ol/extent.js').Extent} [cameraExtentInRadians]\n * @property {string} [cesiumIonDefaultAccessToken]\n */\n\n\nexport default class Manager extends Observable {\n  private cesiumUrl_: string;\n  private boundingSphere_: BoundingSphere;\n  private promise_: Promise<OLCesium>;\n  private cesiumIonDefaultAccessToken_: string;\n  protected map: OLMap;\n  protected cameraExtentInRadians: Extent;\n  protected ol3d: OLCesium;\n  private cesiumInitialTilt_ = toRadians(50);\n\n  protected fogDensity = 0.0001;\n\n  protected fogSSEFactor = 25;\n\n  protected minimumZoomDistance = 2;\n\n  /**\n   * Limit the maximum distance to the earth to 10'000km.\n   */\n  protected maximumZoomDistance: number = 10000000;\n\n  // when closer to 3000m, restrict the available positions harder\n  protected limitCameraToBoundingSphereRatio = (height: number) => (height > 3000 ? 9 : 3);\n\n  /**\n   * @param {string} cesiumUrl\n   * @param {olcsx.contrib.ManagerOptions} options\n   * @api\n   */\n  constructor(cesiumUrl: string, {map, cameraExtentInRadians, cesiumIonDefaultAccessToken}: {map: OLMap, cameraExtentInRadians?: Extent, cesiumIonDefaultAccessToken?: string}) {\n    super();\n    this.cesiumUrl_ = cesiumUrl;\n    console.assert(map);\n    this.map = map;\n    this.cameraExtentInRadians = cameraExtentInRadians || null;\n    this.cesiumIonDefaultAccessToken_ = cesiumIonDefaultAccessToken;\n  }\n\n\n  /**\n   * Lazy load Cesium.\n   */\n  load(): Promise<OLCesium> {\n    if (!this.promise_) {\n      const cesiumLazyLoader = new olcsContribLazyLoader(this.cesiumUrl_);\n      this.promise_ = cesiumLazyLoader.load().then(() => this.onCesiumLoaded());\n    }\n    return this.promise_;\n  }\n\n\n  /**\n   * Hook called when Cesium has been lazy loaded.\n   */\n  protected onCesiumLoaded(): OLCesium {\n    if (this.cameraExtentInRadians) {\n      const rect = new Cesium.Rectangle(...this.cameraExtentInRadians);\n      // Set the fly home rectangle\n      Cesium.Camera.DEFAULT_VIEW_RECTANGLE = rect;\n      this.boundingSphere_ = Cesium.BoundingSphere.fromRectangle3D(rect, Cesium.Ellipsoid.WGS84, 300); // lux mean height is 300m\n    }\n\n    if (this.cesiumIonDefaultAccessToken_) {\n      Cesium.Ion.defaultAccessToken = this.cesiumIonDefaultAccessToken_;\n    }\n\n    this.ol3d = this.instantiateOLCesium();\n    const scene = this.ol3d.getCesiumScene();\n    this.configureForUsability(scene);\n    this.configureForPerformance(scene);\n    this.dispatchEvent('load');\n    return this.ol3d;\n  }\n\n\n  /**\n   * Application code should override this method.\n   */\n  instantiateOLCesium(): OLCesium {\n    const ol3d = new OLCesium({map: this.map});\n    const scene = ol3d.getCesiumScene();\n    // LEGACY\n    if ('createWorldTerrain' in Cesium) {\n      // @ts-ignore\n      const terrainProvider = Cesium.createWorldTerrain();\n      scene.terrainProvider = terrainProvider;\n    } else {\n      // v107+\n      Cesium.createWorldTerrainAsync().then(tp => scene.terrainProvider = tp);\n    }\n\n    return ol3d;\n  }\n\n\n  /**\n   * Override with custom performance optimization logics, if needed.\n   */\n  protected configureForPerformance(scene: Scene) {\n    const fog = scene.fog;\n    fog.enabled = true;\n    fog.density = this.fogDensity;\n    fog.screenSpaceErrorFactor = this.fogSSEFactor;\n  }\n\n\n  /**\n   * Override with custom usabliity logics, id needed.\n   */\n  configureForUsability(scene: Scene) {\n    const sscController = scene.screenSpaceCameraController;\n    sscController.minimumZoomDistance = this.minimumZoomDistance;\n    sscController.maximumZoomDistance = this.maximumZoomDistance;\n\n    // Do not see through the terrain. Seeing through the terrain does not make\n    // sense anyway, except for debugging\n    scene.globe.depthTestAgainstTerrain = true;\n\n    // Use white instead of the black default colour for the globe when tiles are missing\n    scene.globe.baseColor = Cesium.Color.WHITE;\n    scene.backgroundColor = Cesium.Color.WHITE;\n\n    if (this.boundingSphere_) {\n      scene.postRender.addEventListener(this.limitCameraToBoundingSphere.bind(this));\n    }\n    // Stop rendering Cesium when there is nothing to do. This drastically reduces CPU/GPU consumption.\n    this.ol3d.enableAutoRenderLoop();\n  }\n\n  /**\n   * Constrain the camera so that it stays close to the bounding sphere of the map extent.\n   * Near the ground the allowed distance is shorter.\n   */\n  protected limitCameraToBoundingSphere() {\n    const scene = this.ol3d.getCesiumScene();\n    limitCameraToBoundingSphere(scene.camera, this.boundingSphere_, this.limitCameraToBoundingSphereRatio);\n  }\n\n  /**\n   * Enable or disable ol3d with a default animation.\n   */\n  toggle3d(): Promise<void> {\n    return this.load().then((/** @const {!olcs.OLCesium} */ ol3d) => {\n      const is3DCurrentlyEnabled = ol3d.getEnabled();\n      const scene = ol3d.getCesiumScene();\n      if (is3DCurrentlyEnabled) {\n        // Disable 3D\n        console.assert(this.map);\n        return resetToNorthZenith(this.map, scene).then(() => {\n          ol3d.setEnabled(false);\n          this.dispatchEvent('toggle');\n        });\n      } else {\n        // Enable 3D\n        ol3d.setEnabled(true);\n        this.dispatchEvent('toggle');\n        return rotateAroundBottomCenter(scene, this.cesiumInitialTilt_);\n      }\n    });\n  }\n\n\n  /**\n   * Enable ol3d with a view built from parameters.\n   */\n  set3dWithView(lon: number, lat: number, elevation: number, headingDeg: number, pitchDeg: number): Promise<void> {\n    return this.load().then((ol3d) => {\n      const is3DCurrentlyEnabled = ol3d.getEnabled();\n      const scene = ol3d.getCesiumScene();\n      const camera = scene.camera;\n      const destination = Cesium.Cartesian3.fromDegrees(lon, lat, elevation);\n      const heading = Cesium.Math.toRadians(headingDeg);\n      const pitch = Cesium.Math.toRadians(pitchDeg);\n      const roll = 0;\n      const orientation = {heading, pitch, roll};\n\n      if (!is3DCurrentlyEnabled) {\n        ol3d.setEnabled(true);\n        this.dispatchEvent('toggle');\n      }\n\n      camera.setView({\n        destination,\n        orientation\n      });\n    });\n  }\n\n\n  /**\n   * Whether OL-Cesium has been loaded and 3D mode is enabled.\n   */\n  is3dEnabled(): boolean {\n    return !!this.ol3d && this.ol3d.getEnabled();\n  }\n\n\n  /**\n   * @return {number}\n   */\n  getHeading(): number {\n    return this.map ? this.map.getView().getRotation() || 0 : 0;\n  }\n\n\n  /**\n   * @return {number|undefined}\n   */\n  getTiltOnGlobe() {\n    const scene = this.ol3d.getCesiumScene();\n    const tiltOnGlobe = computeSignedTiltAngleOnGlobe(scene);\n    return -tiltOnGlobe;\n  }\n\n\n  /**\n   * Set heading.\n   * This assumes ol3d has been loaded.\n   */\n  setHeading(angle: number) {\n    const scene = this.ol3d.getCesiumScene();\n    const bottom = pickBottomPoint(scene);\n    if (bottom) {\n      setHeadingUsingBottomCenter(scene, angle, bottom);\n    }\n  }\n\n  getOl3d(): OLCesium {\n    return this.ol3d;\n  }\n\n  getCesiumViewMatrix(): Matrix4 {\n    return this.ol3d.getCesiumScene().camera.viewMatrix;\n  }\n\n  getCesiumScene(): Scene {\n    return this.ol3d.getCesiumScene();\n  }\n\n  /**\n   * Fly to some rectangle.\n   * This assumes ol3d has been loaded.\n   */\n  flyToRectangle(rectangle: Rectangle, offset = 0): Promise<void> {\n    const camera = this.getCesiumScene().camera;\n    const destination = camera.getRectangleCameraCoordinates(rectangle);\n\n    const mag = Cesium.Cartesian3.magnitude(destination) + offset;\n    Cesium.Cartesian3.normalize(destination, destination);\n    Cesium.Cartesian3.multiplyByScalar(destination, mag, destination);\n\n    return new Promise((resolve, reject) => {\n      if (!this.cameraExtentInRadians) {\n        reject();\n        return;\n      }\n\n      camera.flyTo({\n        destination,\n        complete: () => resolve(),\n        cancel: () => reject(),\n        endTransform: Cesium.Matrix4.IDENTITY\n      });\n    });\n  }\n}\n","import {linear as linearEasing} from 'ol/easing.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport {get as getProjection, type ProjectionLike, transformExtent} from 'ol/proj.js';\nimport olSourceImageStatic from 'ol/source/ImageStatic.js';\nimport olSourceImageWMS from 'ol/source/ImageWMS.js';\nimport olSourceTileImage from 'ol/source/TileImage.js';\nimport olSourceTileWMS from 'ol/source/TileWMS.js';\nimport olSourceVectorTile from 'ol/source/VectorTile.js';\nimport {defaultImageLoadFunction} from 'ol/source/Image.js';\nimport olcsCoreOLImageryProvider from './core/OLImageryProvider';\nimport {getSourceProjection} from './util';\nimport MVTImageryProvider from './MVTImageryProvider';\nimport VectorTileLayer from 'ol/layer/VectorTile.js';\nimport {type Extent, getCenter as getExtentCenter} from 'ol/extent.js';\nimport type BaseLayer from 'ol/layer/Base.js';\nimport type LayerGroup from 'ol/layer/Group.js';\nimport type {\n  BoundingSphere,\n  Camera,\n  Cartesian2,\n  Cartesian3,\n  Cartographic,\n  Color, ImageMaterialProperty,\n  ImageryLayer,\n  Matrix4,\n  Ray,\n  Rectangle,\n  Scene,\n  SingleTileImageryProvider\n} from 'cesium';\nimport type Geometry from 'ol/geom/Geometry.js';\nimport type {Coordinate} from 'ol/coordinate.js';\nimport type Source from 'ol/source/Source.js';\n// eslint-disable-next-line no-duplicate-imports\nimport type {Attribution} from 'ol/source/Source.js';\n\nimport type Map from 'ol/Map.js';\nimport type Projection from 'ol/proj/Projection.js';\nimport type {Color as OLColor} from 'ol/color.js';\nimport type View from 'ol/View.js';\n\ntype CesiumUrlDefinition = {\n    url: string,\n    subdomains: string\n}\n\n\n/**\n * Options for rotate around axis core function.\n */\ntype RotateAroundAxisOption = {\n  duration?: number,\n  easing?: (value: number) => number,\n  callback: () => void\n}\n\n\nexport type LayerWithParents = {\n  layer: BaseLayer,\n  parents: LayerGroup[] | BaseLayer[]\n}\n\n\n/**\n * Compute the pixel width and height of a point in meters using the\n * camera frustum.\n */\nexport function computePixelSizeAtCoordinate(scene: Scene, target: Cartesian3): Cartesian2 {\n  const camera = scene.camera;\n  const canvas = scene.canvas;\n  const frustum = camera.frustum;\n  const distance = Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(\n      camera.position, target, new Cesium.Cartesian3()));\n  // @ts-ignore TS2341\n  return frustum.getPixelDimensions(canvas.clientWidth, canvas.clientHeight, distance, scene.pixelRatio, new Cesium.Cartesian2());\n}\n\n\n/**\n * Compute bounding box around a target point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @param {number} amount Half the side of the box, in pixels.\n * @return {Array<Cesium.Cartographic>} bottom left and top right\n * coordinates of the box\n */\nexport function computeBoundingBoxAtTarget(scene: Scene, target: Cartesian3, amount: number): Cartographic[] {\n  const pixelSize = computePixelSizeAtCoordinate(scene, target);\n  const transform = Cesium.Transforms.eastNorthUpToFixedFrame(target);\n\n  const bottomLeft = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(-pixelSize.x * amount, -pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  const topRight = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(pixelSize.x * amount, pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray(\n      [bottomLeft, topRight]);\n}\n\nexport function applyHeightOffsetToGeometry(geometry: Geometry, height: number) {\n  geometry.applyTransform((input, output, stride) => {\n    console.assert(input === output);\n    if (stride !== undefined && stride >= 3) {\n      for (let i = 0; i < output.length; i += stride) {\n        output[i + 2] = output[i + 2] + height;\n      }\n    }\n    return output;\n  });\n}\n\nexport function createMatrixAtCoordinates(\n    coordinates: Coordinate,\n    rotation = 0,\n    translation = Cesium.Cartesian3.ZERO,\n    scale = new Cesium.Cartesian3(1, 1, 1)\n): Matrix4 {\n  const position = ol4326CoordinateToCesiumCartesian(coordinates);\n  const rawMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(position);\n  const quaternion = Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z, -rotation);\n  const rotationMatrix = Cesium.Matrix4.fromTranslationQuaternionRotationScale(translation, quaternion, scale);\n  return Cesium.Matrix4.multiply(rawMatrix, rotationMatrix, new Cesium.Matrix4());\n}\n\nexport function rotateAroundAxis(camera: Camera, angle: number, axis: Cartesian3, transform: Matrix4,\n    opt_options?: RotateAroundAxisOption) {\n  const clamp = Cesium.Math.clamp;\n  const defaultValue = Cesium.defaultValue;\n\n  const options: RotateAroundAxisOption = opt_options;\n  const duration = defaultValue(options?.duration, 500); // ms\n  const easing = defaultValue(options?.easing, linearEasing);\n  const callback = options?.callback;\n\n  let lastProgress = 0;\n  const oldTransform = new Cesium.Matrix4();\n\n  const start = Date.now();\n  const step = function() {\n    const timestamp = Date.now();\n    const timeDifference = timestamp - start;\n    const progress = easing(clamp(timeDifference / duration, 0, 1));\n    console.assert(progress >= lastProgress);\n\n    camera.transform.clone(oldTransform);\n    const stepAngle = (progress - lastProgress) * angle;\n    lastProgress = progress;\n    camera.lookAtTransform(transform);\n    camera.rotate(axis, stepAngle);\n    camera.lookAtTransform(oldTransform);\n\n    if (progress < 1) {\n      window.requestAnimationFrame(step);\n    } else {\n      if (callback) {\n        callback();\n      }\n    }\n  };\n  window.requestAnimationFrame(step);\n}\n\nexport function setHeadingUsingBottomCenter(\n    scene: Scene,\n    heading: number,\n    bottomCenter: Cartesian3,\n    options?: RotateAroundAxisOption\n) {\n  const camera = scene.camera;\n  // Compute the camera position to zenith quaternion\n  const angleToZenith = computeAngleToZenith(scene, bottomCenter);\n  const axis = camera.right;\n  const quaternion = Cesium.Quaternion.fromAxisAngle(axis, angleToZenith);\n  const rotation = Cesium.Matrix3.fromQuaternion(quaternion);\n\n  // Get the zenith point from the rotation of the position vector\n  const vector = new Cesium.Cartesian3();\n  Cesium.Cartesian3.subtract(camera.position, bottomCenter, vector);\n  const zenith = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(rotation, vector, zenith);\n  Cesium.Cartesian3.add(zenith, bottomCenter, zenith);\n\n  // Actually rotate around the zenith normal\n  const transform = Cesium.Matrix4.fromTranslation(zenith);\n  rotateAroundAxis(camera, heading, zenith, transform, options);\n}\n\n\n/**\n * Get the 3D position of the given pixel of the canvas.\n */\nexport function pickOnTerrainOrEllipsoid(scene: Scene, pixel: Cartesian2): Cartesian3 {\n  const ray = scene.camera.getPickRay(pixel);\n  const target = scene.globe.pick(ray, scene);\n  return target || scene.camera.pickEllipsoid(pixel);\n}\n\n\n/**\n * Get the 3D position of the point at the bottom-center of the screen.\n */\nexport function pickBottomPoint(scene: Scene): Cartesian3 | undefined {\n  const canvas = scene.canvas;\n  const bottom = new Cesium.Cartesian2(\n      canvas.clientWidth / 2, canvas.clientHeight);\n  return pickOnTerrainOrEllipsoid(scene, bottom);\n}\n\n\n/**\n * Get the 3D position of the point at the center of the screen.\n */\nexport function pickCenterPoint(scene: Scene): Cartesian3 | undefined {\n  const canvas = scene.canvas;\n  const center = new Cesium.Cartesian2(\n      canvas.clientWidth / 2,\n      canvas.clientHeight / 2);\n  return pickOnTerrainOrEllipsoid(scene, center);\n}\n\n\n/**\n * Compute the signed tilt angle on globe, between the opposite of the\n * camera direction and the target normal. Return undefined if there is no\n */\nexport function computeSignedTiltAngleOnGlobe(scene: Scene): number | undefined {\n  const camera = scene.camera;\n  const ray = new Cesium.Ray(camera.position, camera.direction);\n  let target = scene.globe.pick(ray, scene);\n\n  if (!target) {\n    // no tiles in the area were loaded?\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const obj = Cesium.IntersectionTests.rayEllipsoid(ray, ellipsoid);\n    if (obj) {\n      target = Cesium.Ray.getPoint(ray, obj.start);\n    }\n  }\n\n  if (!target) {\n    return undefined;\n  }\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(target, normal);\n\n  const angleBetween = signedAngleBetween;\n  const angle = angleBetween(camera.direction, normal, camera.right) - Math.PI;\n  return Cesium.Math.convertLongitudeRange(angle);\n}\n\n\n/**\n * Compute the ray from the camera to the bottom-center of the screen.\n */\nexport function bottomFovRay(scene: Scene): Ray {\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fovy2 = camera.frustum.fovy / 2;\n  const direction = camera.direction;\n  const rotation = Cesium.Quaternion.fromAxisAngle(camera.right, fovy2);\n  const matrix = Cesium.Matrix3.fromQuaternion(rotation);\n  const vector = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(matrix, direction, vector);\n  return new Cesium.Ray(camera.position, vector);\n}\n\n\n/**\n * Compute the angle between two Cartesian3.\n */\nexport function signedAngleBetween(first: Cartesian3, second: Cartesian3, normal: Cartesian3): number {\n  // We are using the dot for the angle.\n  // Then the cross and the dot for the sign.\n  const a = new Cesium.Cartesian3();\n  const b = new Cesium.Cartesian3();\n  const c = new Cesium.Cartesian3();\n  Cesium.Cartesian3.normalize(first, a);\n  Cesium.Cartesian3.normalize(second, b);\n  Cesium.Cartesian3.cross(a, b, c);\n\n  const cosine = Cesium.Cartesian3.dot(a, b);\n  const sine = Cesium.Cartesian3.magnitude(c);\n\n  // Sign of the vector product and the orientation normal\n  const sign = Cesium.Cartesian3.dot(normal, c);\n  const angle = Math.atan2(sine, cosine);\n  return sign >= 0 ? angle : -angle;\n}\n\n\n/**\n * Compute the rotation angle around a given point, needed to reach the\n * zenith position.\n * At a zenith position, the camera direction is going througth the earth\n * center and the frustrum bottom ray is going through the chosen pivot\n * point.\n * The bottom-center of the screen is a good candidate for the pivot point.\n */\nexport function computeAngleToZenith(scene: Scene, pivot: Cartesian3): number {\n  // This angle is the sum of the angles 'fy' and 'a', which are defined\n  // using the pivot point and its surface normal.\n  //        Zenith |    camera\n  //           \\   |   /\n  //            \\fy|  /\n  //             \\ |a/\n  //              \\|/pivot\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fy = camera.frustum.fovy / 2;\n  const ray = bottomFovRay(scene);\n  const direction = Cesium.Cartesian3.clone(ray.direction);\n  Cesium.Cartesian3.negate(direction, direction);\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(pivot, normal);\n\n  const left = new Cesium.Cartesian3();\n  Cesium.Cartesian3.negate(camera.right, left);\n\n  const a = signedAngleBetween(normal, direction, left);\n  return a + fy;\n}\n\n\n/**\n * Convert an OpenLayers extent to a Cesium rectangle.\n * @param {ol.Extent} extent Extent.\n * @param {ol.ProjectionLike} projection Extent projection.\n * @return {Cesium.Rectangle} The corresponding Cesium rectangle.\n */\nexport function extentToRectangle(extent: Extent, projection: ProjectionLike) {\n  if (extent && projection) {\n    const ext = transformExtent(extent, projection, 'EPSG:4326');\n    return Cesium.Rectangle.fromDegrees(ext[0], ext[1], ext[2], ext[3]);\n  } else {\n    return null;\n  }\n}\n\nexport function sourceToImageryProvider(\n    olMap: Map,\n    source: Source,\n    viewProj: Projection,\n    olLayer: BaseLayer\n): olcsCoreOLImageryProvider | MVTImageryProvider | SingleTileImageryProvider {\n  const skip = source.get('olcs_skip');\n  if (skip) {\n    return null;\n  }\n  let provider = null;\n  // Convert ImageWMS to TileWMS\n  if (source instanceof olSourceImageWMS && source.getUrl() &&\n  source.getImageLoadFunction() === defaultImageLoadFunction) {\n    const sourceProps = {\n      'olcs.proxy': source.get('olcs.proxy'),\n      'olcs.extent': source.get('olcs.extent'),\n      'olcs.projection': source.get('olcs.projection'),\n      'olcs.imagesource': source\n    };\n    source = new olSourceTileWMS({\n      url: source.getUrl(),\n      attributions: source.getAttributions(),\n      projection: source.getProjection(),\n      params: source.getParams()\n    });\n    source.setProperties(sourceProps);\n  }\n\n  if (source instanceof olSourceTileImage) {\n    let projection = getSourceProjection(source);\n\n    if (!projection) {\n    // if not explicit, assume the same projection as view\n      projection = viewProj;\n    }\n\n    if (isCesiumProjection(projection)) {\n      provider = new olcsCoreOLImageryProvider(olMap, source, viewProj);\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else if (source instanceof olSourceImageStatic) {\n    let projection = getSourceProjection(source);\n    if (!projection) {\n      projection = viewProj;\n    }\n    if (isCesiumProjection(projection)) {\n      const rectangle: Rectangle = Cesium.Rectangle.fromDegrees(\n          source.getImageExtent()[0],\n          source.getImageExtent()[1],\n          source.getImageExtent()[2],\n          source.getImageExtent()[3],\n          new Cesium.Rectangle()\n      );\n      provider = new Cesium.SingleTileImageryProvider({\n        url: source.getUrl(),\n        rectangle\n      });\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else if (source instanceof olSourceVectorTile && olLayer instanceof VectorTileLayer) {\n    let projection = getSourceProjection(source);\n\n    if (!projection) {\n      projection = viewProj;\n    }\n    if (skip === false) {\n    // MVT is experimental, it should be whitelisted to be synchronized\n      const fromCode = projection.getCode().split(':')[1];\n      // @ts-ignore TS2341\n      const urls = source.urls.map(u => u.replace(fromCode, '3857'));\n      const extent = olLayer.getExtent();\n      const rectangle = extentToRectangle(extent, projection);\n      const minimumLevel = source.get('olcs_minimumLevel');\n      const attributionsFunction = source.getAttributions();\n      const styleFunction = olLayer.getStyleFunction();\n      let credit;\n      if (extent && attributionsFunction) {\n        const center = getExtentCenter(extent);\n        credit = attributionsFunctionToCredits(attributionsFunction, 0, center, extent)[0];\n      }\n\n      provider = new MVTImageryProvider({\n        credit,\n        rectangle,\n        minimumLevel,\n        styleFunction,\n        urls\n      });\n      return provider;\n    }\n    return null; // FIXME: it is disabled by default right now\n  } else {\n    // sources other than TileImage|Imageexport function are currently not supported\n    return null;\n  }\n  return provider;\n}\n\n/**\n * Creates Cesium.ImageryLayer best corresponding to the given ol.layer.Layer.\n * Only supports raster layers and export function images\n */\nexport function tileLayerToImageryLayer(olMap: Map, olLayer: BaseLayer, viewProj: Projection): ImageryLayer | null {\n\n  if (!(olLayer instanceof olLayerTile) && !(olLayer instanceof olLayerImage) &&\n  !(olLayer instanceof VectorTileLayer)) {\n    return null;\n  }\n\n  const source = olLayer.getSource();\n  if (!source) {\n    return null;\n  }\n  let provider = source.get('olcs_provider');\n  if (!provider) {\n    provider = sourceToImageryProvider(olMap, source, viewProj, olLayer);\n  }\n  if (!provider) {\n    return null;\n  }\n\n  const layerOptions: {rectangle?: Rectangle} = {};\n\n  const forcedExtent = (olLayer.get('olcs.extent'));\n  const ext = forcedExtent || olLayer.getExtent();\n  if (ext) {\n    layerOptions.rectangle = extentToRectangle(ext, viewProj);\n  }\n\n  const cesiumLayer = new Cesium.ImageryLayer(provider, layerOptions);\n  return cesiumLayer;\n}\n\n\n/**\n * Synchronizes the layer rendering properties (opacity, visible)\n * to the given Cesium ImageryLayer.\n */\nexport function updateCesiumLayerProperties(olLayerWithParents: LayerWithParents, csLayer: ImageryLayer) {\n  let opacity = 1;\n  let visible = true;\n  [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n    const layerOpacity = olLayer.getOpacity();\n    if (layerOpacity !== undefined) {\n      opacity *= layerOpacity;\n    }\n    const layerVisible = olLayer.getVisible();\n    if (layerVisible !== undefined) {\n      visible = visible && layerVisible;\n    }\n  });\n  csLayer.alpha = opacity;\n  csLayer.show = visible;\n}\n\n\n/**\n * Convert a 2D or 3D OpenLayers coordinate to Cesium.\n */\nexport function ol4326CoordinateToCesiumCartesian(coordinate: Coordinate): Cartesian3 {\n  const coo = coordinate;\n  return coo.length > 2 ?\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1], coo[2]) :\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1]);\n}\n\n\n/**\n * Convert an array of 2D or 3D OpenLayers coordinates to Cesium.\n */\nexport function ol4326CoordinateArrayToCsCartesians(coordinates: Coordinate[]): Cartesian3[] {\n  console.assert(coordinates !== null);\n  const toCartesian = ol4326CoordinateToCesiumCartesian;\n  const cartesians = [];\n  for (let i = 0; i < coordinates.length; ++i) {\n    cartesians.push(toCartesian(coordinates[i]));\n  }\n  return cartesians;\n}\n\n\n/**\n * Reproject an OpenLayers geometry to EPSG:4326 if needed.\n * The geometry will be cloned only when original projection is not EPSG:4326\n * and the properties will be shallow copied.\n */\nexport function olGeometryCloneTo4326<T extends Geometry>(geometry: T, projection: ProjectionLike): T {\n  console.assert(projection);\n\n  const proj4326 = getProjection('EPSG:4326');\n  const proj = getProjection(projection);\n  if (proj.getCode() !== proj4326.getCode()) {\n    const properties = geometry.getProperties();\n    geometry = geometry.clone() as T;\n    geometry.transform(proj, proj4326);\n    geometry.setProperties(properties);\n  }\n  return geometry;\n}\n\n\n/**\n * Convert an OpenLayers color to Cesium.\n */\nexport function convertColorToCesium(olColor: OLColor | CanvasGradient | CanvasPattern | string): Color | ImageMaterialProperty {\n  olColor = olColor || 'black';\n  if (Array.isArray(olColor)) {\n    return new Cesium.Color(\n        Cesium.Color.byteToFloat(olColor[0]),\n        Cesium.Color.byteToFloat(olColor[1]),\n        Cesium.Color.byteToFloat(olColor[2]),\n        olColor[3]\n    );\n  } else if (typeof olColor == 'string') {\n    return Cesium.Color.fromCssColorString(olColor);\n  } else if (olColor instanceof CanvasPattern || olColor instanceof CanvasGradient) {\n    // Render the CanvasPattern/CanvasGradient into a canvas that will be sent to Cesium as material\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    canvas.width = canvas.height = 256;\n    ctx.fillStyle = olColor;\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    return new Cesium.ImageMaterialProperty({\n      image: canvas\n    });\n  }\n  console.assert(false, 'impossible');\n}\n\n\n/**\n * Convert an OpenLayers url to Cesium.\n */\nexport function convertUrlToCesium(url: string): CesiumUrlDefinition {\n  let subdomains = '';\n  const re = /\\{(\\d|[a-z])-(\\d|[a-z])\\}/;\n  const match = re.exec(url);\n  if (match) {\n    url = url.replace(re, '{s}');\n    const startCharCode = match[1].charCodeAt(0);\n    const stopCharCode = match[2].charCodeAt(0);\n    let charCode;\n    for (charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\n      subdomains += String.fromCharCode(charCode);\n    }\n  }\n  return {\n    url,\n    subdomains\n  };\n}\n\n\n/**\n * Animate the return to a top-down view from the zenith.\n * The camera is rotated to orient to the North.\n */\nexport function resetToNorthZenith(map: Map, scene: Scene): Promise<undefined> {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = pickBottomPoint(scene);\n    if (!pivot) {\n      reject('Could not get bottom pivot');\n      return;\n    }\n\n    const currentHeading = map.getView().getRotation();\n    if (currentHeading === undefined) {\n      reject('The view is not initialized');\n      return;\n    }\n    const angle = computeAngleToZenith(scene, pivot);\n\n    // Point to North\n    setHeadingUsingBottomCenter(scene, currentHeading, pivot);\n\n    // Go to zenith\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const options: RotateAroundAxisOption = {\n      callback: () => {\n        const view = map.getView();\n        normalizeView(view);\n        resolve(undefined);\n      }\n    };\n    rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n}\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} angle in radian\n * @return {Promise<undefined>}\n * @api\n */\nexport function rotateAroundBottomCenter(scene: Scene, angle: number): Promise<undefined> {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = pickBottomPoint(scene);\n    if (!pivot) {\n      reject('could not get bottom pivot');\n      return;\n    }\n\n    const options: RotateAroundAxisOption = {callback: () => resolve(undefined)};\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n}\n\n\n/**\n * Set the OpenLayers view to a specific rotation and\n * the nearest resolution.\n */\nexport function normalizeView(view: View, angle = 0) {\n  const resolution = view.getResolution();\n  view.setRotation(angle);\n\n  // @ts-ignore TS2341\n  if (view.constrainResolution) {\n    // @ts-ignore TS2341\n    view.setResolution(view.constrainResolution(resolution));\n  } else {\n    view.setResolution(view.getConstrainedResolution(resolution));\n  }\n}\n\n/**\n * Check if the given projection is managed by Cesium (WGS84 or Mercator Spheric)\n */\nexport function isCesiumProjection(projection: Projection): boolean {\n  const is3857 = projection.getCode() === 'EPSG:3857';\n  const is4326 = projection.getCode() === 'EPSG:4326';\n  return is3857 || is4326;\n}\n\nexport function attributionsFunctionToCredits(\n    attributionsFunction: Attribution | null,\n    zoom: number,\n    center: Coordinate,\n    extent: Extent\n) {\n\n  if (!attributionsFunction) {\n    return [];\n  }\n  let attributions = attributionsFunction({\n    viewState: {zoom, center, projection: undefined, resolution: undefined, rotation: undefined},\n    extent,\n  });\n  if (!Array.isArray(attributions)) {\n    attributions = [attributions];\n  }\n\n  return attributions.map(html => new Cesium.Credit(html, true));\n}\n\n/**\n * calculate the distance between camera and centerpoint based on the resolution and latitude value\n */\nexport function calcDistanceForResolution(\n    resolution: number,\n    latitude: number,\n    scene: Scene,\n    projection: Projection\n): number {\n  const canvas = scene.canvas;\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fovy = camera.frustum.fovy; // vertical field of view\n  console.assert(!isNaN(fovy));\n  const metersPerUnit = projection.getMetersPerUnit();\n\n  // number of \"map units\" visible in 2D (vertically)\n  const visibleMapUnits = resolution * canvas.clientHeight;\n\n  // The metersPerUnit does not take latitude into account, but it should\n  // be lower with increasing latitude -- we have to compensate.\n  // In 3D it is not possible to maintain the resolution at more than one point,\n  // so it only makes sense to use the latitude of the \"target\" point.\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n\n  // how many meters should be visible in 3D\n  const visibleMeters = visibleMapUnits * metersPerUnit * relativeCircumference;\n\n  // distance required to view the calculated length in meters\n  //\n  //  fovy/2\n  //    |\\\n  //  x | \\\n  //    |--\\\n  // visibleMeters/2\n  const requiredDistance = (visibleMeters / 2) / Math.tan(fovy / 2);\n\n  // NOTE: This calculation is not absolutely precise, because metersPerUnit\n  // is a great simplification. It does not take ellipsoid/terrain into account.\n\n  return requiredDistance;\n}\n\n/**\n * calculate the resolution based on a distance(camera to position) and latitude value\n */\nexport function calcResolutionForDistance(distance: number, latitude: number, scene: Scene, projection: Projection): number {\n  // See the reverse calculation (calcDistanceForResolution) for details\n  const canvas = scene.canvas;\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fovy = camera.frustum.fovy; // vertical field of view\n  console.assert(!isNaN(fovy));\n  const metersPerUnit = projection.getMetersPerUnit();\n\n  const visibleMeters = 2 * distance * Math.tan(fovy / 2);\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n  const visibleMapUnits = visibleMeters / metersPerUnit / relativeCircumference;\n  const resolution = visibleMapUnits / canvas.clientHeight;\n\n  return resolution;\n}\n\n/**\n * Constrain the camera so that it stays close to the bounding sphere of the map extent.\n * Near the ground the allowed distance is shorter.\n */\nexport function limitCameraToBoundingSphere(camera: Camera, boundingSphere: BoundingSphere, ratio: (height: number) => number): () => void {\n  let blockLimiter = false;\n  return function() {\n    if (!blockLimiter) {\n      const position = camera.position;\n      const carto = Cesium.Cartographic.fromCartesian(position);\n      if (Cesium.Cartesian3.distance(boundingSphere.center, position) > boundingSphere.radius * ratio(carto.height)) {\n        // @ts-ignore TS2339: FIXME, there is no flying property in Camera\n        const currentlyFlying = camera.flying;\n        if (currentlyFlying === true) {\n          // There is a flying property and its value is true\n          return;\n        } else {\n          blockLimiter = true;\n          const unblockLimiter = () => (blockLimiter = false);\n          camera.flyToBoundingSphere(boundingSphere, {\n            complete: unblockLimiter,\n            cancel: unblockLimiter,\n          });\n        }\n      }\n    }\n  };\n}\n","import {getSourceProjection} from '../util';\nimport {Tile as TileSource, type TileImage} from 'ol/source.js';\nimport {attributionsFunctionToCredits} from '../core';\nimport type {Map} from 'ol';\nimport type {Projection} from 'ol/proj.js';\nimport type {Credit, Event, ImageryLayerFeatureInfo, ImageryProvider, ImageryTypes, Proxy, Rectangle, Request, TileDiscardPolicy, TilingScheme} from 'cesium';\n\n\nexport function createEmptyCanvas(): HTMLCanvasElement {\n  const canvas = document.createElement('canvas');\n  canvas.width = 1;\n  canvas.height = 1;\n  return canvas;\n}\n\nconst olUseNewCoordinates = (function() {\n  const tileSource = new TileSource({\n    projection: 'EPSG:3857',\n    wrapX: true\n  });\n  const tileCoord = tileSource.getTileCoordForTileUrlFunction([6, -31, 22]);\n  return tileCoord && tileCoord[1] === 33 && tileCoord[2] === 22;\n  // See b/test/spec/ol/source/tile.test.js\n  // of e9a30c5cb7e3721d9370025fbe5472c322847b35 in OpenLayers repository\n})();\n\n\nexport default class OLImageryProvider implements ImageryProvider /* should not extend Cesium.ImageryProvider */ {\n  private source_: TileImage;\n  private projection_: Projection | undefined;\n  private fallbackProj_: Projection | undefined;\n  private map_: Map;\n  private shouldRequestNextLevel: boolean;\n  private emptyCanvas_: HTMLCanvasElement = createEmptyCanvas();\n  private emptyCanvasPromise_: Promise<HTMLCanvasElement> = Promise.resolve(this.emptyCanvas_);\n  private tilingScheme_: TilingScheme;\n  private ready_: boolean;\n  private rectangle_: Rectangle;\n\n  /**\n * When <code>true</code>, this model is ready to render, i.e., the external binary, image,\n * and shader files were downloaded and the WebGL resources were created.\n */\n  get ready(): boolean {\n    return this.ready_;\n  }\n\n  /**\n * Gets the rectangle, in radians, of the imagery provided by the instance.\n */\n  get rectangle() {\n    return this.rectangle_;\n  }\n\n  /**\n   * Gets the tiling scheme used by the provider.\n   */\n  get tilingScheme(): TilingScheme {\n    return this.tilingScheme_;\n  }\n\n  /**\n   * Gets an event that is raised when the imagery provider encounters an asynchronous error.  By subscribing\n   * to the event, you will be notified of the error and can potentially recover from it.  Event listeners\n   * are passed an instance of {@link Cesium.TileProviderError}.\n   */\n  readonly errorEvent: Event = new Cesium.Event();\n\n  /**\n   * Gets the credit to display when this imagery provider is active.  Typically this is used to credit\n   * the source of the imagery.\n   */\n  readonly credit: Credit;\n\n  /**\n   * Gets the proxy used by this provider.\n   */\n  readonly proxy: Proxy;\n\n  get _ready(): boolean {\n    return this.ready_;\n  }\n\n  /**\n   * Gets the width of each tile, in pixels.\n   */\n  get tileWidth(): number {\n    const tileGrid = this.source_.getTileGrid();\n    if (tileGrid) {\n      const tileSizeAtZoom0 = tileGrid.getTileSize(0);\n      if (Array.isArray(tileSizeAtZoom0)) {\n        return tileSizeAtZoom0[0];\n      } else {\n        return tileSizeAtZoom0; // same width and height\n      }\n    }\n    return 256;\n  }\n\n  /**\n   * Gets the height of each tile, in pixels.\n   */\n  get tileHeight(): number {\n    const tileGrid = this.source_.getTileGrid();\n    if (tileGrid) {\n      const tileSizeAtZoom0 = tileGrid.getTileSize(0);\n      if (Array.isArray(tileSizeAtZoom0)) {\n        return tileSizeAtZoom0[1];\n      } else {\n        return tileSizeAtZoom0; // same width and height\n      }\n    }\n    return 256;\n  }\n\n  /**\n   * Gets the maximum level-of-detail that can be requested.\n   */\n  get maximumLevel(): number {\n    const tileGrid = this.source_.getTileGrid();\n    if (tileGrid) {\n      return tileGrid.getMaxZoom();\n    } else {\n      return 18; // some arbitrary value\n    }\n  }\n\n  // FIXME: to implement, we could check the number of tiles at minzoom (for this rectangle) and return 0 if too big\n  /**\n   * Gets the minimum level-of-detail that can be requested.  Generally,\n   * a minimum level should only be used when the rectangle of the imagery is small\n   * enough that the number of tiles at the minimum level is small.  An imagery\n   * provider with more than a few tiles at the minimum level will lead to\n   * rendering problems.\n   */\n  get minimumLevel() {\n    // WARNING: Do not use the minimum level (at least until the extent is\n    // properly set). Cesium assumes the minimumLevel to contain only\n    // a few tiles and tries to load them all at once -- this can\n    // freeze and/or crash the browser !\n    return 0;\n    //var tg = this.source_.getTileGrid();\n    //return tg ? tg.getMinZoom() : 0;\n  }\n\n  /**\n   * Gets the tile discard policy.  If not undefined, the discard policy is responsible\n   * for filtering out \"missing\" tiles via its shouldDiscardImage function.  If this function\n   * returns undefined, no tiles are filtered.\n   */\n  get tileDiscardPolicy(): TileDiscardPolicy {\n    return undefined;\n  }\n\n  // FIXME: this might be exposed\n  /**\n   * Gets a value indicating whether or not the images provided by this imagery provider\n   * include an alpha channel.  If this property is false, an alpha channel, if present, will\n   * be ignored.  If this property is true, any images without an alpha channel will be treated\n   * as if their alpha is 1.0 everywhere.  When this property is false, memory usage\n   * and texture upload time are reduced.\n   */\n  get hasAlphaChannel() {\n    return true;\n  }\n\n  // FIXME: this could be implemented by proxying to OL\n  /**\n   * Asynchronously determines what features, if any, are located at a given longitude and latitude within\n   * a tile.\n   * This function is optional, so it may not exist on all ImageryProviders.\n   * @param x - The tile X coordinate.\n   * @param y - The tile Y coordinate.\n   * @param level - The tile level.\n   * @param longitude - The longitude at which to pick features.\n   * @param latitude - The latitude at which to pick features.\n   * @return A promise for the picked features that will resolve when the asynchronous\n   *                   picking completes.  The resolved value is an array of {@link ImageryLayerFeatureInfo}\n   *                   instances.  The array may be empty if no features are found at the given location.\n   *                   It may also be undefined if picking is not supported.\n   */\n  pickFeatures(x: number, y: number, level: number, longitude: number, latitude: number): Promise<ImageryLayerFeatureInfo[]> | undefined {\n    return undefined;\n  }\n\n  /**\n   * Special class derived from Cesium.ImageryProvider\n   * that is connected to the given ol.source.TileImage.\n   * @param olMap OL map\n   * @param source Tile image source\n   * @param [opt_fallbackProj] Projection to assume if source has no projection\n   */\n  constructor(olMap: Map, source: TileImage, opt_fallbackProj: Projection) {\n    this.source_ = source;\n\n    this.projection_ = null;\n\n    this.ready_ = false;\n\n    this.fallbackProj_ = opt_fallbackProj || null;\n\n    // cesium v107+ don't wait for ready anymore so we put somehing here while it loads\n    this.tilingScheme_ = new Cesium.WebMercatorTilingScheme();\n\n    this.rectangle_ = null;\n\n    this.map_ = olMap;\n\n    this.shouldRequestNextLevel = false;\n\n    const proxy = this.source_.get('olcs.proxy');\n    if (proxy) {\n      if (typeof proxy === 'function') {\n        // Duck typing a proxy\n        this.proxy = {\n          'getURL': proxy\n        } as Proxy;\n      } else if (typeof proxy === 'string') {\n        this.proxy = new Cesium.DefaultProxy(proxy);\n      }\n    }\n\n    this.source_.on('change', (e) => {\n      this.handleSourceChanged_();\n    });\n    this.handleSourceChanged_();\n  }\n\n  /**\n   * Checks if the underlying source is ready and cached required data.\n   */\n  private handleSourceChanged_() {\n    if (!this.ready_ && this.source_.getState() == 'ready') {\n      this.projection_ = getSourceProjection(this.source_) || this.fallbackProj_;\n      const options = {numberOfLevelZeroTilesX: 1, numberOfLevelZeroTilesY: 1};\n\n      if (this.source_.tileGrid !== null) {\n        // Get the number of tiles at level 0 if it is defined\n        this.source_.tileGrid.forEachTileCoord(this.projection_.getExtent(), 0, ([zoom, xIndex, yIndex]) => {\n          options.numberOfLevelZeroTilesX = xIndex + 1;\n          options.numberOfLevelZeroTilesY = yIndex + 1;\n        });\n      }\n\n      if (this.projection_.getCode() === 'EPSG:4326') {\n        // Cesium zoom level 0 is OpenLayers zoom level 1 for layer in EPSG:4326 with a single tile on level 0\n        this.shouldRequestNextLevel = options.numberOfLevelZeroTilesX === 1 && options.numberOfLevelZeroTilesY === 1;\n        this.tilingScheme_ = new Cesium.GeographicTilingScheme(options);\n      } else if (this.projection_.getCode() === 'EPSG:3857') {\n        this.shouldRequestNextLevel = false;\n        this.tilingScheme_ = new Cesium.WebMercatorTilingScheme(options);\n      } else {\n        return;\n      }\n      this.rectangle_ = this.tilingScheme_.rectangle;\n\n      this.ready_ = true;\n    }\n  }\n\n  /**\n   * Generates the proper attributions for a given position and zoom\n   * level.\n   * @implements\n   */\n  getTileCredits(x: number, y: number, level: number): Credit[] {\n    const attributionsFunction = this.source_.getAttributions();\n    if (!attributionsFunction) {\n      return [];\n    }\n    const extent = this.map_.getView().calculateExtent(this.map_.getSize());\n    const center = this.map_.getView().getCenter();\n    const zoom = this.shouldRequestNextLevel ? level + 1 : level;\n    return attributionsFunctionToCredits(attributionsFunction, zoom, center, extent);\n  }\n\n  /**\n   * @implements\n   */\n  requestImage(x: number, y: number, level: number, request?: Request): Promise<ImageryTypes> | undefined {\n    const tileUrlFunction = this.source_.getTileUrlFunction();\n    if (tileUrlFunction && this.projection_) {\n      const z_ = this.shouldRequestNextLevel ? level + 1 : level;\n\n      let y_ = y;\n      if (!olUseNewCoordinates) {\n        // LEGACY\n        // OpenLayers version 3 to 5 tile coordinates increase from bottom to top\n        y_ = -y - 1;\n      }\n      let url = tileUrlFunction.call(this.source_, [z_, x, y_], 1, this.projection_);\n      if (this.proxy) {\n        url = this.proxy.getURL(url);\n      }\n      if (url) {\n        // It is probably safe to cast here\n        return Cesium.ImageryProvider.loadImage(this, url) as Promise<ImageryTypes>;\n      }\n      return this.emptyCanvasPromise_;\n    } else {\n      // return empty canvas to stop Cesium from retrying later\n      return this.emptyCanvasPromise_;\n    }\n  }\n}\n","import {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport type Projection from 'ol/proj/Projection.js';\nimport type {Billboard, BillboardCollection, Primitive, PrimitiveCollection, Scene} from 'cesium';\nimport type {EventsKey} from 'ol/events.js';\n\n\n/**\n * Context for feature conversion.\n */\nexport type OlFeatureToCesiumContext = {\n  projection: Projection | string,\n  billboards: BillboardCollection,\n  featureToCesiumMap: Record<number, Array<Primitive | Billboard>>,\n  primitives: PrimitiveCollection\n};\n\n\nexport default class VectorLayerCounterpart {\n  olListenKeys: EventsKey[] = [];\n  context: OlFeatureToCesiumContext;\n  private rootCollection_: PrimitiveCollection;\n  /**\n  * Result of the conversion of an OpenLayers layer to Cesium.\n  */\n  constructor(layerProjection: Projection | string, scene: Scene) {\n    const billboards = new Cesium.BillboardCollection({scene});\n    const primitives = new Cesium.PrimitiveCollection();\n    this.rootCollection_ = new Cesium.PrimitiveCollection();\n    this.context = {\n      projection: layerProjection,\n      billboards,\n      featureToCesiumMap: {},\n      primitives\n    };\n\n    this.rootCollection_.add(billboards);\n    this.rootCollection_.add(primitives);\n  }\n\n  /**\n  * Unlisten.\n  */\n  destroy() {\n    this.olListenKeys.forEach(olObservableUnByKey);\n    this.olListenKeys.length = 0;\n  }\n\n  getRootPrimitive(): PrimitiveCollection {\n    return this.rootCollection_;\n  }\n}\n\n\nexport type PrimitiveCollectionCounterpart = PrimitiveCollection & {counterpart: VectorLayerCounterpart};\n","/**\n * Converts radians to to degrees.\n *\n * @param angleInRadians Angle in radians.\n * @return Angle in degrees.\n */\nexport function toDegrees(angleInRadians: number): number {\n  return angleInRadians * 180 / Math.PI;\n}\n\n\n/**\n * Converts degrees to radians.\n *\n * @param angleInDegrees Angle in degrees.\n * @return Angle in radians.\n */\nexport function toRadians(angleInDegrees: number): number {\n  return angleInDegrees * Math.PI / 180;\n}\n","export * from './print/computeRectangle';\nexport * from './print/drawCesiumMask';\nexport * from './print/takeCesiumScreenshot';\n","export interface RectangleOutput {\n  scaling: [number, number];\n  offsetX: number;\n  offsetY: number;\n  width: number;\n  height: number;\n}\n\nexport function computeRectangle(canvas: HTMLCanvasElement, tw: number, th: number): RectangleOutput {\n\n  const maskAspectRatio = tw / th;\n  let maskSize;\n\n  if (maskAspectRatio > 1) {\n    // landscape\n    maskSize = [canvas.width, canvas.width / maskAspectRatio];\n    if (maskSize[1] > canvas.height) {\n      maskSize = [canvas.height * maskAspectRatio, canvas.height];\n    }\n  }\n  else {\n    // portrait\n    maskSize = [canvas.height * maskAspectRatio, canvas.height];\n    if (maskSize[0] > canvas.width) {\n      maskSize = [canvas.width, canvas.width / maskAspectRatio];\n    }\n  }\n\n  return {\n    scaling: [maskSize[0] / canvas.width, maskSize[1] / canvas.height],\n    width: maskSize[0],\n    height: maskSize[1],\n    offsetX: (canvas.width - maskSize[0]) / 2,\n    offsetY: (canvas.height - maskSize[1]) / 2,\n  };\n}\n","import type {Scene} from 'cesium';\n\nlet postUnlistener: Function = null;\n\ninterface ProgramInfo {\n  program: WebGLProgram,\n  attribLocations: {\n    vertexPosition: number\n  },\n  uniformLocations: {\n    uScaling: WebGLUniformLocation\n  }\n}\n\n\n// CC0 from https://github.com/mdn/dom-examples/tree/main/webgl-examples/tutorial/sample2\n\n\nexport class MaskDrawer {\n  private programInfo: ProgramInfo;\n  private positionBuffer: WebGLBuffer;\n\n  constructor(private gl: WebGL2RenderingContext | WebGLRenderingContext) {\n    const shaderProgram = this.initShaderProgram();\n\n    this.programInfo = {\n      program: shaderProgram,\n      attribLocations: {\n        vertexPosition: gl.getAttribLocation(shaderProgram, 'aVertexPosition')\n      },\n      uniformLocations: {\n        uScaling: gl.getUniformLocation(\n            shaderProgram,\n            'uScaling'\n        )\n      }\n    };\n\n    this.positionBuffer = gl.createBuffer();\n    const positions = [1.0, 1.0, -1.0, 1.0, 1.0, -1.0, -1.0, -1.0];\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);\n  }\n\n  getVertexShaderSource() {\n    return `\n      attribute vec4 aVertexPosition;\n      uniform vec2 uScaling;\n      void main() {\n        gl_Position = vec4(aVertexPosition[0] * uScaling[0], aVertexPosition[1] * uScaling[1], -1.0, 1.0);\n      }\n    `;\n  }\n\n  getFragmentShaderSource() {\n    return `\n      precision highp float;\n      void main() {\n        gl_FragColor = vec4(.5, .5, .5, .6);\n      }\n  `;\n  }\n\n  /**\n   *\n   */\n  private initShaderProgram(): WebGLProgram {\n    const gl = this.gl;\n    const vsSource = this.getVertexShaderSource();\n    const fsSource = this.getFragmentShaderSource();\n    const vertexShader = MaskDrawer.loadShader(gl, gl.VERTEX_SHADER, vsSource),\n        fragmentShader = MaskDrawer.loadShader(gl, gl.FRAGMENT_SHADER, fsSource),\n        shaderProgram = gl.createProgram();\n\n    gl.attachShader(shaderProgram, vertexShader);\n    gl.attachShader(shaderProgram, fragmentShader);\n    gl.linkProgram(shaderProgram);\n\n    // If creating the shader program failed, alert\n\n    if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\n      throw new Error(\n          `Unable to initialize the shader program: ${gl.getProgramInfoLog(\n              shaderProgram\n          )}`\n      );\n    }\n\n    return shaderProgram;\n  }\n\n\n  /**\n   *\n   * @param {number[]} scaling scaling\n   */\n  drawMask(scaling: number[]) {\n    const gl = this.gl;\n    const programInfo = this.programInfo;\n    // Blend\n    gl.enable(gl.BLEND);\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.vertexAttribPointer(\n        programInfo.attribLocations.vertexPosition,\n        2,\n        gl.FLOAT,\n        false,\n        0,\n        0\n    );\n    gl.enableVertexAttribArray(programInfo.attribLocations.vertexPosition);\n    gl.useProgram(programInfo.program);\n\n\n    // Draw a first time to fill the stencil area while keeping the destination color\n    gl.enable(gl.STENCIL_TEST);\n    gl.stencilFunc(\n        gl.ALWAYS,\n        1,\n        0xFF\n    );\n    gl.stencilOp(\n        gl.KEEP,\n        gl.KEEP,\n        gl.REPLACE\n    );\n    gl.uniform2fv(\n        programInfo.uniformLocations.uScaling,\n        scaling\n    );\n    gl.blendFunc(gl.ZERO, gl.ONE);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\n\n    // Now draw again the whole viewport and darken the pixels that are not on the stencil\n    gl.stencilFunc(\n        gl.EQUAL,\n        0,\n        0xFF\n    );\n    gl.stencilOp(\n        gl.KEEP,\n        gl.KEEP,\n        gl.KEEP\n    );\n    gl.uniform2fv(\n        programInfo.uniformLocations.uScaling,\n        [1, 1]\n    );\n    gl.blendFunc(gl.ZERO, gl.SRC_ALPHA);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n  }\n\n\n\n  /**\n   */\n  private static loadShader(gl: WebGL2RenderingContext | WebGLRenderingContext, type: number, source: string): WebGLShader {\n    const shader = gl.createShader(type);\n\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      throw new Error(\n          `An error occurred compiling the shaders: ${gl.getShaderInfoLog(shader)}`\n      );\n      // gl.deleteShader(shader);\n    }\n\n    return shader;\n  }\n}\n\n/**\n *\n */\nexport function autoDrawMask(scene: Scene, getScalings: () => number[]) {\n  const canvas = scene.canvas;\n  const ctx = canvas.getContext('webgl2') || canvas.getContext('webgl');\n\n  if (getScalings) {\n    if (!postUnlistener) {\n      const drawer = new MaskDrawer(ctx);\n      postUnlistener = scene.postRender.addEventListener(() => {\n        drawer.drawMask(getScalings());\n      });\n    }\n  }\n  else if (postUnlistener) {\n    postUnlistener();\n    // FIXME: destroy program\n    postUnlistener = null;\n  }\n  scene.requestRender();\n}\n","import type {Scene} from 'cesium';\n\ninterface ScreenshotOptions {\n  offsetX: number;\n  offsetY: number;\n  width: number;\n  height: number;\n}\n\n/**\n */\nexport function takeScreenshot(scene: Scene, options: ScreenshotOptions): Promise<string> {\n  return new Promise((resolve, reject) => {\n  // preserveDrawingBuffers is false so we render on demand and immediately read the buffer\n    const remover = scene.postRender.addEventListener(() => {\n      remover();\n      try {\n        let url;\n\n        if (options) {\n          const smallerCanvas = document.createElement('canvas');\n\n          smallerCanvas.width = options.width;\n          smallerCanvas.height = options.height;\n          smallerCanvas.getContext('2d').drawImage(\n              scene.canvas,\n              options.offsetX, options.offsetY, options.width, options.height,\n              0, 0, options.width, options.height);\n          url = smallerCanvas.toDataURL();\n        }\n        else {\n          url = scene.canvas.toDataURL();\n        }\n        resolve(url);\n      }\n      catch (e) {\n        reject(e);\n      }\n    });\n\n    scene.requestRender();\n  });\n}\n","import type {Projection} from 'ol/proj';\nimport type {Source} from 'ol/source';\n\nlet _imageRenderingPixelatedSupported: boolean = undefined;\nlet _imageRenderingValue: string = undefined;\n\n\n/**\n * https://caniuse.com/mdn-css_properties_image-rendering_pixelated\n * @return whether the browser supports\n */\nexport function supportsImageRenderingPixelated(): boolean {\n  if (_imageRenderingPixelatedSupported === undefined) {\n    const canvas = document.createElement('canvas');\n    canvas.setAttribute('style', 'image-rendering: -moz-crisp-edges; image-rendering: crisp-edges; image-rendering: pixelated;');\n    // canvas.style.imageRendering will be undefined, null or an\n    // empty string on unsupported browsers.\n    const imageRenderingValue = canvas.style.imageRendering;\n    _imageRenderingPixelatedSupported = !!imageRenderingValue;\n    if (_imageRenderingPixelatedSupported) {\n      _imageRenderingValue = imageRenderingValue;\n    }\n  }\n  return _imageRenderingPixelatedSupported;\n}\n\n\n/**\n * The value supported by thie browser for the CSS property \"image-rendering\"\n * @return {string}\n */\nexport function imageRenderingValue() {\n  supportsImageRenderingPixelated();\n  return _imageRenderingValue || '';\n}\n\n/**\n * Return the projection of the source that Cesium should use.\n *\n * @param source Source.\n * @return The projection of the source.\n */\nexport function getSourceProjection(source: Source): Projection {\n  return source.get('olcs.projection') as Projection || source.getProjection();\n}\n\n\n/**\n * Counter for getUid.\n * @type {number}\n */\nlet uidCounter_ = 0;\n\n/**\n * Gets a unique ID for an object. This mutates the object so that further calls\n * with the same object as a parameter returns the same value. Unique IDs are generated\n * as a strictly increasing sequence. Adapted from goog.getUid. Similar to OL getUid.\n *\n * @param obj The object to get the unique ID for.\n * @return The unique ID for the object.\n */\nexport function getUid(obj: any): number {\n  return obj.olcs_uid || (obj.olcs_uid = ++uidCounter_);\n}\n\nexport function waitReady<Type>(object: Type): Promise<Type> {\n  const o = object as any;\n  const p = o.readyPromise;\n  if (p) {\n    return p;\n  }\n  if (o.ready !== undefined) {\n    if (o.ready) {\n      return Promise.resolve(object);\n    }\n    return new Promise((resolve, _) => {\n      // FIXME: this is crazy\n      // alternative: intercept _ready = true\n      // altnerative: pass a timeout\n      const stopper = setInterval(() => {\n        if (o.ready) {\n          clearInterval(stopper);\n          resolve(object);\n        }\n      }, 20);\n    });\n  }\n  return Promise.reject('Not a readyable object');\n}\n","module.exports = ol.Observable;","module.exports = ol.Overlay;","module.exports = ol.easing;","module.exports = ol.extent;","module.exports = ol.format.MVT;","module.exports = ol.geom;","module.exports = ol.geom.Point;","module.exports = ol.geom.Polygon;","module.exports = ol.geom.SimpleGeometry;","module.exports = ol.layer.BaseVector;","module.exports = ol.layer.Group;","module.exports = ol.layer.Image;","module.exports = ol.layer.Layer;","module.exports = ol.layer.Tile;","module.exports = ol.layer.Vector;","module.exports = ol.layer.VectorTile;","module.exports = ol.proj;","module.exports = ol.render;","module.exports = ol.render.Feature;","module.exports = ol.source;","module.exports = ol.source.Cluster;","module.exports = ol.source.Image;","module.exports = ol.source.ImageStatic;","module.exports = ol.source.ImageWMS;","module.exports = ol.source.TileImage;","module.exports = ol.source.TileWMS;","module.exports = ol.source.Vector;","module.exports = ol.source.VectorTile;","module.exports = ol.structs.LRUCache;","module.exports = ol.style.Icon;","module.exports = ol.style.Stroke;","module.exports = ol.style.Style;","module.exports = ol.tilegrid;","module.exports = ol.tileurlfunction;","module.exports = ol.util;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import OLCesium from './olcs/OLCesium';\nexport default OLCesium;\n\nexport {default as AbstractSynchronizer} from './olcs/AbstractSynchronizer';\nexport {default as RasterSynchronizer} from './olcs/RasterSynchronizer';\nexport {default as VectorSynchronizer} from './olcs/VectorSynchronizer';\n\nexport {default as FeatureConverter} from './olcs/FeatureConverter';\nexport {default as OLCSCamera} from './olcs/Camera';\n\n// Core api functions\nexport * from './olcs/core';\nexport {default as OLImageryProvider} from './olcs/core/OLImageryProvider';\nexport {default as VectorLayerCounterpart} from './olcs/core/VectorLayerCounterpart';\n\n// Print functions\nexport * from './olcs/print';\n\n// Contrib Manager\nexport {default as ContribManager} from './olcs/contrib/Manager';\nexport {default as ContribLazyLoader} from './olcs/contrib/LazyLoader';\n\n// Deprecated export of olcs on window\n// @ts-ignore\nconst olcs = window['olcs'] = {};\n// @ts-ignore\nolcs.OLCesium = OLCesium;\n\nimport {default as AbstractSynchronizer} from './olcs/AbstractSynchronizer';\nimport {default as RasterSynchronizer} from './olcs/RasterSynchronizer';\nimport {default as VectorSynchronizer} from './olcs/VectorSynchronizer';\n// @ts-ignore\nolcs.AbstractSynchronizer = AbstractSynchronizer;\n// @ts-ignore\nolcs.RasterSynchronizer = RasterSynchronizer;\n// @ts-ignore\nolcs.VectorSynchronizer = VectorSynchronizer;\n\nimport * as core from './olcs/core';\nimport {default as OLImageryProvider} from './olcs/core/OLImageryProvider';\nimport {default as VectorLayerCounterpart} from './olcs/core/VectorLayerCounterpart';\n// @ts-ignore\nolcs.core = core;\n// @ts-ignore\nolcs.core.OLImageryProvider = OLImageryProvider;\n// @ts-ignore\nolcs.core.VectorLayerCounterpart = VectorLayerCounterpart;\n\n// @ts-ignore\nolcs.contrib = {};\nimport {default as ContribManager} from './olcs/contrib/Manager';\nimport {default as ContribLazyLoader} from './olcs/contrib/LazyLoader';\n// @ts-ignore\nolcs.contrib.LazyLoader = ContribLazyLoader;\n// @ts-ignore\nolcs.contrib.Manager = ContribManager;\n"],"names":["unByKey","olObservableUnByKey","LayerGroup","getUid","AbstractSynchronizer","constructor","map","scene","layerMap","olLayerListenKeys","olGroupListenKeys_","view","getView","olLayers","getLayerGroup","getLayers","mapLayerGroup","synchronize","destroyAll","addLayers_","orderLayers","root","fifo","layer","parents","length","olLayerWithParents","splice","olLayer","olLayerId","toString","console","assert","cesiumObjects","listenForGroupChanges_","createSingleLayerCounterparts","forEach","l","newOlLayerWithParents","concat","push","layerId","layerWithParents","onLayerChange","cesiumObjs","un","addCesiumObjects_","on","cesiumObject","addCesiumObject","removeAndDestroySingleLayer_","uid","counterparts","counterpart","removeSingleCesiumObject","destroyCesiumObject","unlistenSingleGroup_","group","keys","key","removeLayer_","done","uuid","undefined","listenKeyArray","contentKeys","listenAddRemove","collection","event","element","bind","e","el","i","indexOf","removeAllCesiumObjects","objKey","AutoRenderLoop","ol3d","repaintEventNames_","scene_","getCesiumScene","canvas_","canvas","_boundNotifyRepaintRequired","notifyRepaintRequired","enable","requestRenderMode","maximumRenderTimeChange","repaintKey","addEventListener","window","getOlMap","disable","removeEventListener","restartRenderLoop","requestRender","toRadians","toDegrees","getTransform","pickCenterPoint","calcDistanceForResolution","calcResolutionForDistance","identityProjection","input","opt_output","opt_dimension","dim","Camera","viewListenKey_","toLonLat_","fromLonLat_","tilt_","distance_","lastCameraViewMatrix_","viewUpdateInProgress_","cam_","camera","map_","setView_","destroy","view_","toLonLat","getProjection","fromLonLat","handleViewChangedEvent_","readFromView","setHeading","heading","setRotation","getHeading","rotation","getRotation","setTilt","tilt","updateCamera_","getTilt","setDistance","distance","updateView","getDistance","setCenter","center","getCenter","setPosition","position","ll","carto","Cesium","Cartographic","getAltitude","setView","destination","Ellipsoid","WGS84","cartographicToCartesian","getPosition","cartesianToCartographic","pos","longitude","latitude","setAltitude","altitude","height","globe","getHeight","orientation","pitch","Math","PI_OVER_TWO","roll","moveBackward","checkCameraChange","resolution","getResolution","ellipsoid","target","bestTarget","positionCartographic","clone","Cartesian3","bestTargetCartographic","setResolution","targetNormal","geocentricSurfaceNormal","targetToCamera","subtract","normalize","up","right","normal","y","x","angleBetween","cross","z","tiltAngle","acos","dot","isNaN","PI","opt_dontSync","old","current","viewMatrix","Matrix4","equalsEpsilon","OLStyleIcon","VectorSource","OLClusterSource","circular","olCreateCircularPolygon","boundingExtent","olGeomSimpleGeometry","convertColorToCesium","olGeometryCloneTo4326","ol4326CoordinateToCesiumCartesian","ol4326CoordinateArrayToCsCartesians","VectorLayerCounterpart","waitReady","Geometry","OLGeometry","FeatureConverter","boundOnRemoveOrClearFeatureListener_","onRemoveOrClearFeature_","defaultBillboardEyeOffset_","evt","source","cancellers","feature","id","canceller","hasOwnProperty","setReferenceForPicking","primitive","olFeature","createColoredPrimitive","olGeometry","geometry","color","opt_lineWidth","createInstance","instance","GeometryInstance","ImageMaterialProperty","attributes","ColorGeometryInstanceAttribute","fromColor","options","flat","renderState","depthTest","enabled","lineWidth","instances","heightReference","getHeightReference","HeightReference","CLAMP_TO_GROUND","GroundPrimitive","geometryInstances","Primitive","dataUri","image","getValue","toDataURL","appearance","MaterialAppearance","material","Material","fabric","type","uniforms","translucent","alpha","get","shadows","extractColorFromOlStyle","style","outline","fillColor","getFill","getColor","strokeColor","getStroke","olColor","extractLineWidthFromOlStyle","width","getWidth","wrapFillAndOutlineGeometries","fillGeometry","outlineGeometry","olStyle","outlineColor","primitives","PrimitiveCollection","p1","add","p2","addTextStyle","getText","text","label","olGeometry4326TextPartToCesium","csAddBillboard","billboards","bbOptions","eyeOffset","bb","olCircleGeometryToCesium","projection","getType","olCenter","olPoint","slice","getRadius","point","radius","CircleGeometry","outlinePrimitive","circlePolygon","positions","getLinearRing","getCoordinates","op","GroundPolylinePrimitive","GroundPolylineGeometry","PolylineMaterialAppearance","olStyleToCesium","classificationType","ClassificationType","TERRAIN","then","_primitive","CircleOutlineGeometry","extrudedHeight","olLineStringGeometryToCesium","PolylineGeometry","vertexFormat","olPolygonGeometryToCesium","coordinates","extent","rectangle","Rectangle","fromDegrees","maxHeight","c","max","featureExtrudedHeight","RectangleGeometry","RectangleOutlineGeometry","rings","getLinearRings","hierarchy","holes","polygonHierarchy","olPos","PolygonGeometry","perPositionHeight","linePositions","polylineGeometry","PolygonOutlineGeometry","altitudeMode","NONE","RELATIVE_TO_GROUND","createBillboardFromImage","imageStyle","opt_newBillboardCallback","load","getImage","isImageLoaded","src","naturalHeight","naturalWidth","complete","reallyCreateBillboard","HTMLCanvasElement","Image","HTMLImageElement","opacity","getOpacity","Color","scale","getScale","Object","assign","anchor","getAnchor","xScale","Array","isArray","yScale","pixelOffset","Cartesian2","cancelled","getSource","fuid","listener","isDestroyed","olPointGeometryToCesium","modelPrimitive","olcsModelFunction","olcsModel","cesiumOptions","Model","model","fromGltf","fromGltfAsync","debugModelMatrix","DebugModelMatrixPrimitive","modelMatrix","olMultiGeometryToCesium","points","getPoints","geom","result","lineStrings","getLineStrings","p","polygons","getPolygons","labels","LabelCollection","extentCenter","getExtent","first","getFirstCoordinate","offsetX","getOffsetX","offsetY","getOffsetY","offset","font","getFont","labelStyle","LabelStyle","FILL","outlineWidth","OUTLINE","FILL_AND_OUTLINE","horizontalOrigin","getTextAlign","HorizontalOrigin","LEFT","RIGHT","CENTER","getTextBaseline","verticalOrigin","VerticalOrigin","TOP","BOTTOM","fill","stroke","getLineDash","fromType","horizontal","repeat","evenColor","oddColor","computePlainStyle","fallbackStyleFunction","featureStyleFunction","getStyleFunction","getGeometryFromFeature","opt_geom","geom3d","geomFuncRes","getGeometryFunction","getGeometry","olFeatureToCesium","context","proj","newBillboardAddedCallback","featureBb","featureToCesiumMap","getGeometriesArray","prims","bbs","Error","olVectorLayerToCesium","olView","featurePrimitiveMap","features","getFeatures","layerStyle","styles","prim","getRootPrimitive","convert","MVT","Style","Stroke","toContext","VERSION","OL_VERSION","LRUCache","getForProjection","getTilegridForProjection","createFromTemplates","createTileUrlFunctions","RenderFeature","createEmptyCanvas","format","featureClass","MVTImageryProvider","minimumLevel","minimumLevel_","ready","ready_","rectangle_","tilingScheme","tilingScheme_","getTileCredits","level","_ready","tileDiscardPolicy","hasAlphaChannel","pickFeatures","emptyCanvas_","emptyCanvasPromise_","Promise","resolve","WebMercatorTilingScheme","tileWidth","tileHeight","maximumLevel","projection_","errorEvent","Event","urls","credit","styleFunction_","styleFunction","tileRectangle_","cacheSize","tileCache","featureCache","tileGrid","tileFunction_","getTileFeatures","cacheKey","getCacheKey_","promise","containsKey","url","getUrl_","fetch","r","ok","reject","arrayBuffer","buffer","readFeaturesFromBuffer","set","getCount","highWaterMark","canExpireCache","pop","dataProjection","featureProjection","readFeatures","scaleFactor","f","flatCoordinates","getFlatCoordinates","flip","requestImage","request","tileXYToNativeRectangle","east","west","rasterizeFeatures","trace","raiseEvent","document","createElement","vectorContext","getContext","size","setStyle","drawGeometry","olGeomPoint","supportsImageRenderingPixelated","imageRenderingValue","olcsAutoRenderLoop","olcsCamera","olcsRasterSynchronizer","olcsVectorSynchronizer","olcsOverlaySynchronizer","BoundingSphereState","DONE","PENDING","FAILED","OLCesium","autoRenderLoop_","resolutionScale_","canvasClientWidth_","canvasClientHeight_","resolutionScaleChanged_","enabled_","pausedInteractions_","hiddenRootGroup_","lastFrameTime_","targetFrameRate_","Number","POSITIVE_INFINITY","blockCesiumRendering_","warmingUp_","trackedFeature_","trackedEntity_","entityView_","needTrackedEntityUpdate_","boundingSphereScratch_","BoundingSphere","time_","time","JulianDate","now","to4326Transform_","fillArea","container_","containerAttribute","createAttribute","value","setAttributeNode","targetElement","getViewport","getElementById","appendChild","isOverMap_","stopOpenLayersEventsPropagation","overlayEvents","ii","stopPropagation","canvasAttribute","oncontextmenu","onselectstart","sceneOptions","scene3DOnly","Scene","sscc","screenSpaceCameraController","tiltEventTypes","log","CameraEventType","LEFT_DRAG","KeyboardEventModifier","SHIFT","ALT","enableLook","constrainedAxis","UNIT_Z","camera_","globe_","Globe","baseColor","WHITE","skyAtmosphere","SkyAtmosphere","firstImageryProvider","SingleTileImageryProvider","imageryLayers","addImageryProvider","dataSourceCollection_","DataSourceCollection","dataSourceDisplay_","DataSourceDisplay","dataSourceCollection","synchronizers_","createSynchronizers","handleResize_","eventHelper","EventHelper","postRender","prototype","updateTrackedEntity_","cancelAnimationFrame","renderId_","synchronizer","_postRender","remove","render_","requestAnimationFrame","onAnimationFrame_","frameTime","interval","delta","julianDate","initializeFrame","update","trackedEntity","trackedState","getBoundingSphere","render","state","enableTilt","bs","EntityView","mapProjection","clientWidth","clientHeight","resolutionScale","devicePixelRatio","frustum","aspectRatio","getCamera","getOlView","getDataSources","getDataSourceDisplay","getEnabled","setEnabled","visibility","interactions","throwOnUnitializedMap_","getInteractions","arr","clear","addInteraction","interaction","removeInteraction","interactionRemoved","filter","removed","rootGroup","getVisible","setVisible","getOverlayContainer","classList","warmUp","timeout","csCamera","setTimeout","setBlockCesiumRendering","block","enableAutoRenderLoop","getAutoRenderLoop","setResolutionScale","setTargetFrameRate","isDef","trackedFeature","defaultDataSource","entities","lookAtTransform","IDENTITY","to4326Transform","toCesiumPosition","coo","coo4326","CallbackProperty","pixelSize","TRANSPARENT","SynchronizedOverlay","OverlaySynchronizer","overlayMap_","Map","overlayCollection_","getOverlays","overlayContainerStopEvent_","className","name","parentElement","overlayContainer_","getOverlayContainerStopEvent","overlay","addOverlay","removeOverlay","cesiumOverlay","parent","overlayId","csOverlay","delete","olcsAbstractSynchronizer","tileLayerToImageryLayer","updateCesiumLayerProperties","BaseVectorLayer","RasterSynchronizer","cesiumLayers_","ourLayers_","ImageryLayerCollection","object","removeAll","convertLayerToCesiumImageries","viewProj","olLayerItem","previousStyleFunction","currentStyleFunction","csObj","_imageryCache","ip","imageryProvider","_ip$tileCache","layers","zIndices","queue","getZIndex","sublayers","unshift","getArray","sort","layer1","layer2","raiseToTop","OLOverlay","transform","removeNode","node","parentNode","removeChild","removeChildren","lastChild","cloneNode","nodeName","ctx","drawImage","nodeType","Node","TEXT_NODE","dispatchEvent","MouseEvent","nodes","childNodes","getOptions","scenePostRenderListenerRemover_","attributeObserver_","synchronizer_","parent_","positionWGS84_","observer_","MutationObserver","handleElementChanged","listenerKeys_","setPropertyFromEvent","setPropertyFromEvent_","setProperties","getProperties","handleMapChanged","observeTarget_","disconnect","observe","childList","characterData","subtree","observer","getScene","updatePixelPosition","container","stopEvent","insertFirst","insertBefore","handlePositionChanged","sourceProjection","getMap","getElement","from","clonedNode","globeHeight","tilesLoaded","cartesian","ellipsoidBoundingSphere","occluder","Occluder","isPointVisible","cullingVolume","computeCullingVolume","direction","computeVisibility","pixelCartesian","cartesianToCanvasCoordinates","pixel","mapSize","updateRenderedPosition","olSourceVector","olLayerLayer","olSourceCluster","olLayerVector","olLayerVectorTile","olcsFeatureConverter","VectorSynchronizer","opt_converter","converter","csAllPrimitives_","destroyPrimitives","updateLayerVisibility","csPrimitive","visible","layerVisible","show","csPrimitives","olListenKeys","onAddFeature","onRemoveFeature","Billboard","LazyLoader","url_","script","onload","onerror","head","olcsContribLazyLoader","resetToNorthZenith","rotateAroundBottomCenter","computeSignedTiltAngleOnGlobe","pickBottomPoint","setHeadingUsingBottomCenter","limitCameraToBoundingSphere","Observable","Manager","cesiumUrl","_ref","cameraExtentInRadians","cesiumIonDefaultAccessToken","cesiumInitialTilt_","fogDensity","fogSSEFactor","minimumZoomDistance","maximumZoomDistance","limitCameraToBoundingSphereRatio","cesiumUrl_","cesiumIonDefaultAccessToken_","promise_","cesiumLazyLoader","onCesiumLoaded","rect","DEFAULT_VIEW_RECTANGLE","boundingSphere_","fromRectangle3D","Ion","defaultAccessToken","instantiateOLCesium","configureForUsability","configureForPerformance","terrainProvider","createWorldTerrain","createWorldTerrainAsync","tp","fog","density","screenSpaceErrorFactor","sscController","depthTestAgainstTerrain","backgroundColor","toggle3d","is3DCurrentlyEnabled","set3dWithView","lon","lat","elevation","headingDeg","pitchDeg","is3dEnabled","getTiltOnGlobe","tiltOnGlobe","angle","bottom","getOl3d","getCesiumViewMatrix","flyToRectangle","getRectangleCameraCoordinates","mag","magnitude","multiplyByScalar","flyTo","cancel","endTransform","linear","linearEasing","olLayerTile","olLayerImage","transformExtent","olSourceImageStatic","olSourceImageWMS","olSourceTileImage","olSourceTileWMS","olSourceVectorTile","defaultImageLoadFunction","olcsCoreOLImageryProvider","getSourceProjection","VectorTileLayer","getExtentCenter","computePixelSizeAtCoordinate","getPixelDimensions","pixelRatio","computeBoundingBoxAtTarget","amount","Transforms","eastNorthUpToFixedFrame","bottomLeft","multiplyByPoint","topRight","cartesianArrayToCartographicArray","applyHeightOffsetToGeometry","applyTransform","output","stride","createMatrixAtCoordinates","translation","ZERO","rawMatrix","quaternion","Quaternion","fromAxisAngle","rotationMatrix","fromTranslationQuaternionRotationScale","multiply","rotateAroundAxis","axis","opt_options","clamp","defaultValue","duration","easing","callback","lastProgress","oldTransform","start","Date","step","timestamp","timeDifference","progress","stepAngle","rotate","bottomCenter","angleToZenith","computeAngleToZenith","Matrix3","fromQuaternion","vector","zenith","multiplyByVector","fromTranslation","pickOnTerrainOrEllipsoid","ray","getPickRay","pick","pickEllipsoid","Ray","obj","IntersectionTests","rayEllipsoid","getPoint","signedAngleBetween","convertLongitudeRange","bottomFovRay","fovy2","fovy","matrix","second","a","b","cosine","sine","sign","atan2","pivot","fy","negate","left","extentToRectangle","ext","sourceToImageryProvider","olMap","skip","provider","getUrl","getImageLoadFunction","sourceProps","attributions","getAttributions","params","getParams","isCesiumProjection","getImageExtent","fromCode","getCode","split","u","replace","attributionsFunction","attributionsFunctionToCredits","layerOptions","forcedExtent","cesiumLayer","ImageryLayer","csLayer","layerOpacity","coordinate","toCartesian","cartesians","proj4326","properties","byteToFloat","fromCssColorString","CanvasPattern","CanvasGradient","fillStyle","fillRect","convertUrlToCesium","subdomains","re","match","exec","startCharCode","charCodeAt","stopCharCode","charCode","String","fromCharCode","currentHeading","normalizeView","constrainResolution","getConstrainedResolution","is3857","is4326","zoom","viewState","html","Credit","metersPerUnit","getMetersPerUnit","visibleMapUnits","relativeCircumference","cos","abs","visibleMeters","requiredDistance","tan","boundingSphere","ratio","blockLimiter","fromCartesian","currentlyFlying","flying","unblockLimiter","flyToBoundingSphere","Tile","TileSource","olUseNewCoordinates","tileSource","wrapX","tileCoord","getTileCoordForTileUrlFunction","OLImageryProvider","source_","getTileGrid","tileSizeAtZoom0","getTileSize","getMaxZoom","opt_fallbackProj","fallbackProj_","shouldRequestNextLevel","proxy","DefaultProxy","handleSourceChanged_","getState","numberOfLevelZeroTilesX","numberOfLevelZeroTilesY","forEachTileCoord","xIndex","yIndex","GeographicTilingScheme","calculateExtent","getSize","tileUrlFunction","getTileUrlFunction","z_","y_","call","getURL","ImageryProvider","loadImage","layerProjection","BillboardCollection","rootCollection_","angleInRadians","angleInDegrees","computeRectangle","tw","th","maskAspectRatio","maskSize","scaling","postUnlistener","MaskDrawer","gl","shaderProgram","initShaderProgram","programInfo","program","attribLocations","vertexPosition","getAttribLocation","uniformLocations","uScaling","getUniformLocation","positionBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","getVertexShaderSource","getFragmentShaderSource","vsSource","fsSource","vertexShader","loadShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","drawMask","BLEND","vertexAttribPointer","FLOAT","enableVertexAttribArray","useProgram","STENCIL_TEST","stencilFunc","ALWAYS","stencilOp","KEEP","REPLACE","uniform2fv","blendFunc","ONE","drawArrays","TRIANGLE_STRIP","EQUAL","SRC_ALPHA","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","autoDrawMask","getScalings","drawer","takeScreenshot","remover","smallerCanvas","_imageRenderingPixelatedSupported","_imageRenderingValue","setAttribute","imageRendering","uidCounter_","olcs_uid","o","readyPromise","_","stopper","setInterval","clearInterval","default","OLCSCamera","ContribManager","ContribLazyLoader","olcs","core","contrib"],"sourceRoot":""}